{"version":3,"sources":["webpack:///./src/components/constants.js","webpack:///./src/components/common/GriffeathMachine.css?dfff","webpack:///./src/components/gpu/gpu.js","webpack:///./src/components/gpu/utils.js","webpack:///./src/components/gpu/CanvasField.jsx","webpack:///./src/components/gpu/GriffeathMachine.jsx"],"names":["IDS","width","height","states","status","DEFAULT","_DEFAULT","STATUSES","play","pause","SPACE_CODE","module","exports","field","bigButton","__webpack_require__","d","__webpack_exports__","makeGetUpdatedField","gpu_js__WEBPACK_IMPORTED_MODULE_0__","myMod","number","limit","gpu","n","GPU","fieldWidth","fieldHeight","createKernel","ver","this","thread","x","hor","y","element","plusOne","next","setOutput","setFunctions","getRandomField","_ref","Math","floor","random","mapNumToRGB","h","h2rgb","initT","t","r","g","b","round","colorMapping","DEFAULT_COLOR","CanvasField","drawPixel","index","_this","props","_getColor","length","i","getColor","uInt32Array","paint","_this$props","Uint32Array","canvasData","ImageData","Uint8ClampedArray","buffer","canvasContext","putImageData","refCanvas","elem","getContext","render","react_default","a","createElement","ref","React","PureComponent","GriffeathMachine","state","canvas","createRef","getActionName","randomizeField","processKey","e","keyCode","preventDefault","handlePlay","updateFieldSize","_ref$width","undefined","_ref$height","fieldUpdater","getUpdatedField","_this$state","nextStep","requestID","requestAnimationFrame","cancelAnimationFrame","setState","current","handleNew","handleNext","changeHandler","name","value","_this$setState","componentWillMount","document","addEventListener","componentWillUnmount","es","onChange","id","label","defaultNum","onClick","onKeyDown","className","style","role","title","CanvasField_CanvasField","_ref2","type","defaultProps"],"mappings":"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","file":"4.e1d002a0.js","sourcesContent":["export const IDS = {\n  width: 'width',\n  height: 'height',\n  states: 'states',\n  status: 'status',\n}\n\nexport const DEFAULT = {\n  [IDS.width]: 700,\n  [IDS.height]: 700,\n  [IDS.states]: 16,\n}\n\nexport const STATUSES = {\n  play: 'Play',\n  pause: 'Pause',\n}\n\nexport const SPACE_CODE = 32\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"field\":\"GriffeathMachine__field__2ugWL\",\"bigButton\":\"GriffeathMachine__bigButton__1GY-9\"};","import GPU from 'gpu.js'\r\n\r\nfunction myMod (number, limit) {\r\n  if (number < 0) {\r\n    return number + limit\r\n  }\r\n  return (number % limit)\r\n}\r\n\r\nconst gpu = new GPU()\r\n\r\nexport const makeGetUpdatedField = (fieldWidth, fieldHeight) => gpu.createKernel(function (field, width, height, states) {\r\n  // what a mess\r\n  const ver = this.thread.x\r\n  const hor = this.thread.y\r\n  const element = field[hor][ver]\r\n  const plusOne = myMod(element + 1, states)\r\n\r\n  let next = myMod(hor - 1, width)\r\n  if (field[next][ver] === plusOne) {\r\n    return plusOne\r\n  }\r\n\r\n  next = myMod(hor + 1, width)\r\n  if (field[next][ver] === plusOne) {\r\n    return plusOne\r\n  }\r\n\r\n  next = myMod(ver - 1, height)\r\n  if (field[hor][next] === plusOne) {\r\n    return plusOne\r\n  }\r\n\r\n  next = myMod(ver + 1, height)\r\n  if (field[hor][next] === plusOne) {\r\n    return plusOne\r\n  }\r\n\r\n  return element\r\n})\r\n  .setOutput([fieldHeight, fieldWidth]) // more of the mess\r\n  .setFunctions([myMod])\r\n\r\nmodule.exports()\r\n","export function getRandomField ({ width, height, states }) {\n  const field = []\n\n  for (let x = 0; x < width; x += 1) {\n    field[x] = []\n    for (let y = 0; y < height; y += 1) {\n      field[x][y] = Math.floor(Math.random() * states)\n    }\n  }\n\n  return field\n}\n\nexport function mapNumToRGB (h) {\n  const h2rgb = (initT) => {\n    const t = initT < 0 ? initT + 1 : initT % 1\n\n    if (t < 1 / 6) {\n      return 6 * t\n    }\n    if (t < 1 / 2) {\n      return 1\n    }\n    if (t < 2 / 3) {\n      return ((2 / 3) - t) * 6\n    }\n\n    return 0\n  }\n\n  const r = h2rgb(h + (1 / 3))\n  const g = h2rgb(h)\n  const b = h2rgb(h - (1 / 3))\n\n  return {\n    r: Math.round(r * 255),\n    g: Math.round(g * 255),\n    b: Math.round(b * 255),\n  }\n}\n\nconst colorMapping = []\nconst DEFAULT_COLOR = { r: 0, g: 0, b: 0 }\n\nexport function getColor (h, states) {\n  if (colorMapping.length !== states) {\n    colorMapping.length = states\n    for (let i = 0; i < states; i += 1) {\n      colorMapping[i] = mapNumToRGB(i / states)\n    }\n  }\n  return colorMapping[h] || DEFAULT_COLOR\n}\n","/* eslint-disable no-bitwise */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { getColor } from './utils'\n\nexport default class CanvasField extends React.PureComponent {\n  static propTypes = {\n    width: PropTypes.number.isRequired,\n    height: PropTypes.number.isRequired,\n    states: PropTypes.number.isRequired,\n  }\n\n  drawPixel = (x, y, h, states) => {\n    const index = x + (y * this.props.width)\n    const { r, g, b } = getColor(h, states)\n\n    this.uInt32Array[index] = (255 << 24) | (b << 16) | (g << 8) | r\n  }\n\n  paint = (field) => {\n    const { width, height, states } = this.props\n\n    this.uInt32Array = new Uint32Array(width * height)\n\n    for (let x = 0; x < width; x += 1) {\n      for (let y = 0; y < height; y += 1) {\n        if (field[x]) {\n          this.drawPixel(x, y, field[x][y], states)\n        }\n      }\n    }\n\n    const canvasData = new ImageData(new Uint8ClampedArray(this.uInt32Array.buffer), width, height)\n    this.canvasContext.putImageData(canvasData, 0, 0)\n  }\n\n  refCanvas = (elem) => {\n    this.canvasContext = elem && elem.getContext('2d')\n  }\n\n  canvasContext\n\n  uInt32Array\n\n  render () {\n    return (\n      <canvas\n        ref={this.refCanvas}\n        width={this.props.width}\n        height={this.props.height}\n      >\n        {'You are using an outdated browser without support of canvas elements.'}\n      </canvas>\n    )\n  }\n}\n","import React, { PureComponent } from 'react'\nimport PropTypes from 'prop-types'\nimport { Connector, Input } from 'state-control'\nimport { DEFAULT, IDS, SPACE_CODE, STATUSES } from '../constants'\nimport style from '../common/GriffeathMachine.css'\nimport { getRandomField} from './utils'\nimport CanvasField from './CanvasField'\nimport { makeGetUpdatedField } from './gpu'\n\nexport default class GriffeathMachine extends PureComponent {\n  static propTypes = {\n    width: PropTypes.number.isRequired,\n    height: PropTypes.number.isRequired,\n    states: PropTypes.number.isRequired,\n  }\n\n  static defaultProps = { ...DEFAULT }\n\n  state = {\n    width: this.props.width,\n    height: this.props.height,\n    states: this.props.states,\n    status: STATUSES.pause,\n  }\n\n  field = null\n\n  canvas = React.createRef()\n\n  componentWillMount () {\n    this.randomizeField()\n    this.handlePlay()\n    document.addEventListener('keydown', this.processKey)\n    this.updateFieldSize({})\n  }\n\n  componentWillUnmount () {\n    cancelAnimationFrame(this.requestID)\n  }\n\n  getActionName = () => (this.state.status === STATUSES.play ? STATUSES.pause : STATUSES.play)\n\n  randomizeField = () => {\n    this.field = getRandomField(this.state)\n  }\n\n  processKey = (e) => {\n    if (e.keyCode === SPACE_CODE) {\n      e.preventDefault()\n      this.handlePlay()\n    }\n  }\n\n  updateFieldSize = ({ width = this.props.width, height = this.props.height }) => {\n    this.fieldUpdater = makeGetUpdatedField(width, height)\n  }\n\n  getUpdatedField = () => {\n    const { width, height, states } = this.state\n    return this.fieldUpdater(this.field, width, height, states)\n  }\n\n  nextStep = () => {\n    try {\n      this.field = this.getUpdatedField()\n\n      if (this.state.status === STATUSES.play) {\n        this.requestID = requestAnimationFrame(this.nextStep)\n      }\n    } catch (e) {\n      cancelAnimationFrame(this.requestID)\n      this.field = getRandomField(this.state)\n      this.setState({\n        status: STATUSES.pause,\n      })\n    }\n    this.canvas.current.paint(this.field)\n  }\n\n  handleNew = () => {\n    this.randomizeField()\n    this.canvas.current.paint(this.field)\n  }\n\n  handleNext = () => {\n    this.field = this.getUpdatedField()\n    this.canvas.current.paint(this.field)\n  }\n\n  handlePlay = () => {\n    switch (this.state.status) {\n      case STATUSES.play:\n        this.setState({ status: STATUSES.pause })\n        break\n      case STATUSES.pause:\n        this.setState({ status: STATUSES.play }, this.nextStep)\n        break\n      default:\n    }\n  }\n\n  changeHandler = (name, value) => {\n    switch (name) {\n      case IDS.width:\n        this.updateFieldSize({ width: value })\n        break\n      case IDS.height:\n        this.updateFieldSize({ height: value })\n        break\n      default:\n    }\n    this.setState({ [name]: value })\n  }\n\n  fieldUpdater\n\n  render () {\n    return (\n      <div>\n        <Connector\n          state={this.state}\n          onChange={this.changeHandler}\n        >\n          <Input\n            id={IDS.width}\n            label=\"Field width\"\n            defaultNum={1}\n          />\n          <Input\n            id={IDS.height}\n            label=\"Field height\"\n            defaultNum={1}\n          />\n          <Input\n            id={IDS.states}\n            label=\"Number of states\"\n            defaultNum={1}\n          />\n        </Connector>\n        <div\n          onClick={this.handlePlay}\n          onKeyDown={this.processKey}\n          className={style.field}\n          role=\"presentation\"\n          title={this.getActionName()}\n        >\n          <CanvasField\n            width={this.state.width}\n            height={this.state.height}\n            states={this.state.states}\n            ref={this.canvas}\n          />\n        </div>\n        <p><em>Press Space or click field for play / pause</em></p>\n        <button type=\"button\" className={style.bigButton} onClick={this.handleNew}>\n          New\n        </button>\n        <button type=\"button\" className={style.bigButton} onClick={this.handlePlay}>\n          {this.getActionName()}\n        </button>\n        {this.state.status === STATUSES.pause && (\n          <button type=\"button\" className={style.bigButton} onClick={this.handleNext}>\n            Next step\n          </button>\n        )}\n      </div>\n    )\n  }\n}\n"],"sourceRoot":""}