parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"MFbY":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var t=function(){function t(){n(this,t)}return e(t,null,[{key:"isCanvas",value:function(e){return null!==e&&(e.nodeName&&e.getContext&&"CANVAS"===e.nodeName.toUpperCase()||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}},{key:"isCanvasSupported",value:function(){return r}},{key:"initCanvas",value:function(){if(!r)return null;var e="undefined"!=typeof document?document.createElement("canvas"):new OffscreenCanvas(0,0);return e.width=2,e.height=2,e}},{key:"isWebGl",value:function(e){return e&&"function"==typeof e.getExtension}},{key:"isWebGl2",value:function(e){return e&&"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext}},{key:"isWebGlSupported",value:function(){return u}},{key:"isWebGl2Supported",value:function(){return o}},{key:"isWebGlDrawBuffersSupported",value:function(){return l}},{key:"initWebGlDefaultOptions",value:function(){return{alpha:!1,depth:!1,antialias:!1}}},{key:"initWebGl",value:function(e){if((void 0!==r||null===e)&&!r)return null;if(!t.isCanvas(e))throw new Error("Invalid canvas object - "+e);var n=null,i=t.initWebGlDefaultOptions();try{n=e.getContext("experimental-webgl",i)}catch(a){}return null===n&&(n=e.getContext("webgl2",i)||e.getContext("webgl",i)),n&&(n.OES_texture_float=n.getExtension("OES_texture_float"),n.OES_texture_float_linear=n.getExtension("OES_texture_float_linear"),n.OES_element_index_uint=n.getExtension("OES_element_index_uint")),n}},{key:"initWebGl2",value:function(e){if((void 0!==r||null===e)&&!r)return null;if(!t.isCanvas(e))throw new Error("Invalid canvas object - "+e);return e.getContext("webgl2",t.initWebGlDefaultOptions())}},{key:"checkOutput",value:function(e){if(!e||!Array.isArray(e))throw new Error("kernel.output not an array");for(var n=0;n<e.length;n++)if(isNaN(e[n])||e[n]<1)throw new Error("kernel.output["+n+"] incorrectly defined as `"+e[n]+"`, needs to be numeric, and greater than 0")}}]),t}(),r="undefined"!=typeof document?t.isCanvas(document.createElement("canvas")):"undefined"!=typeof OffscreenCanvas,i=t.initWebGl(t.initCanvas()),a=t.initWebGl2(t.initCanvas()),u=t.isWebGl(i),o=t.isWebGl2(a),l=u&&Boolean(i.getExtension("WEBGL_draw_buffers"));u?(t.OES_texture_float=i.OES_texture_float,t.OES_texture_float_linear=i.OES_texture_float_linear,t.OES_element_index_uint=i.OES_element_index_uint):(t.OES_texture_float=!1,t.OES_texture_float_linear=!1,t.OES_element_index_uint=!1),module.exports=t;
},{}],"Q3WB":[function(require,module,exports) {
"use strict";function s(s,i){if(!(s instanceof i))throw new TypeError("Cannot call a class as a function")}module.exports=function i(t,e){if(s(this,i),this.value=t,Array.isArray(e)){this.size=[];for(var h=0;h<e.length;h++)this.size[h]=e[h];for(;this.size.length<3;)this.size.push(1)}else e.z?this.size=[e.x,e.y,e.z]:e.y?this.size=[e.x,e.y,1]:this.size=[e.x,1,1]};
},{}],"34im":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}module.exports=function(){function r(e,n,i,u,o){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NumberTexture";t(this,r),this.texture=e,this.size=n,this.dimensions=i,this.output=u,this.webGl=o,this.kernel=null,this.type=s}return e(r,[{key:"toArray",value:function(e){if(!e)throw new Error("You need to pass the GPU object for toArray to work.");return this.kernel?this.kernel(this):(this.kernel=e.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]}).setOutput(this.output),this.kernel(this))}},{key:"delete",value:function(){return this.webGl.deleteTexture(this.texture)}}]),r}();
},{}],"y5hZ":[function(require,module,exports) {
"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=require("./utils-core"),i=require("./input"),a=require("./texture"),l=/function ([^(]*)/,f=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,c=/([^\s,]+)/g,s=function(){var e=new ArrayBuffer(4),t=new Uint32Array(e),n=new Uint8Array(e);if(t[0]=3735928559,239===n[0])return"LE";if(222===n[0])return"BE";throw new Error("unknown endianness")}(),y=null,p=null,v=function(){try{return new Function("let i = 1; const j = 1;")(),!0}catch(e){return!1}}(),d=null,h=function(h){function m(){return n(this,m),r(this,(m.__proto__||Object.getPrototypeOf(m)).apply(this,arguments))}return o(m,u),t(m,null,[{key:"systemEndianness",value:function(){return s}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isFunctionString",value:function(e){return null!==e&&"function"===e.toString().slice(0,"function".length).toLowerCase()}},{key:"getFunctionNameFromString",value:function(e){return l.exec(e)[1]}},{key:"getFunctionBodyFromString",value:function(e){return e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))}},{key:"getParamNamesFromString",value:function(e){var t=e.toString().replace(f,""),n=t.slice(t.indexOf("(")+1,t.indexOf(")")).match(c);return null===n&&(n=[]),n}},{key:"clone",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":e(t))||t.hasOwnProperty("isActiveClone"))return t;var n=t.constructor();for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(t.isActiveClone=null,n[r]=m.clone(t[r]),delete t.isActiveClone);return n}},{key:"newPromise",value:function(e){var t=Promise||small_promise;if(null===t)throw TypeError("Browser is missing Promise implementation. Consider adding small_promise.js polyfill");return new t(e)}},{key:"functionBinder",value:function(e,t){return e.bind?e.bind(t):function(){var n=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return e.apply(t,n)}}},{key:"isArray",value:function(e){return!isNaN(e.length)}},{key:"getArgumentType",value:function(e){return m.isArray(e)?"IMG"===e[0].nodeName?"HTMLImageArray":"Array":"number"==typeof e?Number.isInteger(e)?"Integer":"Float":e instanceof a?e.type:e instanceof i?"Input":"IMG"===e.nodeName?"HTMLImage":"Unknown"}},{key:"isFloatReadPixelsSupported",value:function(){if(null!==y)return y;var e=new(require("../index"))({mode:"webgl-validator"}),t=e.createKernel(function(){return 1},{output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0})();return y=1===t[0],e.destroy(),y}},{key:"isFloatReadPixelsSupportedWebGL2",value:function(){if(null!==p)return p;var e=new(require("../index"))({mode:"webgl2-validator"}),t=e.createKernel(function(){return 1},{output:[2],floatTextures:!0,floatOutput:!0,floatOutputForce:!0})();return p=1===t[0],e.destroy(),p}},{key:"hasIntegerDivisionAccuracyBug",value:function(){if(null!==d)return d;var e=new(require("../index"))({mode:"webgl-validator"}),t=e.createKernel(function(e,t){return e[this.thread.x]/t[this.thread.x]},{output:[1]})([6,6030401],[3,3991]);return d=2!==t[0]||1511!==t[1],e.destroy(),d}},{key:"isMixedIdentifiersSupported",value:function(){return v}},{key:"dimToTexSize",value:function(e,t,n){for(var r=t[0],o=t[0],u=t[1],i=1;i<t.length;i++)r*=t[i];if(!e.floatTextures||n&&!e.floatOutput||(o=r=Math.ceil(r/4)),u>1&&o*u===r)return[o,u];for(var a=Math.sqrt(r),l=Math.ceil(a),f=Math.floor(a);l*f>r;)l--,f=Math.ceil(r/l);return[o=f,u=Math.ceil(r/o)]}},{key:"getDimensions",value:function(e,t){var n=void 0;if(m.isArray(e)){for(var r=[],o=e;m.isArray(o);)r.push(o.length),o=o[0];n=r.reverse()}else if(e instanceof a)n=e.output;else{if(!(e instanceof i))throw"Unknown dimensions of "+e;n=e.size}if(t)for(n=m.clone(n);n.length<3;)n.push(1);return new Int32Array(n)}},{key:"pad",value:function(e,t){function n(e){return Array.apply(null,new Array(e)).map(Number.prototype.valueOf,0)}for(var r=e.length+2*t,o=e.map(function(e){return[].concat(n(t),e,n(t))}),u=0;u<t;u++)o=[].concat([n(r)],o,[n(r)]);return o}},{key:"flatten2dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)t.set(e[r],n),n+=e[r].length}},{key:"flatten3dArrayTo",value:function(e,t){for(var n=0,r=0;r<e.length;r++)for(var o=0;o<e[r].length;o++)t.set(e[r][o],n),n+=e[r][o].length}},{key:"flattenTo",value:function(e,t){m.isArray(e[0])?m.isArray(e[0][0])?m.flatten3dArrayTo(e,t):m.flatten2dArrayTo(e,t):t.set(e)}},{key:"splitArray",value:function(e,t){for(var n=[],r=0;r<e.length;r+=t)n.push(new e.constructor(e.buffer,4*r+e.byteOffset,t));return n}},{key:"getAstString",value:function(e,t){var n=Array.isArray(e)?e:e.split(/\r?\n/g),r=t.loc.start,o=t.loc.end,u=[];u.push(n[r.line-1].slice(r.column));for(var i=r.line;i<o.line-1;i++)u.push(n[i]);return u.push(n[o.line-1].slice(0,o.column)),u.join("\n")}},{key:"allPropertiesOf",value:function(e){var t=[];do{t.push.apply(t,Object.getOwnPropertyNames(e))}while(e=Object.getPrototypeOf(e));return t}}]),m}();Object.assign(h,u),module.exports=h;
},{"./utils-core":"MFbY","./input":"Q3WB","./texture":"34im","../index":"dc+G"}],"EzOd":[function(require,module,exports) {
"use strict";var n=require("../core/utils");module.exports=function(e){var r=function(){return e.run.apply(e,arguments)};return n.allPropertiesOf(e).forEach(function(n){"_"===n[0]&&"_"===n[1]||("function"==typeof e[n]?r[n]="add"===n.substring(0,3)||"set"===n.substring(0,3)?function(){return e[n].apply(e,arguments),r}:e[n].bind(e):(r.__defineGetter__(n,function(){return e[n]}),r.__defineSetter__(n,function(r){e[n]=r})))}),r.kernel=e,r};
},{"../core/utils":"y5hZ"}],"nVRz":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var t=require("../core/utils"),r=require("./kernel-run-shortcut");module.exports=function(){function i(e,r){n(this,i),r=r||{},this.kernel=r.kernel,this.canvas=r.canvas,this.webGl=r.webGl,this.fn=null,this.functionBuilder=e,this.fnString=null,this.endianness=t.systemEndianness()}return e(i,[{key:"textureToArray",value:function(e){return this.createKernel(function(e){return e[this.thread.z][this.thread.y][this.thread.x]})(e)}},{key:"deleteTexture",value:function(e){this.webGl.deleteTexture(e.texture)}},{key:"buildPromiseKernel",value:function(){throw new Error("not yet implemented")}},{key:"getMode",value:function(){throw new Error('"mode" not implemented on BaseRunner')}},{key:"buildKernel",value:function(e,n){n=Object.assign({},n||{});var t=e.toString();return n.functionBuilder||(n.functionBuilder=this.functionBuilder),n.canvas||(n.canvas=this.canvas),n.webGl||(n.webGl=this.webgl),r(new this.Kernel(t,n))}}]),i}();
},{"../core/utils":"y5hZ","./kernel-run-shortcut":"EzOd"}],"NzEZ":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,n,s){return n&&t(e.prototype,n),s&&t(e,s),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=require("../core/utils"),s=require("../core/input");module.exports=function(){function u(t,s){for(var i in e(this,u),this.paramNames=n.getParamNamesFromString(t),this.fnString=t,this.output=null,this.debug=!1,this.graphical=!1,this.loopMaxIterations=0,this.constants=null,this.wraparound=null,this.hardcodeConstants=null,this.outputToTexture=null,this.outputImmutable=null,this.texSize=null,this._canvas=null,this._webGl=null,this.threadDim=null,this.floatTextures=null,this.floatOutput=null,this.floatOutputForce=null,this.addFunction=null,this.functions=null,this.nativeFunctions=null,this.subKernels=null,this.subKernelProperties=null,this.subKernelNames=null,this.subKernelOutputVariableNames=null,this.functionBuilder=null,this.paramTypes=null,this.paramSizes=null,this.constantTypes=null,this.fixIntegerDivisionAccuracy=null,s)s.hasOwnProperty(i)&&this.hasOwnProperty(i)&&(this[i]=s[i]);s.hasOwnProperty("canvas")&&(this._canvas=s.canvas),s.hasOwnProperty("webGl")&&(this._webGl=s.webGl),s.hasOwnProperty("output")&&this.setOutput(s.output),this._canvas||(this._canvas=n.initCanvas())}return t(u,[{key:"build",value:function(){throw new Error('"build" not defined on Base')}},{key:"setupParams",value:function(t){this.paramTypes=[],this.paramSizes=[];for(var e=0;e<t.length;e++){var u=t[e];this.paramTypes.push(n.getArgumentType(u)),this.paramSizes.push(u.constructor===s?u.size:null)}}},{key:"setupConstants",value:function(){if(this.constantTypes={},this.constants)for(var t in this.constants)this.constantTypes[t]=n.getArgumentType(this.constants[t])}},{key:"setFunctions",value:function(t){return this.functions=t,this}},{key:"setOutput",value:function(t){return t.hasOwnProperty("x")?t.hasOwnProperty("y")?t.hasOwnProperty("z")?this.output=[t.x,t.y,t.z]:this.output=[t.x,t.y]:this.output=[t.x]:this.output=t,this}},{key:"setDebug",value:function(t){return this.debug=t,this}},{key:"setGraphical",value:function(t){return this.graphical=t,this}},{key:"setLoopMaxIterations",value:function(t){return this.loopMaxIterations=t,this}},{key:"setFixIntegerDivisionAccuracy",value:function(t){return this.fixIntegerDivisionAccuracy=t,this}},{key:"setConstants",value:function(t){return this.constants=t,this}},{key:"setWraparound",value:function(t){return console.warn("Wraparound mode is not supported and undocumented."),this.wraparound=t,this}},{key:"setHardcodeConstants",value:function(t){return this.hardcodeConstants=t,this}},{key:"setOutputToTexture",value:function(t){return this.outputToTexture=t,this}},{key:"setOutputImmutable",value:function(t){return this.outputImmutable=t,this}},{key:"setFloatTextures",value:function(t){return this.floatTextures=t,this}},{key:"setFloatOutput",value:function(t){return this.floatOutput=t,this}},{key:"setFloatOutputForce",value:function(t){return this.floatOutputForce=t,this}},{key:"setCanvas",value:function(t){return this._canvas=t,this}},{key:"setWebGl",value:function(t){return this._webGl=t,this}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}},{key:"validateOptions",value:function(){throw new Error("validateOptions not defined")}},{key:"exec",value:function(){return this.execute.apply(this,arguments)}},{key:"execute",value:function(){var t=this,e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);return n.newPromise(function(n,s){try{n(t.run.apply(t,e))}catch(u){s(u)}})}},{key:"addSubKernel",value:function(t){return null===this.subKernels&&(this.subKernels=[],this.subKernelNames=[]),this.subKernels.push(t),this.subKernelNames.push(n.getFunctionNameFromString(t)),this}},{key:"addSubKernelProperty",value:function(t,e){if(null===this.subKernelProperties&&(this.subKernelProperties={},this.subKernelNames=[]),this.subKernelProperties.hasOwnProperty(t))throw new Error("cannot add sub kernel "+t+", already defined");return this.subKernelProperties[t]=e,this.subKernelNames.push(n.getFunctionNameFromString(e)),this}},{key:"addNativeFunction",value:function(t,e){this.functionBuilder.addNativeFunction(t,e)}},{key:"destroy",value:function(){}}]),u}();
},{"../core/utils":"y5hZ","../core/input":"Q3WB"}],"natt":[function(require,module,exports) {
"use strict";module.exports="__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst float LOOP_MAX = __LOOP_MAX__;\n\n__CONSTANTS__;\n\nvarying vec2 vTexCoord;\n\nvec4 round(vec4 x) {\n  return floor(x + 0.5);\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x / y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nvec4 encode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nfloat decode(vec4 rgba, int x, int bitRatio) {\n  if (bitRatio == 1) {\n    return decode32(rgba);\n  }\n  __DECODE32_ENDIANNESS__;\n  int channel = integerMod(x, bitRatio);\n  if (bitRatio == 4) {\n    if (channel == 0) return rgba.r * 255.0;\n    if (channel == 1) return rgba.g * 255.0;\n    if (channel == 2) return rgba.b * 255.0;\n    if (channel == 3) return rgba.a * 255.0;\n  }\n  else {\n    if (channel == 0) return rgba.r * 255.0 + rgba.g * 65280.0;\n    if (channel == 1) return rgba.b * 255.0 + rgba.a * 65280.0;\n  }\n}\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio,  int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  vec4 texel = texture2D(tex, st / vec2(texSize));\n  __GET_RESULT__;\n  \n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture2D(tex, st / vec2(texSize));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int y, int x) {\n  return get(tex, texSize, texDim, bitRatio, int(0), y, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int y, int x) {\n  return getImage2D(tex, texSize, texDim, int(0), y, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int x) {\n  return get(tex, texSize, texDim, bitRatio, int(0), int(0), x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int x) {\n  return getImage2D(tex, texSize, texDim, int(0), int(0), x);\n}\n\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\nvoid color(sampler2D image) {\n  actualColor = texture2D(image, vTexCoord);\n}\n\n__MAIN_PARAMS__;\n__MAIN_CONSTANTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}";
},{}],"Z/A7":[function(require,module,exports) {
"use strict";module.exports="precision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nattribute vec2 aPos;\nattribute vec2 aTexCoord;\n\nvarying vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}";
},{}],"FRV+":[function(require,module,exports) {
"use strict";var t=require("../../core/utils"),n=require("../kernel-run-shortcut"),e=require("../../core/input"),r=require("../../core/texture");function i(t){return/^function /.test(t)&&(t=t.substring(9)),t.replace(/[_]typeof/g,"typeof")}function s(t){return t.replace(/[_]typeof/g,"typeof")}module.exports=function(e,r){return"() => {\n    "+n.toString()+";\n    const utils = {\n      allPropertiesOf: "+s(t.allPropertiesOf.toString())+",\n      clone: "+s(t.clone.toString())+",\n      splitArray: "+s(t.splitArray.toString())+",\n      getArgumentType: "+s(t.getArgumentType.toString())+",\n      getDimensions: "+s(t.getDimensions.toString())+",\n      dimToTexSize: "+s(t.dimToTexSize.toString())+",\n      flattenTo: "+s(t.flattenTo.toString())+",\n      flatten2dArrayTo: "+s(t.flatten2dArrayTo.toString())+",\n      flatten3dArrayTo: "+s(t.flatten3dArrayTo.toString())+",\n      systemEndianness: '"+s(t.systemEndianness())+"',\n      initWebGl: "+s(t.initWebGl.toString())+",\n      isArray: "+s(t.isArray.toString())+",\n      checkOutput: "+s(t.checkOutput.toString())+"\n    };\n    const Utils = utils;\n    const canvases = [];\n    const maxTexSizes = {};\n    let Texture = function() {};\n    let Input = function() {}; \n    class "+(r||"Kernel")+" {\n      constructor() {\n        this.maxTexSize = null;\n        this.argumentsLength = 0;\n        this.constantsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.program = null;\n        this.outputToTexture = "+(e.outputToTexture?"true":"false")+";\n        this.paramNames = "+JSON.stringify(e.paramNames)+";\n        this.paramTypes = "+JSON.stringify(e.paramTypes)+";\n        this.texSize = "+JSON.stringify(e.texSize)+";\n        this.output = "+JSON.stringify(e.output)+";\n        this.compiledFragShaderString = `"+e.compiledFragShaderString+"`;\n\t\t    this.compiledVertShaderString = `"+e.compiledVertShaderString+"`;\n\t\t    this.programUniformLocationCache = {};\n\t\t    this.textureCache = {};\n\t\t    this.subKernelOutputTextures = null;\n\t\t    this.subKernelOutputVariableNames = null;\n\t\t    this.uniform1fCache = {};\n\t\t    this.uniform1iCache = {};\n\t\t    this.uniform2fCache = {};\n\t\t    this.uniform2fvCache = {};\n\t\t    this.uniform2ivCache = {};\n\t\t    this.uniform3fvCache = {};\n\t\t    this.uniform3ivCache = {};\n      }\n      _getFragShaderString() { return this.compiledFragShaderString; }\n      _getVertShaderString() { return this.compiledVertShaderString; }\n      validateOptions() {}\n      setupParams() {}\n      setupConstants() {}\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      setTexture(Type) { Texture = Type; }\n      setInput(Type) { Input = Type; }\n      "+i(e.getUniformLocation.toString())+"\n      "+i(e.build.toString())+"\n\t\t  "+i(e.run.toString())+"\n\t\t  "+i(e._addArgument.toString())+"\n\t\t  "+i(e._formatArrayTransfer.toString())+"\n\t\t  "+i(e.getArgumentTexture.toString())+"\n\t\t  "+i(e.getTextureCache.toString())+"\n\t\t  "+i(e.getOutputTexture.toString())+"\n\t\t  "+i(e.renderOutput.toString())+"\n\t\t  "+i(e.updateMaxTexSize.toString())+"\n\t\t  "+i(e._setupOutputTexture.toString())+"\n\t\t  "+i(e.detachTextureCache.toString())+"\n\t\t  "+i(e.setUniform1f.toString())+"\n\t\t  "+i(e.setUniform1i.toString())+"\n\t\t  "+i(e.setUniform2f.toString())+"\n\t\t  "+i(e.setUniform2fv.toString())+"\n\t\t  "+i(e.setUniform2iv.toString())+"\n\t\t  "+i(e.setUniform3fv.toString())+"\n\t\t  "+i(e.setUniform3iv.toString())+"\n    };\n    return kernelRunShortcut(new Kernel());\n  };"};
},{"../../core/utils":"y5hZ","../kernel-run-shortcut":"EzOd","../../core/input":"Q3WB","../../core/texture":"34im"}],"xtMz":[function(require,module,exports) {
"use strict";var t=function t(e,r,i){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,r);if(void 0===n){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,r,i)}if("value"in n)return n.value;var s=n.get;return void 0!==s?s.call(i):void 0},e=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=require("../kernel-base"),s=require("../../core/utils"),u=require("../../core/texture"),o=require("./shader-frag"),h=require("./shader-vert"),l=require("./kernel-string"),f=[],T={};module.exports=function(c){function E(t,e){r(this,E);var n=i(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,t,e));return n.textureCache={},n.threadDim={},n.programUniformLocationCache={},n.framebuffer=null,n.buffer=null,n.program=null,n.outputToTexture=e.outputToTexture,n.endianness=s.systemEndianness(),n.subKernelOutputTextures=null,n.subKernelOutputVariableNames=null,n.argumentsLength=0,n.constantsLength=0,n.compiledFragShaderString=null,n.compiledVertShaderString=null,n.fragShader=null,n.vertShader=null,n.drawBuffersMap=null,n.outputTexture=null,n.maxTexSize=null,n.uniform1fCache={},n.uniform1iCache={},n.uniform2fCache={},n.uniform2fvCache={},n.uniform2ivCache={},n.uniform3fvCache={},n.uniform3ivCache={},n._webGl||(n._webGl=n.initWebGl()),n}return n(E,a),e(E,null,[{key:"fragShaderString",get:function(){return o}},{key:"vertShaderString",get:function(){return h}}]),e(E,[{key:"initWebGl",value:function(){return s.initWebGl(this.getCanvas())}},{key:"validateOptions",value:function(){var t=s.isFloatReadPixelsSupported();if(!0===this.floatTextures&&!s.OES_texture_float)throw new Error("Float textures are not supported on this browser");if(!0===this.floatOutput&&!0!==this.floatOutputForce&&!t)throw new Error("Float texture outputs are not supported on this browser");void 0===this.floatTextures&&s.OES_texture_float&&(this.floatTextures=!0,this.floatOutput=t);var e=s.hasIntegerDivisionAccuracyBug();if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=e:this.fixIntegerDivisionAccuracy&&!e&&(this.fixIntegerDivisionAccuracy=!1),s.checkOutput(this.output),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var r=s.getArgumentType(arguments[0]);if("Array"===r)this.output=s.getDimensions(r);else{if("NumberTexture"!==r&&"ArrayTexture(4)"!==r)throw new Error("Auto output not supported for input type: "+r);this.output=arguments[0].output}}if(this.texSize=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=s.clone(this.output)}else void 0===this.floatOutput&&s.OES_texture_float&&(this.floatOutput=!0)}},{key:"updateMaxTexSize",value:function(){var t=this.texSize,e=this._canvas;if(null===this.maxTexSize){var r=f.indexOf(e);-1===r&&(r=f.length,f.push(e),T[r]=[t[0],t[1]]),this.maxTexSize=T[r]}this.maxTexSize[0]<t[0]&&(this.maxTexSize[0]=t[0]),this.maxTexSize[1]<t[1]&&(this.maxTexSize[1]=t[1])}},{key:"build",value:function(){this.validateOptions(),this.setupConstants(),this.setupParams(arguments),this.updateMaxTexSize();var t=this.texSize,e=this._webGl,r=this._canvas;e.enable(e.SCISSOR_TEST),e.viewport(0,0,this.maxTexSize[0],this.maxTexSize[1]),r.width=this.maxTexSize[0],r.height=this.maxTexSize[1];for(var i=this.threadDim=s.clone(this.output);i.length<3;)i.push(1);this.functionBuilder&&this._addKernels();var n=this._getVertShaderString(arguments),a=e.createShader(e.VERTEX_SHADER);e.shaderSource(a,n),e.compileShader(a),this.vertShader=a;var u=this._getFragShaderString(arguments),o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,u),e.compileShader(o),this.fragShader=o,!e.getShaderParameter(a,e.COMPILE_STATUS))throw console.log(n),console.error("An error occurred compiling the shaders: "+e.getShaderInfoLog(a)),new Error("Error compiling vertex shader");if(!e.getShaderParameter(o,e.COMPILE_STATUS))throw console.log(u),console.error("An error occurred compiling the shaders: "+e.getShaderInfoLog(o)),new Error("Error compiling fragment shader");this.debug&&(console.log("Options:"),console.dir(this),console.log("GLSL Shader Output:"),console.log(u));var h=this.program=e.createProgram();e.attachShader(h,a),e.attachShader(h,o),e.linkProgram(h),this.framebuffer=e.createFramebuffer(),this.framebuffer.width=t[0],this.framebuffer.height=t[1];var l=new Float32Array([-1,-1,1,-1,-1,1,1,1]),f=new Float32Array([0,0,1,0,0,1,1,1]),T=l.byteLength,c=this.buffer;c?e.bindBuffer(e.ARRAY_BUFFER,c):(c=this.buffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,c),e.bufferData(e.ARRAY_BUFFER,l.byteLength+f.byteLength,e.STATIC_DRAW)),e.bufferSubData(e.ARRAY_BUFFER,0,l),e.bufferSubData(e.ARRAY_BUFFER,T,f);var E=e.getAttribLocation(this.program,"aPos");e.enableVertexAttribArray(E),e.vertexAttribPointer(E,2,e.FLOAT,e.FALSE,0,0);var _=e.getAttribLocation(this.program,"aTexCoord");for(var m in e.enableVertexAttribArray(_),e.vertexAttribPointer(_,2,e.FLOAT,e.FALSE,0,T),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),this.constants){var g=this.constants[m],p=s.getArgumentType(g);"Float"!==p&&"Integer"!==p&&(e.useProgram(this.program),this._addConstant(this.constants[m],p,m),this.constantsLength++)}this.outputImmutable||(this._setupOutputTexture(),null!==this.subKernelOutputVariableNames&&this.subKernelOutputVariableNames.length>0&&this._setupSubOutputTextures(this.subKernelOutputVariableNames.length))}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var t=this.paramNames,e=this.paramTypes,r=this.texSize,i=this._webGl;i.useProgram(this.program),i.scissor(0,0,r[0],r[1]),this.hardcodeConstants||(this.setUniform3iv("uOutputDim",this.threadDim),this.setUniform2iv("uTexSize",r)),this.setUniform2f("ratio",r[0]/this.maxTexSize[0],r[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var n=0;n<t.length;n++)this._addArgument(arguments[n],e[n],t[n]);if(this.graphical)return this.outputToTexture?(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.outputImmutable||this._setupOutputTexture(),i.drawArrays(i.TRIANGLE_STRIP,0,4),new u(this.outputTexture,r,this.threadDim,this.output,this._webGl,"ArrayTexture(4)")):(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),void i.drawArrays(i.TRIANGLE_STRIP,0,4));i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var a=this.outputTexture;if(null!==this.subKernelOutputVariableNames&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernelOutputVariableNames.length)),this.drawBuffers.drawBuffersWEBGL(this.drawBuffersMap)),i.drawArrays(i.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures){if(null!==this.subKernels){var s=[];s.result=this.renderOutput(a);for(var o=0;o<this.subKernels.length;o++)s.push(new u(this.subKernelOutputTextures[o],r,this.threadDim,this.output,this._webGl));return s}if(null!==this.subKernelProperties){var h={result:this.renderOutput(a)},l=0;for(var f in this.subKernelProperties)this.subKernelProperties.hasOwnProperty(f)&&(h[f]=new u(this.subKernelOutputTextures[l],r,this.threadDim,this.output,this._webGl),l++);return h}}return this.renderOutput(a)}},{key:"renderOutput",value:function(t){var e=this.texSize,r=this._webGl,i=this.threadDim,n=this.output;if(this.outputToTexture)return new u(t,e,this.threadDim,n,this._webGl);var a=void 0;if(this.floatOutput){var o=e[0],h=Math.ceil(e[1]/4);a=new Float32Array(o*h*4),r.readPixels(0,0,o,h,r.RGBA,r.FLOAT,a)}else{var l=new Uint8Array(e[0]*e[1]*4);r.readPixels(0,0,e[0],e[1],r.RGBA,r.UNSIGNED_BYTE,l),a=new Float32Array(l.buffer)}return a=a.subarray(0,i[0]*i[1]*i[2]),1===n.length?a:2===n.length?s.splitArray(a,n[0]):3===n.length?s.splitArray(a,n[0]*n[1]).map(function(t){return s.splitArray(t,n[0])}):void 0}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var t=this._webGl,e=this.texSize,r=this.outputTexture=this._webGl.createTexture();t.activeTexture(t.TEXTURE0+this.constantsLength+this.paramNames.length),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}},{key:"_setupSubOutputTextures",value:function(t){for(var e=this._webGl,r=this.texSize,i=this.drawBuffersMap=[e.COLOR_ATTACHMENT0],n=this.subKernelOutputTextures=[],a=0;a<t;a++){var s=this._webGl.createTexture();n.push(s),i.push(e.COLOR_ATTACHMENT0+a+1),e.activeTexture(e.TEXTURE0+this.constantsLength+this.paramNames.length+a),e.bindTexture(e.TEXTURE_2D,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r[0],r[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r[0],r[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+a+1,e.TEXTURE_2D,s,0)}}},{key:"getArgumentTexture",value:function(t){return this.getTextureCache("ARGUMENT_"+t)}},{key:"getTextureCache",value:function(t){return this.textureCache.hasOwnProperty(t)?this.textureCache[t]:this.textureCache[t]=this._webGl.createTexture()}},{key:"detachTextureCache",value:function(t){delete this.textureCache[t]}},{key:"setUniform1f",value:function(t,e){if(this.uniform1fCache.hasOwnProperty(t)&&e===this.uniform1fCache[t])return;this.uniform1fCache[t]=e;var r=this.getUniformLocation(t);this._webGl.uniform1f(r,e)}},{key:"setUniform1i",value:function(t,e){if(this.uniform1iCache.hasOwnProperty(t)&&e===this.uniform1iCache[t])return;this.uniform1iCache[t]=e;var r=this.getUniformLocation(t);this._webGl.uniform1i(r,e)}},{key:"setUniform2f",value:function(t,e,r){if(this.uniform2fCache.hasOwnProperty(t)){var i=this.uniform2fCache[t];if(e===i[0]&&r===i[1])return}this.uniform2fCache[t]=[e,r];var n=this.getUniformLocation(t);this._webGl.uniform2f(n,e,r)}},{key:"setUniform2fv",value:function(t,e){if(this.uniform2fvCache.hasOwnProperty(t)){var r=this.uniform2fvCache[t];if(e[0]===r[0]&&e[1]===r[1])return}this.uniform2fvCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform2fv(i,e)}},{key:"setUniform2iv",value:function(t,e){if(this.uniform2ivCache.hasOwnProperty(t)){var r=this.uniform2ivCache[t];if(e[0]===r[0]&&e[1]===r[1])return}this.uniform2ivCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform2iv(i,e)}},{key:"setUniform3fv",value:function(t,e){if(this.uniform3fvCache.hasOwnProperty(t)){var r=this.uniform3fvCache[t];if(e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2])return}this.uniform3fvCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform3fv(i,e)}},{key:"setUniform3iv",value:function(t,e){if(this.uniform3ivCache.hasOwnProperty(t)){var r=this.uniform3ivCache[t];if(e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2])return}this.uniform3ivCache[t]=e;var i=this.getUniformLocation(t);this._webGl.uniform3iv(i,e)}},{key:"getUniformLocation",value:function(t){return this.programUniformLocationCache.hasOwnProperty(t)?this.programUniformLocationCache[t]:this.programUniformLocationCache[t]=this._webGl.getUniformLocation(this.program,t)}},{key:"_getFragShaderArtifactMap",value:function(t){return{HEADER:this._getHeaderString(),LOOP_MAX:this._getLoopMaxString(),CONSTANTS:this._getConstantsString(),DECODE32_ENDIANNESS:this._getDecode32EndiannessString(),ENCODE32_ENDIANNESS:this._getEncode32EndiannessString(),DIVIDE_WITH_INTEGER_CHECK:this._getDivideWithIntegerCheckString(),GET_WRAPAROUND:this._getGetWraparoundString(),GET_TEXTURE_CHANNEL:this._getGetTextureChannelString(),GET_TEXTURE_INDEX:this._getGetTextureIndexString(),GET_RESULT:this._getGetResultString(),MAIN_PARAMS:this._getMainParamsString(t),MAIN_CONSTANTS:this._getMainConstantsString(),KERNEL:this._getKernelString(),MAIN_RESULT:this._getMainResultString()}}},{key:"_addArgument",value:function(t,e,r){var i=this._webGl,n=this.getArgumentTexture(r);switch(t instanceof u&&(e=t.type),e){case"Array":case"Array(2)":case"Array(3)":case"Array(4)":case"Array2D":case"Array3D":var a=s.getDimensions(t,!0),o=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},a);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],l=this._formatArrayTransfer(t,h),f=l.valuesFlat,T=l.bitRatio,c=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0],o[1],0,i.RGBA,i.FLOAT,f):(c=new Uint8Array(f.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/T,o[1],0,i.RGBA,i.UNSIGNED_BYTE,c)),this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",a),this.setUniform2iv("user_"+r+"Size",o)),this.setUniform1i("user_"+r+"BitRatio",T),this.setUniform1i("user_"+r,this.argumentsLength);break;case"Integer":case"Float":case"Number":this.setUniform1f("user_"+r,t);break;case"Input":var E=t.size,_=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},E);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var m=_[0]*_[1],g=this._formatArrayTransfer(t.value,m),p=g.valuesFlat,d=g.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0],_[1],0,i.RGBA,i.FLOAT,inputArray);else{var x=new Uint8Array(p.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0]/d,_[1],0,i.RGBA,i.UNSIGNED_BYTE,x)}this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",E),this.setUniform2iv("user_"+r+"Size",_)),this.setUniform1i("user_"+r+"BitRatio",d),this.setUniform1i("user_"+r,this.argumentsLength);break;case"HTMLImage":var R=t,v=[R.width,R.height,1],b=[R.width,R.height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var A=i.RGBA,S=i.RGBA,U=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,A,S,U,R),this.setUniform3iv("user_"+r+"Dim",v),this.setUniform2iv("user_"+r+"Size",b),this.setUniform1i("user_"+r,this.argumentsLength);break;case"ArrayTexture(4)":case"NumberTexture":var y=t,D=y.dimensions,O=y.size;i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,y.texture),this.setUniform3iv("user_"+r+"Dim",D),this.setUniform2iv("user_"+r+"Size",O),this.setUniform1i("user_"+r+"BitRatio",1),this.setUniform1i("user_"+r,this.argumentsLength);break;default:throw new Error("Input type not supported (WebGL): "+t)}this.argumentsLength++}},{key:"_addConstant",value:function(t,e,r){var i=this._webGl,n=this.getArgumentTexture(r);switch(t instanceof u&&(e=t.type),e){case"Array":var a=s.getDimensions(t,!0),o=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},a);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],l=this._formatArrayTransfer(t,h),f=l.valuesFlat,T=l.bitRatio,c=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0],o[1],0,i.RGBA,i.FLOAT,f):(c=new Uint8Array(f.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/T,o[1],0,i.RGBA,i.UNSIGNED_BYTE,c)),this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",a),this.setUniform2iv("constants_"+r+"Size",o)),this.setUniform1i("constants_"+r+"BitRatio",T),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Input":var E=t.size,_=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},E);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var m=_[0]*_[1],g=this._formatArrayTransfer(t.value,m),p=g.valuesFlat,d=g.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0],_[1],0,i.RGBA,i.FLOAT,inputArray);else{var x=new Uint8Array(p.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,_[0]/d,_[1],0,i.RGBA,i.UNSIGNED_BYTE,x)}this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",E),this.setUniform2iv("constants_"+r+"Size",_)),this.setUniform1i("constants_"+r+"BitRatio",d),this.setUniform1i("constants_"+r,this.constantsLength);break;case"HTMLImage":var R=t,v=[R.width,R.height,1],b=[R.width,R.height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var A=i.RGBA,S=i.RGBA,U=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,A,S,U,R),this.setUniform3iv("constants_"+r+"Dim",v),this.setUniform2iv("constants_"+r+"Size",b),this.setUniform1i("constants_"+r,this.constantsLength);break;case"ArrayTexture(4)":case"NumberTexture":var y=t,D=y.dimensions,O=y.size;i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,y.texture),this.setUniform3iv("constants_"+r+"Dim",D),this.setUniform2iv("constants_"+r+"Size",O),this.setUniform1i("constants_"+r+"BitRatio",1),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Integer":case"Float":default:throw new Error("Input type not supported (WebGL): "+t)}}},{key:"_formatArrayTransfer",value:function(t,e){var r=1,i=t;if(s.isArray(t[0])||this.floatTextures)i=new Float32Array(e),s.flattenTo(t,i);else switch(t.constructor){case Uint8Array:case Int8Array:r=4;break;case Uint16Array:case Int16Array:r=2;case Float32Array:case Int32Array:break;default:i=new Float32Array(e),s.flattenTo(t,i)}return{bitRatio:r,valuesFlat:i}}},{key:"_getHeaderString",value:function(){return null!==this.subKernels||null!==this.subKernelProperties?"#extension GL_EXT_draw_buffers : require\n":""}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+".0;\n":" 1000.0;\n"}},{key:"_getConstantsString",value:function(){var t=[],e=this.threadDim,r=this.texSize;return this.hardcodeConstants?t.push("ivec3 uOutputDim = ivec3("+e[0]+","+e[1]+", "+e[2]+")","ivec2 uTexSize = ivec2("+r[0]+", "+r[1]+")"):t.push("uniform ivec3 uOutputDim","uniform ivec2 uTexSize"),this._linesToString(t)}},{key:"_getTextureCoordinate",value:function(){var t=this.subKernelOutputVariableNames;return null===t||t.length<1?"varying vec2 vTexCoord;\n":"out vec2 vTexCoord;\n"}},{key:"_getDecode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getEncode32EndiannessString",value:function(){return"LE"===this.endianness?"":"  rgba.rgba = rgba.abgr;\n"}},{key:"_getDivideWithIntegerCheckString",value:function(){return this.fixIntegerDivisionAccuracy?"\n\t\t\t  float div_with_int_check(float x, float y) {\n\t\t\t  if (floor(x) == x && floor(y) == y && integerMod(x, y) == 0.0) {\n\t\t\t    return float(int(x)/int(y));\n\t\t\t  }\n\t\t\t  return x / y;\n\t\t\t}\n\t\t\t":""}},{key:"_getGetWraparoundString",value:function(){return this.wraparound?"  xyz = mod(xyz, texDim);\n":""}},{key:"_getGetTextureChannelString",value:function(){return this.floatTextures?this._linesToString(["  int channel = integerMod(index, 4)","  index = index / 4"]):""}},{key:"_getGetTextureIndexString",value:function(){return this.floatTextures?"  index = index / 4;\n":""}},{key:"_getGetResultString",value:function(){return this.floatTextures?this._linesToString(["  if (channel == 0) return texel.r","  if (channel == 1) return texel.g","  if (channel == 2) return texel.b","  if (channel == 3) return texel.a"]):"  return decode(texel, x, bitRatio);"}},{key:"_getMainParamsString",value:function(t){for(var e=[],r=this.paramTypes,i=this.paramNames,n=0;n<i.length;n++){var a=t[n],u=i[n],o=r[n];if(this.hardcodeConstants)if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o){var h=s.getDimensions(a,!0),l=s.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},h);e.push("uniform sampler2D user_"+u,"ivec2 user_"+u+"Size = ivec2("+l[0]+", "+l[1]+")","ivec3 user_"+u+"Dim = ivec3("+h[0]+", "+h[1]+", "+h[2]+")","uniform int user_"+u+"BitRatio")}else"Integer"===o?e.push("float user_"+u+" = "+a+".0"):"Float"===o&&e.push("float user_"+u+" = "+a);else if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o||"Input"===o||"HTMLImage"===o)e.push("uniform sampler2D user_"+u,"uniform ivec2 user_"+u+"Size","uniform ivec3 user_"+u+"Dim"),"HTMLImage"!==o&&e.push("uniform int user_"+u+"BitRatio");else{if("Integer"!==o&&"Float"!==o)throw new Error("Param type "+o+" not supported in WebGL, only WebGL2");e.push("uniform float user_"+u)}}return this._linesToString(e)}},{key:"_getMainConstantsString",value:function(){var t=[];if(this.constants)for(var e in this.constants)if(this.constants.hasOwnProperty(e)){var r=this.constants[e],i=s.getArgumentType(r);switch(i){case"Integer":t.push("const float constants_"+e+" = "+parseInt(r)+".0");break;case"Float":t.push("const float constants_"+e+" = "+parseFloat(r));break;case"Array":case"Input":case"HTMLImage":case"NumberTexture":case"ArrayTexture(4)":t.push("uniform sampler2D constants_"+e,"uniform ivec2 constants_"+e+"Size","uniform ivec3 constants_"+e+"Dim","uniform int constants_"+e+"BitRatio");break;default:throw new Error("Unsupported constant "+e+" type "+i)}}return this._linesToString(t)}},{key:"_getKernelString",value:function(){var t=[],e=this.subKernelOutputVariableNames;if(null!==e){t.push("float kernelResult = 0.0");for(var r=0;r<e.length;r++)t.push("float "+e[r]+" = 0.0")}else t.push("float kernelResult = 0.0");return this._linesToString(t)+this.functionBuilder.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var t=this.subKernelOutputVariableNames,e=[];if(this.floatOutput&&e.push("  index *= 4"),this.graphical)e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = actualColor");else if(this.floatOutput)for(var r=["r","g","b","a"],i=0;i<r.length;++i){if(e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),t){e.push("  gl_FragData[0]."+r[i]+" = kernelResult");for(var n=0;n<t.length;++n)e.push("  gl_FragData["+(n+1)+"]."+r[i]+" = "+t[n])}else e.push("  gl_FragColor."+r[i]+" = kernelResult");i<r.length-1&&e.push("  index += 1")}else if(null!==t){e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),e.push("  gl_FragData[0] = encode32(kernelResult)");for(var a=0;a<t.length;a++)e.push("  gl_FragData["+(a+1)+"] = encode32("+t[a]+")")}else e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  gl_FragColor = encode32(kernelResult)");return this._linesToString(e)}},{key:"_linesToString",value:function(t){return t.length>0?t.join(";\n")+";\n":"\n"}},{key:"_replaceArtifacts",value:function(t,e){return t.replace(/[ ]*__([A-Z]+[0-9]*([_]?[A-Z])*)__;\n/g,function(t,r){if(e.hasOwnProperty(r))return e[r];throw"unhandled artifact "+r})}},{key:"_addKernels",value:function(){var t=this,e=this.functionBuilder,r=this._webGl;if(e.addFunctions(this.functions,{constants:this.constants,output:this.output}),e.addNativeFunctions(this.nativeFunctions),e.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations,paramNames:this.paramNames,paramTypes:this.paramTypes,constantTypes:this.constantTypes,fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy}),null!==this.subKernels){if(!(this.drawBuffers=r.getExtension("WEBGL_draw_buffers")))throw new Error("could not instantiate draw buffers extension");this.subKernelOutputVariableNames=[],this.subKernels.forEach(function(e){return t._addSubKernel(e)})}else if(null!==this.subKernelProperties){if(!(this.drawBuffers=r.getExtension("WEBGL_draw_buffers")))throw new Error("could not instantiate draw buffers extension");this.subKernelOutputVariableNames=[],Object.keys(this.subKernelProperties).forEach(function(e){return t._addSubKernel(t.subKernelProperties[e])})}}},{key:"_addSubKernel",value:function(t){this.functionBuilder.addSubKernel(t,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations,fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy}),this.subKernelOutputVariableNames.push(t.name+"Result")}},{key:"_getFragShaderString",value:function(t){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(t))}},{key:"_getVertShaderString",value:function(t){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}},{key:"toString",value:function(){return l(this)}},{key:"addFunction",value:function(t){this.functionBuilder.addFunction(null,t)}},{key:"destroy",value:function(e){t(E.prototype.__proto__||Object.getPrototypeOf(E.prototype),"destroy",this).call(this),this.outputTexture&&this._webGl.deleteTexture(this.outputTexture),this.buffer&&this._webGl.deleteBuffer(this.buffer),this.framebuffer&&this._webGl.deleteFramebuffer(this.framebuffer),this.vertShader&&this._webGl.deleteShader(this.vertShader),this.fragShader&&this._webGl.deleteShader(this.fragShader),this.program&&this._webGl.deleteProgram(this.program);for(var r=Object.keys(this.textureCache),i=0;i<r.length;i++){var n=r[i];this._webGl.deleteTexture(this.textureCache[n])}if(this.subKernelOutputTextures)for(var a=0;a<this.subKernelOutputTextures.length;a++)this._webGl.deleteTexture(this.subKernelOutputTextures[a]);if(e){var s=f.indexOf(this._canvas);s>=0&&(f[s]=null,T[s]=null)}delete this._webGl}}]),E}();
},{"../kernel-base":"NzEZ","../../core/utils":"y5hZ","../../core/texture":"34im","./shader-frag":"natt","./shader-vert":"Z/A7","./kernel-string":"FRV+"}],"zTps":[function(require,module,exports) {
"use strict";var t=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();function n(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}module.exports=function(){function e(t){n(this,e),this.nodeMap={},this.nativeFunctions={},this.gpu=t,this.rootKernel=null,this.Node=null}return t(e,[{key:"addNativeFunction",value:function(t,n){this.nativeFunctions[t]=n}},{key:"addFunction",value:function(t,n,e){this.addFunctionNode(new this.Node(t,n,e).setBuilder(this))}},{key:"addFunctions",value:function(t,n){if(t)if(Array.isArray(t))for(var e=0;e<t.length;e++)this.addFunction(null,t[e],n);else for(var i in t)this.addFunction(i,t[i],n)}},{key:"addNativeFunctions",value:function(t){for(var n in t)t.hasOwnProperty(n)&&this.addNativeFunction(n,t[n])}},{key:"addFunctionNode",value:function(t){this.nodeMap[t.functionName]=t,t.isRootKernel&&(this.rootKernel=t)}},{key:"traceFunctionCalls",value:function(t,n,e){t=t||"kernel",n=n||[];var i=this.nodeMap[t];if(i){var o=n.indexOf(t);if(-1===o){n.push(t),e&&(i.parent=e),i.getFunctionString();for(var r=0;r<i.calledFunctions.length;++r)this.traceFunctionCalls(i.calledFunctions[r],n,i)}else{var u=n.splice(o,1)[0];n.push(u)}}return this.nativeFunctions[t]&&(n.indexOf(t)>=0||n.push(t)),n}},{key:"addKernel",value:function(t,n){var e=new this.Node("kernel",t,n);return e.setBuilder(this),e.isRootKernel=!0,this.addFunctionNode(e),e}},{key:"addSubKernel",value:function(t,n){var e=new this.Node(null,t,n);return e.setBuilder(this),e.isSubKernel=!0,this.addFunctionNode(e),e}},{key:"getPrototypeString",value:function(t){return this.getPrototypes(t).join("\n")}},{key:"getPrototypes",value:function(t){return this.rootKernel.generate(),t?this.getPrototypesFromFunctionNames(this.traceFunctionCalls(t,[]).reverse()):this.getPrototypesFromFunctionNames(Object.keys(this.nodeMap))}},{key:"getStringFromFunctionNames",value:function(t){for(var n=[],e=0;e<t.length;++e){this.nodeMap[t[e]]&&n.push(this.nodeMap[t[e]].getFunctionString())}return n.join("\n")}},{key:"getPrototypesFromFunctionNames",value:function(t,n){for(var e=[],i=0;i<t.length;++i){var o=t[i],r=this.nodeMap[o];r?e.push(r.getFunctionPrototypeString(n)):this.nativeFunctions[o]&&e.push(this.nativeFunctions[o])}return e}},{key:"getPrototypeStringFromFunctionNames",value:function(t,n){return this.getPrototypesFromFunctionNames(t,n).toString()}},{key:"getString",value:function(t,n){return void 0===n&&(n={}),t?this.getStringFromFunctionNames(this.traceFunctionCalls(t,[],n).reverse(),n):this.getStringFromFunctionNames(Object.keys(this.nodeMap),n)}}]),e}();
},{}],"Wqy/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=It,exports.parseExpressionAt=Pt,exports.tokenizer=Lt,exports.addLooseExports=Nt,exports.getLineInfo=T,exports.isIdentifierChar=l,exports.isIdentifierStart=u,exports.isNewLine=k,exports.nonASCIIwhitespace=exports.lineBreakG=exports.lineBreak=exports.Token=exports.tokContexts=exports.TokContext=exports.keywordTypes=exports.tokTypes=exports.TokenType=exports.Node=exports.SourceLocation=exports.Position=exports.defaultOptions=exports.plugins=exports.Parser=exports.pluginsLoose=exports.LooseParser=exports.parse_dammit=exports.version=void 0;var t={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},e="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",i={5:e,6:e+" const class extends export import super"},s=/^in(stanceof)?$/,r="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࢽऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿯ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞹꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭥꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",a="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ංඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ູົຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭ᳲ-᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",n=new RegExp("["+r+"]"),o=new RegExp("["+r+a+"]");r=a=null;var h=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,477,28,11,0,9,21,190,52,76,44,33,24,27,35,30,0,12,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,54,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,86,26,230,43,117,63,32,0,257,0,11,39,8,0,22,0,12,39,3,3,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,270,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,68,12,0,67,12,65,1,31,6129,15,754,9486,286,82,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,4149,196,60,67,1213,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42710,42,4148,12,221,3,5761,15,7472,3104,541],p=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,525,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,4,9,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,280,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1016,45,17,3,19723,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,2214,6,110,6,6,9,792487,239];function c(t,e){for(var i=65536,s=0;s<e.length;s+=2){if((i+=e[s])>t)return!1;if((i+=e[s+1])>=t)return!0}}function u(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&n.test(String.fromCharCode(t)):!1!==e&&c(t,h)))}function l(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&o.test(String.fromCharCode(t)):!1!==e&&(c(t,h)||c(t,p)))))}var d=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function f(t,e){return new d(t,{beforeExpr:!0,binop:e})}exports.TokenType=d;var m={beforeExpr:!0},x={startsExpr:!0},g={};function v(t,e){return void 0===e&&(e={}),e.keyword=t,g[t]=new d(t,e)}exports.keywordTypes=g;var y={num:new d("num",x),regexp:new d("regexp",x),string:new d("string",x),name:new d("name",x),eof:new d("eof"),bracketL:new d("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new d("]"),braceL:new d("{",{beforeExpr:!0,startsExpr:!0}),braceR:new d("}"),parenL:new d("(",{beforeExpr:!0,startsExpr:!0}),parenR:new d(")"),comma:new d(",",m),semi:new d(";",m),colon:new d(":",m),dot:new d("."),question:new d("?",m),arrow:new d("=>",m),template:new d("template"),invalidTemplate:new d("invalidTemplate"),ellipsis:new d("...",m),backQuote:new d("`",x),dollarBraceL:new d("${",{beforeExpr:!0,startsExpr:!0}),eq:new d("=",{beforeExpr:!0,isAssign:!0}),assign:new d("_=",{beforeExpr:!0,isAssign:!0}),incDec:new d("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new d("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:f("||",1),logicalAND:f("&&",2),bitwiseOR:f("|",3),bitwiseXOR:f("^",4),bitwiseAND:f("&",5),equality:f("==/!=/===/!==",6),relational:f("</>/<=/>=",7),bitShift:f("<</>>/>>>",8),plusMin:new d("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:f("%",10),star:f("*",10),slash:f("/",10),starstar:new d("**",{beforeExpr:!0}),_break:v("break"),_case:v("case",m),_catch:v("catch"),_continue:v("continue"),_debugger:v("debugger"),_default:v("default",m),_do:v("do",{isLoop:!0,beforeExpr:!0}),_else:v("else",m),_finally:v("finally"),_for:v("for",{isLoop:!0}),_function:v("function",x),_if:v("if"),_return:v("return",m),_switch:v("switch"),_throw:v("throw",m),_try:v("try"),_var:v("var"),_const:v("const"),_while:v("while",{isLoop:!0}),_with:v("with"),_new:v("new",{beforeExpr:!0,startsExpr:!0}),_this:v("this",x),_super:v("super",x),_class:v("class",x),_extends:v("extends",m),_export:v("export"),_import:v("import"),_null:v("null",x),_true:v("true",x),_false:v("false",x),_in:v("in",{beforeExpr:!0,binop:7}),_instanceof:v("instanceof",{beforeExpr:!0,binop:7}),_typeof:v("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:v("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:v("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})};exports.tokTypes=y;var _=/\r\n?|\n|\u2028|\u2029/;exports.lineBreak=_;var b=new RegExp(_.source,"g");function k(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}exports.lineBreakG=b;var C=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/;exports.nonASCIIwhitespace=C;var S=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,E=Object.prototype,w=E.hasOwnProperty,A=E.toString;function I(t,e){return w.call(t,e)}var P=Array.isArray||function(t){return"[object Array]"===A.call(t)},L=function(t,e){this.line=t,this.column=e};exports.Position=L,L.prototype.offset=function(t){return new L(this.line,this.column+t)};var N=function(t,e,i){this.start=e,this.end=i,null!==t.sourceFile&&(this.source=t.sourceFile)};function T(t,e){for(var i=1,s=0;;){b.lastIndex=s;var r=b.exec(t);if(!(r&&r.index<e))return new L(i,e-s);++i,s=r.index+r[0].length}}exports.SourceLocation=N;var V={ecmaVersion:7,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1,plugins:{}};function R(t){var e={};for(var i in V)e[i]=t&&I(t,i)?t[i]:V[i];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),P(e.onToken)){var s=e.onToken;e.onToken=function(t){return s.push(t)}}return P(e.onComment)&&(e.onComment=D(e,e.onComment)),e}function D(t,e){return function(i,s,r,a,n,o){var h={type:i?"Block":"Line",value:s,start:r,end:a};t.locations&&(h.loc=new N(this,n,o)),t.ranges&&(h.range=[r,a]),e.push(h)}}exports.defaultOptions=V;var O={};function B(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}exports.plugins=O;var M=function(e,s,r){this.options=e=R(e),this.sourceFile=e.sourceFile,this.keywords=B(i[e.ecmaVersion>=6?6:5]);var a="";if(!e.allowReserved){for(var n=e.ecmaVersion;!(a=t[n]);n--);"module"===e.sourceType&&(a+=" await")}this.reservedWords=B(a);var o=(a?a+" ":"")+t.strict;this.reservedWordsStrict=B(o),this.reservedWordsStrictBind=B(o+" "+t.strictBind),this.input=String(s),this.containsEsc=!1,this.loadPlugins(e.plugins),r?(this.pos=r,this.lineStart=this.input.lastIndexOf("\n",r-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(_).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===e.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.inFunction=this.inGenerator=this.inAsync=!1,this.yieldPos=this.awaitPos=0,this.labels=[],0===this.pos&&e.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterFunctionScope(),this.regexpState=null};exports.Parser=M,M.prototype.isKeyword=function(t){return this.keywords.test(t)},M.prototype.isReservedWord=function(t){return this.reservedWords.test(t)},M.prototype.extend=function(t,e){this[t]=e(this[t])},M.prototype.loadPlugins=function(t){for(var e in t){var i=O[e];if(!i)throw new Error("Plugin '"+e+"' not found");i(this,t[e])}},M.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)};var F=M.prototype,U=/^(?:'((?:\\.|[^'])*?)'|"((?:\\.|[^"])*?)"|;)/;function G(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}F.strictDirective=function(t){for(;;){S.lastIndex=t,t+=S.exec(this.input)[0].length;var e=U.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2]))return!0;t+=e[0].length}},F.eat=function(t){return this.type===t&&(this.next(),!0)},F.isContextual=function(t){return this.type===y.name&&this.value===t&&!this.containsEsc},F.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},F.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},F.canInsertSemicolon=function(){return this.type===y.eof||this.type===y.braceR||_.test(this.input.slice(this.lastTokEnd,this.start))},F.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},F.semicolon=function(){this.eat(y.semi)||this.insertSemicolon()||this.unexpected()},F.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},F.expect=function(t){this.eat(t)||this.unexpected()},F.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},F.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var i=e?t.parenthesizedAssign:t.parenthesizedBind;i>-1&&this.raiseRecoverable(i,"Parenthesized pattern")}},F.checkExpressionErrors=function(t,e){if(!t)return!1;var i=t.shorthandAssign,s=t.doubleProto;if(!e)return i>=0||s>=0;i>=0&&this.raise(i,"Shorthand property assignments are valid only in destructuring patterns"),s>=0&&this.raiseRecoverable(s,"Redefinition of __proto__ property")},F.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},F.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var q=M.prototype;q.parseTopLevel=function(t){var e={};for(t.body||(t.body=[]);this.type!==y.eof;){var i=this.parseStatement(!0,!0,e);t.body.push(i)}return this.adaptDirectivePrologue(t.body),this.next(),this.options.ecmaVersion>=6&&(t.sourceType=this.options.sourceType),this.finishNode(t,"Program")};var H={kind:"loop"},W={kind:"switch"};q.isLet=function(){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;S.lastIndex=this.pos;var t=S.exec(this.input),e=this.pos+t[0].length,i=this.input.charCodeAt(e);if(91===i||123===i)return!0;if(u(i,!0)){for(var r=e+1;l(this.input.charCodeAt(r),!0);)++r;var a=this.input.slice(e,r);if(!s.test(a))return!0}return!1},q.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;S.lastIndex=this.pos;var t=S.exec(this.input),e=this.pos+t[0].length;return!(_.test(this.input.slice(this.pos,e))||"function"!==this.input.slice(e,e+8)||e+8!==this.input.length&&l(this.input.charAt(e+8)))},q.parseStatement=function(t,e,i){var s,r=this.type,a=this.startNode();switch(this.isLet()&&(r=y._var,s="let"),r){case y._break:case y._continue:return this.parseBreakContinueStatement(a,r.keyword);case y._debugger:return this.parseDebuggerStatement(a);case y._do:return this.parseDoStatement(a);case y._for:return this.parseForStatement(a);case y._function:return!t&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(a,!1);case y._class:return t||this.unexpected(),this.parseClass(a,!0);case y._if:return this.parseIfStatement(a);case y._return:return this.parseReturnStatement(a);case y._switch:return this.parseSwitchStatement(a);case y._throw:return this.parseThrowStatement(a);case y._try:return this.parseTryStatement(a);case y._const:case y._var:return s=s||this.value,t||"var"===s||this.unexpected(),this.parseVarStatement(a,s);case y._while:return this.parseWhileStatement(a);case y._with:return this.parseWithStatement(a);case y.braceL:return this.parseBlock();case y.semi:return this.parseEmptyStatement(a);case y._export:case y._import:return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),r===y._import?this.parseImport(a):this.parseExport(a,i);default:if(this.isAsyncFunction())return t||this.unexpected(),this.next(),this.parseFunctionStatement(a,!0);var n=this.value,o=this.parseExpression();return r===y.name&&"Identifier"===o.type&&this.eat(y.colon)?this.parseLabeledStatement(a,n,o):this.parseExpressionStatement(a,o)}},q.parseBreakContinueStatement=function(t,e){var i="break"===e;this.next(),this.eat(y.semi)||this.insertSemicolon()?t.label=null:this.type!==y.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var s=0;s<this.labels.length;++s){var r=this.labels[s];if(null==t.label||r.name===t.label.name){if(null!=r.kind&&(i||"loop"===r.kind))break;if(t.label&&i)break}}return s===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,i?"BreakStatement":"ContinueStatement")},q.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},q.parseDoStatement=function(t){return this.next(),this.labels.push(H),t.body=this.parseStatement(!1),this.labels.pop(),this.expect(y._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(y.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},q.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(H),this.enterLexicalScope(),this.expect(y.parenL),this.type===y.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var i=this.isLet();if(this.type===y._var||this.type===y._const||i){var s=this.startNode(),r=i?"let":this.value;return this.next(),this.parseVar(s,!0,r),this.finishNode(s,"VariableDeclaration"),!(this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))||1!==s.declarations.length||"var"!==r&&s.declarations[0].init?(e>-1&&this.unexpected(e),this.parseFor(t,s)):(this.options.ecmaVersion>=9&&(this.type===y._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,s))}var a=new G,n=this.parseExpression(!0,a);return this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===y._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(n,!1,a),this.checkLVal(n),this.parseForIn(t,n)):(this.checkExpressionErrors(a,!0),e>-1&&this.unexpected(e),this.parseFor(t,n))},q.parseFunctionStatement=function(t,e){return this.next(),this.parseFunction(t,!0,!1,e)},q.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement(!this.strict&&this.type===y._function),t.alternate=this.eat(y._else)?this.parseStatement(!this.strict&&this.type===y._function):null,this.finishNode(t,"IfStatement")},q.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(y.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},q.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(y.braceL),this.labels.push(W),this.enterLexicalScope();for(var i=!1;this.type!==y.braceR;)if(this.type===y._case||this.type===y._default){var s=this.type===y._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),s?e.test=this.parseExpression():(i&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),i=!0,e.test=null),this.expect(y.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(!0));return this.exitLexicalScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},q.parseThrowStatement=function(t){return this.next(),_.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var j=[];q.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===y._catch){var e=this.startNode();this.next(),this.eat(y.parenL)?(e.param=this.parseBindingAtom(),this.enterLexicalScope(),this.checkLVal(e.param,"let"),this.expect(y.parenR)):(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterLexicalScope()),e.body=this.parseBlock(!1),this.exitLexicalScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(y._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},q.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},q.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(H),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"WhileStatement")},q.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement(!1),this.finishNode(t,"WithStatement")},q.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},q.parseLabeledStatement=function(t,e,i){for(var s=0,r=this.labels;s<r.length;s+=1){r[s].name===e&&this.raise(i.start,"Label '"+e+"' is already declared")}for(var a=this.type.isLoop?"loop":this.type===y._switch?"switch":null,n=this.labels.length-1;n>=0;n--){var o=this.labels[n];if(o.statementStart!==t.start)break;o.statementStart=this.start,o.kind=a}return this.labels.push({name:e,kind:a,statementStart:this.start}),t.body=this.parseStatement(!0),("ClassDeclaration"===t.body.type||"VariableDeclaration"===t.body.type&&"var"!==t.body.kind||"FunctionDeclaration"===t.body.type&&(this.strict||t.body.generator||t.body.async))&&this.raiseRecoverable(t.body.start,"Invalid labeled declaration"),this.labels.pop(),t.label=i,this.finishNode(t,"LabeledStatement")},q.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},q.parseBlock=function(t){void 0===t&&(t=!0);var e=this.startNode();for(e.body=[],this.expect(y.braceL),t&&this.enterLexicalScope();!this.eat(y.braceR);){var i=this.parseStatement(!0);e.body.push(i)}return t&&this.exitLexicalScope(),this.finishNode(e,"BlockStatement")},q.parseFor=function(t,e){return t.init=e,this.expect(y.semi),t.test=this.type===y.semi?null:this.parseExpression(),this.expect(y.semi),t.update=this.type===y.parenR?null:this.parseExpression(),this.expect(y.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,"ForStatement")},q.parseForIn=function(t,e){var i=this.type===y._in?"ForInStatement":"ForOfStatement";return this.next(),"ForInStatement"===i&&("AssignmentPattern"===e.type||"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(this.strict||"Identifier"!==e.declarations[0].id.type))&&this.raise(e.start,"Invalid assignment in for-in loop head"),t.left=e,t.right="ForInStatement"===i?this.parseExpression():this.parseMaybeAssign(),this.expect(y.parenR),this.exitLexicalScope(),t.body=this.parseStatement(!1),this.labels.pop(),this.finishNode(t,i)},q.parseVar=function(t,e,i){for(t.declarations=[],t.kind=i;;){var s=this.startNode();if(this.parseVarId(s,i),this.eat(y.eq)?s.init=this.parseMaybeAssign(e):"const"!==i||this.type===y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===s.id.type||e&&(this.type===y._in||this.isContextual("of"))?s.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(s,"VariableDeclarator")),!this.eat(y.comma))break}return t},q.parseVarId=function(t,e){t.id=this.parseBindingAtom(e),this.checkLVal(t.id,e,!1)},q.parseFunction=function(t,e,i,s){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!s)&&(t.generator=this.eat(y.star)),this.options.ecmaVersion>=8&&(t.async=!!s),e&&(t.id="nullableID"===e&&this.type!==y.name?null:this.parseIdent(),t.id&&this.checkLVal(t.id,this.inModule&&!this.inFunction?"let":"var"));var r=this.inGenerator,a=this.inAsync,n=this.yieldPos,o=this.awaitPos,h=this.inFunction;return this.inGenerator=t.generator,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),e||(t.id=this.type===y.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,i),this.inGenerator=r,this.inAsync=a,this.yieldPos=n,this.awaitPos=o,this.inFunction=h,this.finishNode(t,e?"FunctionDeclaration":"FunctionExpression")},q.parseFunctionParams=function(t){this.expect(y.parenL),t.params=this.parseBindingList(y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},q.parseClass=function(t,e){this.next(),this.parseClassId(t,e),this.parseClassSuper(t);var i=this.startNode(),s=!1;for(i.body=[],this.expect(y.braceL);!this.eat(y.braceR);){var r=this.parseClassMember(i);r&&"MethodDefinition"===r.type&&"constructor"===r.kind&&(s&&this.raise(r.start,"Duplicate constructor in the same class"),s=!0)}return t.body=this.finishNode(i,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},q.parseClassMember=function(t){var e=this;if(this.eat(y.semi))return null;var i=this.startNode(),s=function(t,s){void 0===s&&(s=!1);var r=e.start,a=e.startLoc;return!!e.eatContextual(t)&&(!(e.type===y.parenL||s&&e.canInsertSemicolon())||(i.key&&e.unexpected(),i.computed=!1,i.key=e.startNodeAt(r,a),i.key.name=t,e.finishNode(i.key,"Identifier"),!1))};i.kind="method",i.static=s("static");var r=this.eat(y.star),a=!1;r||(this.options.ecmaVersion>=8&&s("async",!0)?(a=!0,r=this.options.ecmaVersion>=9&&this.eat(y.star)):s("get")?i.kind="get":s("set")&&(i.kind="set")),i.key||this.parsePropertyName(i);var n=i.key;return i.computed||i.static||!("Identifier"===n.type&&"constructor"===n.name||"Literal"===n.type&&"constructor"===n.value)?i.static&&"Identifier"===n.type&&"prototype"===n.name&&this.raise(n.start,"Classes may not have a static property named prototype"):("method"!==i.kind&&this.raise(n.start,"Constructor can't have get/set modifier"),r&&this.raise(n.start,"Constructor can't be a generator"),a&&this.raise(n.start,"Constructor can't be an async method"),i.kind="constructor"),this.parseClassMethod(t,i,r,a),"get"===i.kind&&0!==i.value.params.length&&this.raiseRecoverable(i.value.start,"getter should have no params"),"set"===i.kind&&1!==i.value.params.length&&this.raiseRecoverable(i.value.start,"setter should have exactly one param"),"set"===i.kind&&"RestElement"===i.value.params[0].type&&this.raiseRecoverable(i.value.params[0].start,"Setter cannot use rest params"),i},q.parseClassMethod=function(t,e,i,s){e.value=this.parseMethod(i,s),t.body.push(this.finishNode(e,"MethodDefinition"))},q.parseClassId=function(t,e){t.id=this.type===y.name?this.parseIdent():!0===e?this.unexpected():null},q.parseClassSuper=function(t){t.superClass=this.eat(y._extends)?this.parseExprSubscripts():null},q.parseExport=function(t,e){if(this.next(),this.eat(y.star))return this.expectContextual("from"),this.type!==y.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(y._default)){var i;if(this.checkExport(e,"default",this.lastTokStart),this.type===y._function||(i=this.isAsyncFunction())){var s=this.startNode();this.next(),i&&this.next(),t.declaration=this.parseFunction(s,"nullableID",!1,i)}else if(this.type===y._class){var r=this.startNode();t.declaration=this.parseClass(r,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(!0),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==y.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var a=0,n=t.specifiers;a<n.length;a+=1){var o=n[a];this.checkUnreserved(o.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},q.checkExport=function(t,e,i){t&&(I(t,e)&&this.raiseRecoverable(i,"Duplicate export '"+e+"'"),t[e]=!0)},q.checkPatternExport=function(t,e){var i=e.type;if("Identifier"===i)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===i)for(var s=0,r=e.properties;s<r.length;s+=1){var a=r[s];this.checkPatternExport(t,a)}else if("ArrayPattern"===i)for(var n=0,o=e.elements;n<o.length;n+=1){var h=o[n];h&&this.checkPatternExport(t,h)}else"Property"===i?this.checkPatternExport(t,e.value):"AssignmentPattern"===i?this.checkPatternExport(t,e.left):"RestElement"===i?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===i&&this.checkPatternExport(t,e.expression)},q.checkVariableExport=function(t,e){if(t)for(var i=0,s=e;i<s.length;i+=1){var r=s[i];this.checkPatternExport(t,r.id)}},q.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},q.parseExportSpecifiers=function(t){var e=[],i=!0;for(this.expect(y.braceL);!this.eat(y.braceR);){if(i)i=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;var s=this.startNode();s.local=this.parseIdent(!0),s.exported=this.eatContextual("as")?this.parseIdent(!0):s.local,this.checkExport(t,s.exported.name,s.exported.start),e.push(this.finishNode(s,"ExportSpecifier"))}return e},q.parseImport=function(t){return this.next(),this.type===y.string?(t.specifiers=j,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},q.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===y.name){var i=this.startNode();if(i.local=this.parseIdent(),this.checkLVal(i.local,"let"),t.push(this.finishNode(i,"ImportDefaultSpecifier")),!this.eat(y.comma))return t}if(this.type===y.star){var s=this.startNode();return this.next(),this.expectContextual("as"),s.local=this.parseIdent(),this.checkLVal(s.local,"let"),t.push(this.finishNode(s,"ImportNamespaceSpecifier")),t}for(this.expect(y.braceL);!this.eat(y.braceR);){if(e)e=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;var r=this.startNode();r.imported=this.parseIdent(!0),this.eatContextual("as")?r.local=this.parseIdent():(this.checkUnreserved(r.imported),r.local=r.imported),this.checkLVal(r.local,"let"),t.push(this.finishNode(r,"ImportSpecifier"))}return t},q.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},q.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"==typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var z=M.prototype;z.toAssignable=function(t,e,i){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Can not use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",i&&this.checkPatternErrors(i,!0);for(var s=0,r=t.properties;s<r.length;s+=1){var a=r[s];this.toAssignable(a,e),"RestElement"!==a.type||"ArrayPattern"!==a.argument.type&&"ObjectPattern"!==a.argument.type||this.raise(a.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",i&&this.checkPatternErrors(i,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e);break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else i&&this.checkPatternErrors(i,!0);return t},z.toAssignableList=function(t,e){for(var i=t.length,s=0;s<i;s++){var r=t[s];r&&this.toAssignable(r,e)}if(i){var a=t[i-1];6===this.options.ecmaVersion&&e&&a&&"RestElement"===a.type&&"Identifier"!==a.argument.type&&this.unexpected(a.argument.start)}return t},z.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},z.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==y.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},z.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case y.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(y.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case y.braceL:return this.parseObj(!0)}return this.parseIdent()},z.parseBindingList=function(t,e,i){for(var s=[],r=!0;!this.eat(t);)if(r?r=!1:this.expect(y.comma),e&&this.type===y.comma)s.push(null);else{if(i&&this.afterTrailingComma(t))break;if(this.type===y.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),s.push(a),this.type===y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var n=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(n),s.push(n)}return s},z.parseBindingListItem=function(t){return t},z.parseMaybeDefault=function(t,e,i){if(i=i||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(y.eq))return i;var s=this.startNodeAt(t,e);return s.left=i,s.right=this.parseMaybeAssign(),this.finishNode(s,"AssignmentPattern")},z.checkLVal=function(t,e,i){switch(t.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),i&&(I(i,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),i[t.name]=!0),e&&"none"!==e&&(("var"===e&&!this.canDeclareVarName(t.name)||"var"!==e&&!this.canDeclareLexicalName(t.name))&&this.raiseRecoverable(t.start,"Identifier '"+t.name+"' has already been declared"),"var"===e?this.declareVarName(t.name):this.declareLexicalName(t.name));break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var s=0,r=t.properties;s<r.length;s+=1){var a=r[s];this.checkLVal(a,e,i)}break;case"Property":this.checkLVal(t.value,e,i);break;case"ArrayPattern":for(var n=0,o=t.elements;n<o.length;n+=1){var h=o[n];h&&this.checkLVal(h,e,i)}break;case"AssignmentPattern":this.checkLVal(t.left,e,i);break;case"RestElement":this.checkLVal(t.argument,e,i);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,i);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var Q=M.prototype;Q.checkPropClash=function(t,e,i){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type||this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var s,r=t.key;switch(r.type){case"Identifier":s=r.name;break;case"Literal":s=String(r.value);break;default:return}var a=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===s&&"init"===a&&(e.proto&&(i&&i.doubleProto<0?i.doubleProto=r.start:this.raiseRecoverable(r.start,"Redefinition of __proto__ property")),e.proto=!0);else{var n=e[s="$"+s];if(n)("init"===a?this.strict&&n.init||n.get||n.set:n.init||n[a])&&this.raiseRecoverable(r.start,"Redefinition of property");else n=e[s]={init:!1,get:!1,set:!1};n[a]=!0}}},Q.parseExpression=function(t,e){var i=this.start,s=this.startLoc,r=this.parseMaybeAssign(t,e);if(this.type===y.comma){var a=this.startNodeAt(i,s);for(a.expressions=[r];this.eat(y.comma);)a.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(a,"SequenceExpression")}return r},Q.parseMaybeAssign=function(t,e,i){if(this.inGenerator&&this.isContextual("yield"))return this.parseYield();var s=!1,r=-1,a=-1;e?(r=e.parenthesizedAssign,a=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new G,s=!0);var n=this.start,o=this.startLoc;this.type!==y.parenL&&this.type!==y.name||(this.potentialArrowAt=this.start);var h=this.parseMaybeConditional(t,e);if(i&&(h=i.call(this,h,n,o)),this.type.isAssign){var p=this.startNodeAt(n,o);return p.operator=this.value,p.left=this.type===y.eq?this.toAssignable(h,!1,e):h,s||G.call(e),e.shorthandAssign=-1,this.checkLVal(h),this.next(),p.right=this.parseMaybeAssign(t),this.finishNode(p,"AssignmentExpression")}return s&&this.checkExpressionErrors(e,!0),r>-1&&(e.parenthesizedAssign=r),a>-1&&(e.trailingComma=a),h},Q.parseMaybeConditional=function(t,e){var i=this.start,s=this.startLoc,r=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return r;if(this.eat(y.question)){var a=this.startNodeAt(i,s);return a.test=r,a.consequent=this.parseMaybeAssign(),this.expect(y.colon),a.alternate=this.parseMaybeAssign(t),this.finishNode(a,"ConditionalExpression")}return r},Q.parseExprOps=function(t,e){var i=this.start,s=this.startLoc,r=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)?r:r.start===i&&"ArrowFunctionExpression"===r.type?r:this.parseExprOp(r,i,s,-1,t)},Q.parseExprOp=function(t,e,i,s,r){var a=this.type.binop;if(null!=a&&(!r||this.type!==y._in)&&a>s){var n=this.type===y.logicalOR||this.type===y.logicalAND,o=this.value;this.next();var h=this.start,p=this.startLoc,c=this.parseExprOp(this.parseMaybeUnary(null,!1),h,p,a,r),u=this.buildBinary(e,i,t,c,o,n);return this.parseExprOp(u,e,i,s,r)}return t},Q.buildBinary=function(t,e,i,s,r,a){var n=this.startNodeAt(t,e);return n.left=i,n.operator=r,n.right=s,this.finishNode(n,a?"LogicalExpression":"BinaryExpression")},Q.parseMaybeUnary=function(t,e){var i,s=this.start,r=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))i=this.parseAwait(),e=!0;else if(this.type.prefix){var a=this.startNode(),n=this.type===y.incDec;a.operator=this.value,a.prefix=!0,this.next(),a.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),n?this.checkLVal(a.argument):this.strict&&"delete"===a.operator&&"Identifier"===a.argument.type?this.raiseRecoverable(a.start,"Deleting local variable in strict mode"):e=!0,i=this.finishNode(a,n?"UpdateExpression":"UnaryExpression")}else{if(i=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return i;for(;this.type.postfix&&!this.canInsertSemicolon();){var o=this.startNodeAt(s,r);o.operator=this.value,o.prefix=!1,o.argument=i,this.checkLVal(i),this.next(),i=this.finishNode(o,"UpdateExpression")}}return!e&&this.eat(y.starstar)?this.buildBinary(s,r,i,this.parseMaybeUnary(null,!1),"**",!1):i},Q.parseExprSubscripts=function(t){var e=this.start,i=this.startLoc,s=this.parseExprAtom(t),r="ArrowFunctionExpression"===s.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd);if(this.checkExpressionErrors(t)||r)return s;var a=this.parseSubscripts(s,e,i);return t&&"MemberExpression"===a.type&&(t.parenthesizedAssign>=a.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=a.start&&(t.parenthesizedBind=-1)),a},Q.parseSubscripts=function(t,e,i,s){for(var r=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&"async"===this.input.slice(t.start,t.end),a=void 0;;)if((a=this.eat(y.bracketL))||this.eat(y.dot)){var n=this.startNodeAt(e,i);n.object=t,n.property=a?this.parseExpression():this.parseIdent(!0),n.computed=!!a,a&&this.expect(y.bracketR),t=this.finishNode(n,"MemberExpression")}else if(!s&&this.eat(y.parenL)){var o=new G,h=this.yieldPos,p=this.awaitPos;this.yieldPos=0,this.awaitPos=0;var c=this.parseExprList(y.parenR,this.options.ecmaVersion>=8,!1,o);if(r&&!this.canInsertSemicolon()&&this.eat(y.arrow))return this.checkPatternErrors(o,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=h,this.awaitPos=p,this.parseArrowExpression(this.startNodeAt(e,i),c,!0);this.checkExpressionErrors(o,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=p||this.awaitPos;var u=this.startNodeAt(e,i);u.callee=t,u.arguments=c,t=this.finishNode(u,"CallExpression")}else{if(this.type!==y.backQuote)return t;var l=this.startNodeAt(e,i);l.tag=t,l.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(l,"TaggedTemplateExpression")}},Q.parseExprAtom=function(t){var e,i=this.potentialArrowAt===this.start;switch(this.type){case y._super:return this.inFunction||this.raise(this.start,"'super' outside of function or class"),e=this.startNode(),this.next(),this.type!==y.dot&&this.type!==y.bracketL&&this.type!==y.parenL&&this.unexpected(),this.finishNode(e,"Super");case y._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case y.name:var s=this.start,r=this.startLoc,a=this.containsEsc,n=this.parseIdent(this.type!==y.name);if(this.options.ecmaVersion>=8&&!a&&"async"===n.name&&!this.canInsertSemicolon()&&this.eat(y._function))return this.parseFunction(this.startNodeAt(s,r),!1,!1,!0);if(i&&!this.canInsertSemicolon()){if(this.eat(y.arrow))return this.parseArrowExpression(this.startNodeAt(s,r),[n],!1);if(this.options.ecmaVersion>=8&&"async"===n.name&&this.type===y.name&&!a)return n=this.parseIdent(),!this.canInsertSemicolon()&&this.eat(y.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(s,r),[n],!0)}return n;case y.regexp:var o=this.value;return(e=this.parseLiteral(o.value)).regex={pattern:o.pattern,flags:o.flags},e;case y.num:case y.string:return this.parseLiteral(this.value);case y._null:case y._true:case y._false:return(e=this.startNode()).value=this.type===y._null?null:this.type===y._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case y.parenL:var h=this.start,p=this.parseParenAndDistinguishExpression(i);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(p)&&(t.parenthesizedAssign=h),t.parenthesizedBind<0&&(t.parenthesizedBind=h)),p;case y.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(y.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case y.braceL:return this.parseObj(!1,t);case y._function:return e=this.startNode(),this.next(),this.parseFunction(e,!1);case y._class:return this.parseClass(this.startNode(),!1);case y._new:return this.parseNew();case y.backQuote:return this.parseTemplate();default:this.unexpected()}},Q.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),this.next(),this.finishNode(e,"Literal")},Q.parseParenExpression=function(){this.expect(y.parenL);var t=this.parseExpression();return this.expect(y.parenR),t},Q.parseParenAndDistinguishExpression=function(t){var e,i=this.start,s=this.startLoc,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a,n=this.start,o=this.startLoc,h=[],p=!0,c=!1,u=new G,l=this.yieldPos,d=this.awaitPos;for(this.yieldPos=0,this.awaitPos=0;this.type!==y.parenR;){if(p?p=!1:this.expect(y.comma),r&&this.afterTrailingComma(y.parenR,!0)){c=!0;break}if(this.type===y.ellipsis){a=this.start,h.push(this.parseParenItem(this.parseRestBinding())),this.type===y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}h.push(this.parseMaybeAssign(!1,u,this.parseParenItem))}var f=this.start,m=this.startLoc;if(this.expect(y.parenR),t&&!this.canInsertSemicolon()&&this.eat(y.arrow))return this.checkPatternErrors(u,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=l,this.awaitPos=d,this.parseParenArrowList(i,s,h);h.length&&!c||this.unexpected(this.lastTokStart),a&&this.unexpected(a),this.checkExpressionErrors(u,!0),this.yieldPos=l||this.yieldPos,this.awaitPos=d||this.awaitPos,h.length>1?((e=this.startNodeAt(n,o)).expressions=h,this.finishNodeAt(e,"SequenceExpression",f,m)):e=h[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var x=this.startNodeAt(i,s);return x.expression=e,this.finishNode(x,"ParenthesizedExpression")}return e},Q.parseParenItem=function(t){return t},Q.parseParenArrowList=function(t,e,i){return this.parseArrowExpression(this.startNodeAt(t,e),i)};var K=[];Q.parseNew=function(){var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(y.dot)){t.meta=e;var i=this.containsEsc;return t.property=this.parseIdent(!0),("target"!==t.property.name||i)&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is new.target"),this.inFunction||this.raiseRecoverable(t.start,"new.target can only be used in functions"),this.finishNode(t,"MetaProperty")}var s=this.start,r=this.startLoc;return t.callee=this.parseSubscripts(this.parseExprAtom(),s,r,!0),this.eat(y.parenL)?t.arguments=this.parseExprList(y.parenR,this.options.ecmaVersion>=8,!1):t.arguments=K,this.finishNode(t,"NewExpression")},Q.parseTemplateElement=function(t){var e=t.isTagged,i=this.startNode();return this.type===y.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),i.value={raw:this.value,cooked:null}):i.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),i.tail=this.type===y.backQuote,this.finishNode(i,"TemplateElement")},Q.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var i=this.startNode();this.next(),i.expressions=[];var s=this.parseTemplateElement({isTagged:e});for(i.quasis=[s];!s.tail;)this.type===y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(y.dollarBraceL),i.expressions.push(this.parseExpression()),this.expect(y.braceR),i.quasis.push(s=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(i,"TemplateLiteral")},Q.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===y.name||this.type===y.num||this.type===y.string||this.type===y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===y.star)&&!_.test(this.input.slice(this.lastTokEnd,this.start))},Q.parseObj=function(t,e){var i=this.startNode(),s=!0,r={};for(i.properties=[],this.next();!this.eat(y.braceR);){if(s)s=!1;else if(this.expect(y.comma),this.afterTrailingComma(y.braceR))break;var a=this.parseProperty(t,e);t||this.checkPropClash(a,r,e),i.properties.push(a)}return this.finishNode(i,t?"ObjectPattern":"ObjectExpression")},Q.parseProperty=function(t,e){var i,s,r,a,n=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(y.ellipsis))return t?(n.argument=this.parseIdent(!1),this.type===y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(n,"RestElement")):(this.type===y.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),n.argument=this.parseMaybeAssign(!1,e),this.type===y.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(n,"SpreadElement"));this.options.ecmaVersion>=6&&(n.method=!1,n.shorthand=!1,(t||e)&&(r=this.start,a=this.startLoc),t||(i=this.eat(y.star)));var o=this.containsEsc;return this.parsePropertyName(n),!t&&!o&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(n)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(y.star),this.parsePropertyName(n,e)):s=!1,this.parsePropertyValue(n,t,i,s,r,a,e,o),this.finishNode(n,"Property")},Q.parsePropertyValue=function(t,e,i,s,r,a,n,o){if((i||s)&&this.type===y.colon&&this.unexpected(),this.eat(y.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,n),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===y.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(i,s);else if(e||o||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===y.comma||this.type===y.braceR)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?(this.checkUnreserved(t.key),t.kind="init",e?t.value=this.parseMaybeDefault(r,a,t.key):this.type===y.eq&&n?(n.shorthandAssign<0&&(n.shorthandAssign=this.start),t.value=this.parseMaybeDefault(r,a,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(i||s)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var h="get"===t.kind?0:1;if(t.value.params.length!==h){var p=t.value.start;"get"===t.kind?this.raiseRecoverable(p,"getter should have no params"):this.raiseRecoverable(p,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},Q.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(y.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(y.bracketR),t.key;t.computed=!1}return t.key=this.type===y.num||this.type===y.string?this.parseExprAtom():this.parseIdent(!0)},Q.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=!1,t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},Q.parseMethod=function(t,e){var i=this.startNode(),s=this.inGenerator,r=this.inAsync,a=this.yieldPos,n=this.awaitPos,o=this.inFunction;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=t),this.options.ecmaVersion>=8&&(i.async=!!e),this.inGenerator=i.generator,this.inAsync=i.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,this.enterFunctionScope(),this.expect(y.parenL),i.params=this.parseBindingList(y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1),this.inGenerator=s,this.inAsync=r,this.yieldPos=a,this.awaitPos=n,this.inFunction=o,this.finishNode(i,"FunctionExpression")},Q.parseArrowExpression=function(t,e,i){var s=this.inGenerator,r=this.inAsync,a=this.yieldPos,n=this.awaitPos,o=this.inFunction;return this.enterFunctionScope(),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!i),this.inGenerator=!1,this.inAsync=t.async,this.yieldPos=0,this.awaitPos=0,this.inFunction=!0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0),this.inGenerator=s,this.inAsync=r,this.yieldPos=a,this.awaitPos=n,this.inFunction=o,this.finishNode(t,"ArrowFunctionExpression")},Q.parseFunctionBody=function(t,e){var i=e&&this.type!==y.braceL,s=this.strict,r=!1;if(i)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);s&&!a||(r=this.strictDirective(this.end))&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list");var n=this.labels;this.labels=[],r&&(this.strict=!0),this.checkParams(t,!s&&!r&&!e&&this.isSimpleParamList(t.params)),t.body=this.parseBlock(!1),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=n}this.exitFunctionScope(),this.strict&&t.id&&this.checkLVal(t.id,"none"),this.strict=s},Q.isSimpleParamList=function(t){for(var e=0,i=t;e<i.length;e+=1){if("Identifier"!==i[e].type)return!1}return!0},Q.checkParams=function(t,e){for(var i={},s=0,r=t.params;s<r.length;s+=1){var a=r[s];this.checkLVal(a,"var",e?null:i)}},Q.parseExprList=function(t,e,i,s){for(var r=[],a=!0;!this.eat(t);){if(a)a=!1;else if(this.expect(y.comma),e&&this.afterTrailingComma(t))break;var n=void 0;i&&this.type===y.comma?n=null:this.type===y.ellipsis?(n=this.parseSpread(s),s&&this.type===y.comma&&s.trailingComma<0&&(s.trailingComma=this.start)):n=this.parseMaybeAssign(!1,s),r.push(n)}return r},Q.checkUnreserved=function(t){var e=t.start,i=t.end,s=t.name;(this.inGenerator&&"yield"===s&&this.raiseRecoverable(e,"Can not use 'yield' as identifier inside a generator"),this.inAsync&&"await"===s&&this.raiseRecoverable(e,"Can not use 'await' as identifier inside an async function"),this.isKeyword(s)&&this.raise(e,"Unexpected keyword '"+s+"'"),this.options.ecmaVersion<6&&-1!==this.input.slice(e,i).indexOf("\\"))||(this.strict?this.reservedWordsStrict:this.reservedWords).test(s)&&(this.inAsync||"await"!==s||this.raiseRecoverable(e,"Can not use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+s+"' is reserved"))},Q.parseIdent=function(t,e){var i=this.startNode();return t&&"never"===this.options.allowReserved&&(t=!1),this.type===y.name?i.name=this.value:this.type.keyword?(i.name=this.type.keyword,"class"!==i.name&&"function"!==i.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(),this.finishNode(i,"Identifier"),t||this.checkUnreserved(i),i},Q.parseYield=function(){this.yieldPos||(this.yieldPos=this.start);var t=this.startNode();return this.next(),this.type===y.semi||this.canInsertSemicolon()||this.type!==y.star&&!this.type.startsExpr?(t.delegate=!1,t.argument=null):(t.delegate=this.eat(y.star),t.argument=this.parseMaybeAssign()),this.finishNode(t,"YieldExpression")},Q.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!0),this.finishNode(t,"AwaitExpression")};var X=M.prototype;X.raise=function(t,e){var i=T(this.input,t);e+=" ("+i.line+":"+i.column+")";var s=new SyntaxError(e);throw s.pos=t,s.loc=i,s.raisedAt=this.pos,s},X.raiseRecoverable=X.raise,X.curPosition=function(){if(this.options.locations)return new L(this.curLine,this.pos-this.lineStart)};var Y=M.prototype,Z=Object.assign||function(t){for(var e=[],i=arguments.length-1;i-- >0;)e[i]=arguments[i+1];for(var s=0,r=e;s<r.length;s+=1){var a=r[s];for(var n in a)I(a,n)&&(t[n]=a[n])}return t};Y.enterFunctionScope=function(){this.scopeStack.push({var:{},lexical:{},childVar:{},parentLexical:{}})},Y.exitFunctionScope=function(){this.scopeStack.pop()},Y.enterLexicalScope=function(){var t=this.scopeStack[this.scopeStack.length-1],e={var:{},lexical:{},childVar:{},parentLexical:{}};this.scopeStack.push(e),Z(e.parentLexical,t.lexical,t.parentLexical)},Y.exitLexicalScope=function(){var t=this.scopeStack.pop(),e=this.scopeStack[this.scopeStack.length-1];Z(e.childVar,t.var,t.childVar)},Y.canDeclareVarName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!I(e.lexical,t)&&!I(e.parentLexical,t)},Y.canDeclareLexicalName=function(t){var e=this.scopeStack[this.scopeStack.length-1];return!I(e.lexical,t)&&!I(e.var,t)&&!I(e.childVar,t)},Y.declareVarName=function(t){this.scopeStack[this.scopeStack.length-1].var[t]=!0},Y.declareLexicalName=function(t){this.scopeStack[this.scopeStack.length-1].lexical[t]=!0};var $=function(t,e,i){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new N(t,i)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])};exports.Node=$;var J=M.prototype;function tt(t,e,i,s){return t.type=e,t.end=i,this.options.locations&&(t.loc.end=s),this.options.ranges&&(t.range[1]=i),t}J.startNode=function(){return new $(this,this.start,this.startLoc)},J.startNodeAt=function(t,e){return new $(this,t,e)},J.finishNode=function(t,e){return tt.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},J.finishNodeAt=function(t,e,i,s){return tt.call(this,t,e,i,s)};var et=function(t,e,i,s,r){this.token=t,this.isExpr=!!e,this.preserveSpace=!!i,this.override=s,this.generator=!!r};exports.TokContext=et;var it={b_stat:new et("{",!1),b_expr:new et("{",!0),b_tmpl:new et("${",!1),p_stat:new et("(",!1),p_expr:new et("(",!0),q_tmpl:new et("`",!0,!0,function(t){return t.tryReadTemplateToken()}),f_stat:new et("function",!1),f_expr:new et("function",!0),f_expr_gen:new et("function",!0,!1,null,!0),f_gen:new et("function",!1,!1,null,!0)};exports.tokContexts=it;var st=M.prototype;st.initialContext=function(){return[it.b_stat]},st.braceIsBlock=function(t){var e=this.curContext();return e===it.f_expr||e===it.f_stat||(t!==y.colon||e!==it.b_stat&&e!==it.b_expr?t===y._return||t===y.name&&this.exprAllowed?_.test(this.input.slice(this.lastTokEnd,this.start)):t===y._else||t===y.semi||t===y.eof||t===y.parenR||t===y.arrow||(t===y.braceL?e===it.b_stat:t!==y._var&&t!==y.name&&!this.exprAllowed):!e.isExpr)},st.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},st.updateContext=function(t){var e,i=this.type;i.keyword&&t===y.dot?this.exprAllowed=!1:(e=i.updateContext)?e.call(this,t):this.exprAllowed=i.beforeExpr},y.parenR.updateContext=y.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===it.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},y.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?it.b_stat:it.b_expr),this.exprAllowed=!0},y.dollarBraceL.updateContext=function(){this.context.push(it.b_tmpl),this.exprAllowed=!0},y.parenL.updateContext=function(t){var e=t===y._if||t===y._for||t===y._with||t===y._while;this.context.push(e?it.p_stat:it.p_expr),this.exprAllowed=!0},y.incDec.updateContext=function(){},y._function.updateContext=y._class.updateContext=function(t){t.beforeExpr&&t!==y.semi&&t!==y._else&&(t!==y.colon&&t!==y.braceL||this.curContext()!==it.b_stat)?this.context.push(it.f_expr):this.context.push(it.f_stat),this.exprAllowed=!1},y.backQuote.updateContext=function(){this.curContext()===it.q_tmpl?this.context.pop():this.context.push(it.q_tmpl),this.exprAllowed=!1},y.star.updateContext=function(t){if(t===y._function){var e=this.context.length-1;this.context[e]===it.f_expr?this.context[e]=it.f_expr_gen:this.context[e]=it.f_gen}this.exprAllowed=!0},y.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==y.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var rt={$LONE:["ASCII","ASCII_Hex_Digit","AHex","Alphabetic","Alpha","Any","Assigned","Bidi_Control","Bidi_C","Bidi_Mirrored","Bidi_M","Case_Ignorable","CI","Cased","Changes_When_Casefolded","CWCF","Changes_When_Casemapped","CWCM","Changes_When_Lowercased","CWL","Changes_When_NFKC_Casefolded","CWKCF","Changes_When_Titlecased","CWT","Changes_When_Uppercased","CWU","Dash","Default_Ignorable_Code_Point","DI","Deprecated","Dep","Diacritic","Dia","Emoji","Emoji_Component","Emoji_Modifier","Emoji_Modifier_Base","Emoji_Presentation","Extender","Ext","Grapheme_Base","Gr_Base","Grapheme_Extend","Gr_Ext","Hex_Digit","Hex","IDS_Binary_Operator","IDSB","IDS_Trinary_Operator","IDST","ID_Continue","IDC","ID_Start","IDS","Ideographic","Ideo","Join_Control","Join_C","Logical_Order_Exception","LOE","Lowercase","Lower","Math","Noncharacter_Code_Point","NChar","Pattern_Syntax","Pat_Syn","Pattern_White_Space","Pat_WS","Quotation_Mark","QMark","Radical","Regional_Indicator","RI","Sentence_Terminal","STerm","Soft_Dotted","SD","Terminal_Punctuation","Term","Unified_Ideograph","UIdeo","Uppercase","Upper","Variation_Selector","VS","White_Space","space","XID_Continue","XIDC","XID_Start","XIDS"],General_Category:["Cased_Letter","LC","Close_Punctuation","Pe","Connector_Punctuation","Pc","Control","Cc","cntrl","Currency_Symbol","Sc","Dash_Punctuation","Pd","Decimal_Number","Nd","digit","Enclosing_Mark","Me","Final_Punctuation","Pf","Format","Cf","Initial_Punctuation","Pi","Letter","L","Letter_Number","Nl","Line_Separator","Zl","Lowercase_Letter","Ll","Mark","M","Combining_Mark","Math_Symbol","Sm","Modifier_Letter","Lm","Modifier_Symbol","Sk","Nonspacing_Mark","Mn","Number","N","Open_Punctuation","Ps","Other","C","Other_Letter","Lo","Other_Number","No","Other_Punctuation","Po","Other_Symbol","So","Paragraph_Separator","Zp","Private_Use","Co","Punctuation","P","punct","Separator","Z","Space_Separator","Zs","Spacing_Mark","Mc","Surrogate","Cs","Symbol","S","Titlecase_Letter","Lt","Unassigned","Cn","Uppercase_Letter","Lu"],Script:["Adlam","Adlm","Ahom","Anatolian_Hieroglyphs","Hluw","Arabic","Arab","Armenian","Armn","Avestan","Avst","Balinese","Bali","Bamum","Bamu","Bassa_Vah","Bass","Batak","Batk","Bengali","Beng","Bhaiksuki","Bhks","Bopomofo","Bopo","Brahmi","Brah","Braille","Brai","Buginese","Bugi","Buhid","Buhd","Canadian_Aboriginal","Cans","Carian","Cari","Caucasian_Albanian","Aghb","Chakma","Cakm","Cham","Cherokee","Cher","Common","Zyyy","Coptic","Copt","Qaac","Cuneiform","Xsux","Cypriot","Cprt","Cyrillic","Cyrl","Deseret","Dsrt","Devanagari","Deva","Duployan","Dupl","Egyptian_Hieroglyphs","Egyp","Elbasan","Elba","Ethiopic","Ethi","Georgian","Geor","Glagolitic","Glag","Gothic","Goth","Grantha","Gran","Greek","Grek","Gujarati","Gujr","Gurmukhi","Guru","Han","Hani","Hangul","Hang","Hanunoo","Hano","Hatran","Hatr","Hebrew","Hebr","Hiragana","Hira","Imperial_Aramaic","Armi","Inherited","Zinh","Qaai","Inscriptional_Pahlavi","Phli","Inscriptional_Parthian","Prti","Javanese","Java","Kaithi","Kthi","Kannada","Knda","Katakana","Kana","Kayah_Li","Kali","Kharoshthi","Khar","Khmer","Khmr","Khojki","Khoj","Khudawadi","Sind","Lao","Laoo","Latin","Latn","Lepcha","Lepc","Limbu","Limb","Linear_A","Lina","Linear_B","Linb","Lisu","Lycian","Lyci","Lydian","Lydi","Mahajani","Mahj","Malayalam","Mlym","Mandaic","Mand","Manichaean","Mani","Marchen","Marc","Masaram_Gondi","Gonm","Meetei_Mayek","Mtei","Mende_Kikakui","Mend","Meroitic_Cursive","Merc","Meroitic_Hieroglyphs","Mero","Miao","Plrd","Modi","Mongolian","Mong","Mro","Mroo","Multani","Mult","Myanmar","Mymr","Nabataean","Nbat","New_Tai_Lue","Talu","Newa","Nko","Nkoo","Nushu","Nshu","Ogham","Ogam","Ol_Chiki","Olck","Old_Hungarian","Hung","Old_Italic","Ital","Old_North_Arabian","Narb","Old_Permic","Perm","Old_Persian","Xpeo","Old_South_Arabian","Sarb","Old_Turkic","Orkh","Oriya","Orya","Osage","Osge","Osmanya","Osma","Pahawh_Hmong","Hmng","Palmyrene","Palm","Pau_Cin_Hau","Pauc","Phags_Pa","Phag","Phoenician","Phnx","Psalter_Pahlavi","Phlp","Rejang","Rjng","Runic","Runr","Samaritan","Samr","Saurashtra","Saur","Sharada","Shrd","Shavian","Shaw","Siddham","Sidd","SignWriting","Sgnw","Sinhala","Sinh","Sora_Sompeng","Sora","Soyombo","Soyo","Sundanese","Sund","Syloti_Nagri","Sylo","Syriac","Syrc","Tagalog","Tglg","Tagbanwa","Tagb","Tai_Le","Tale","Tai_Tham","Lana","Tai_Viet","Tavt","Takri","Takr","Tamil","Taml","Tangut","Tang","Telugu","Telu","Thaana","Thaa","Thai","Tibetan","Tibt","Tifinagh","Tfng","Tirhuta","Tirh","Ugaritic","Ugar","Vai","Vaii","Warang_Citi","Wara","Yi","Yiii","Zanabazar_Square","Zanb"]};Array.prototype.push.apply(rt.$LONE,rt.General_Category),rt.gc=rt.General_Category,rt.sc=rt.Script_Extensions=rt.scx=rt.Script;var at=M.prototype,nt=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function ot(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function ht(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function pt(t){return u(t,!0)||36===t||95===t}function ct(t){return l(t,!0)||36===t||95===t||8204===t||8205===t}function ut(t){return t>=65&&t<=90||t>=97&&t<=122}function lt(t){return t>=0&&t<=1114111}function dt(t){return 100===t||68===t||115===t||83===t||119===t||87===t}function ft(t){return ut(t)||95===t}function mt(t){return ft(t)||xt(t)}function xt(t){return t>=48&&t<=57}function gt(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function vt(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function yt(t){return t>=48&&t<=55}nt.prototype.reset=function(t,e,i){var s=-1!==i.indexOf("u");this.start=0|t,this.source=e+"",this.flags=i,this.switchU=s&&this.parser.options.ecmaVersion>=6,this.switchN=s&&this.parser.options.ecmaVersion>=9},nt.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},nt.prototype.at=function(t){var e=this.source,i=e.length;if(t>=i)return-1;var s=e.charCodeAt(t);return!this.switchU||s<=55295||s>=57344||t+1>=i?s:(s<<10)+e.charCodeAt(t+1)-56613888},nt.prototype.nextIndex=function(t){var e=this.source,i=e.length;if(t>=i)return i;var s=e.charCodeAt(t);return!this.switchU||s<=55295||s>=57344||t+1>=i?t+1:t+2},nt.prototype.current=function(){return this.at(this.pos)},nt.prototype.lookahead=function(){return this.at(this.nextIndex(this.pos))},nt.prototype.advance=function(){this.pos=this.nextIndex(this.pos)},nt.prototype.eat=function(t){return this.current()===t&&(this.advance(),!0)},at.validateRegExpFlags=function(t){for(var e=t.validFlags,i=t.flags,s=0;s<i.length;s++){var r=i.charAt(s);-1===e.indexOf(r)&&this.raise(t.start,"Invalid regular expression flag"),i.indexOf(r,s+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},at.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},at.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,i=t.backReferenceNames;e<i.length;e+=1){var s=i[e];-1===t.groupNames.indexOf(s)&&t.raise("Invalid named capture referenced")}},at.regexp_disjunction=function(t){for(this.regexp_alternative(t);t.eat(124);)this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},at.regexp_alternative=function(t){for(;t.pos<t.source.length&&this.regexp_eatTerm(t););},at.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!(t.switchU?!this.regexp_eatAtom(t):!this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},at.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var i=!1;if(this.options.ecmaVersion>=9&&(i=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!i,!0}return t.pos=e,!1},at.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},at.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},at.regexp_eatBracedQuantifier=function(t,e){var i=t.pos;if(t.eat(123)){var s=0,r=-1;if(this.regexp_eatDecimalDigits(t)&&(s=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue),t.eat(125)))return-1!==r&&r<s&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=i}return!1},at.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},at.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},at.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},at.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},at.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},at.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},at.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!ht(e)&&(t.lastIntValue=e,t.advance(),!0)},at.regexp_eatPatternCharacters=function(t){for(var e=t.pos,i=0;-1!==(i=t.current())&&!ht(i);)t.advance();return t.pos!==e},at.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e)&&(t.advance(),!0)},at.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},at.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},at.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){for(t.lastStringValue+=ot(t.lastIntValue);this.regexp_eatRegExpIdentifierPart(t);)t.lastStringValue+=ot(t.lastIntValue);return!0}return!1},at.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),pt(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},at.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,i=t.current();return t.advance(),92===i&&this.regexp_eatRegExpUnicodeEscapeSequence(t)&&(i=t.lastIntValue),ct(i)?(t.lastIntValue=i,!0):(t.pos=e,!1)},at.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},at.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var i=t.lastIntValue;if(t.switchU)return i>t.maxBackReference&&(t.maxBackReference=i),!0;if(i<=t.numCapturingParens)return!0;t.pos=e}return!1},at.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},at.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},at.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},at.regexp_eatZero=function(t){return 48===t.current()&&!xt(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},at.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},at.regexp_eatControlLetter=function(t){var e=t.current();return!!ut(e)&&(t.lastIntValue=e%32,t.advance(),!0)},at.regexp_eatRegExpUnicodeEscapeSequence=function(t){var e=t.pos;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var i=t.lastIntValue;if(t.switchU&&i>=55296&&i<=56319){var s=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var r=t.lastIntValue;if(r>=56320&&r<=57343)return t.lastIntValue=1024*(i-55296)+(r-56320)+65536,!0}t.pos=s,t.lastIntValue=i}return!0}if(t.switchU&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&lt(t.lastIntValue))return!0;t.switchU&&t.raise("Invalid unicode escape"),t.pos=e}return!1},at.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e)&&(t.lastIntValue=e,t.advance(),!0)},at.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},at.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(dt(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},at.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var i=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var s=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,i,s),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,r),!0}return!1},at.regexp_validateUnicodePropertyNameAndValue=function(t,e,i){rt.hasOwnProperty(e)&&-1!==rt[e].indexOf(i)||t.raise("Invalid property name")},at.regexp_validateUnicodePropertyNameOrValue=function(t,e){-1===rt.$LONE.indexOf(e)&&t.raise("Invalid property name")},at.regexp_eatUnicodePropertyName=function(t){var e=0;for(t.lastStringValue="";ft(e=t.current());)t.lastStringValue+=ot(e),t.advance();return""!==t.lastStringValue},at.regexp_eatUnicodePropertyValue=function(t){var e=0;for(t.lastStringValue="";mt(e=t.current());)t.lastStringValue+=ot(e),t.advance();return""!==t.lastStringValue},at.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},at.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},at.regexp_classRanges=function(t){for(;this.regexp_eatClassAtom(t);){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var i=t.lastIntValue;!t.switchU||-1!==e&&-1!==i||t.raise("Invalid character class"),-1!==e&&-1!==i&&e>i&&t.raise("Range out of order in character class")}}},at.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var i=t.current();(99===i||yt(i))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var s=t.current();return 93!==s&&(t.lastIntValue=s,t.advance(),!0)},at.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},at.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!xt(e)&&95!==e)&&(t.lastIntValue=e%32,t.advance(),!0)},at.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},at.regexp_eatDecimalDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;xt(i=t.current());)t.lastIntValue=10*t.lastIntValue+(i-48),t.advance();return t.pos!==e},at.regexp_eatHexDigits=function(t){var e=t.pos,i=0;for(t.lastIntValue=0;gt(i=t.current());)t.lastIntValue=16*t.lastIntValue+vt(i),t.advance();return t.pos!==e},at.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var i=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*i+t.lastIntValue:t.lastIntValue=8*e+i}else t.lastIntValue=e;return!0}return!1},at.regexp_eatOctalDigit=function(t){var e=t.current();return yt(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},at.regexp_eatFixedHexDigits=function(t,e){var i=t.pos;t.lastIntValue=0;for(var s=0;s<e;++s){var r=t.current();if(!gt(r))return t.pos=i,!1;t.lastIntValue=16*t.lastIntValue+vt(r),t.advance()}return!0};var _t=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new N(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])};exports.Token=_t;var bt=M.prototype;function kt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}bt.next=function(){this.options.onToken&&this.options.onToken(new _t(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},bt.getToken=function(){return this.next(),new _t(this)},"undefined"!=typeof Symbol&&(bt[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===y.eof,value:e}}}}),bt.curContext=function(){return this.context[this.context.length-1]},bt.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(y.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},bt.readToken=function(t){return u(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},bt.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);return t<=55295||t>=57344?t:(t<<10)+this.input.charCodeAt(this.pos+1)-56613888},bt.skipBlockComment=function(){var t,e=this.options.onComment&&this.curPosition(),i=this.pos,s=this.input.indexOf("*/",this.pos+=2);if(-1===s&&this.raise(this.pos-2,"Unterminated comment"),this.pos=s+2,this.options.locations)for(b.lastIndex=i;(t=b.exec(this.input))&&t.index<this.pos;)++this.curLine,this.lineStart=t.index+t[0].length;this.options.onComment&&this.options.onComment(!0,this.input.slice(i+2,s),i,this.pos,e,this.curPosition())},bt.skipLineComment=function(t){for(var e=this.pos,i=this.options.onComment&&this.curPosition(),s=this.input.charCodeAt(this.pos+=t);this.pos<this.input.length&&!k(s);)s=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,i,this.curPosition())},bt.skipSpace=function(){t:for(;this.pos<this.input.length;){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&C.test(String.fromCharCode(t))))break t;++this.pos}}},bt.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var i=this.type;this.type=t,this.value=e,this.updateContext(i)},bt.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(y.ellipsis)):(++this.pos,this.finishToken(y.dot))},bt.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(y.assign,2):this.finishOp(y.slash,1)},bt.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),i=1,s=42===t?y.star:y.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++i,s=y.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(y.assign,i+1):this.finishOp(s,i)},bt.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?this.finishOp(124===t?y.logicalOR:y.logicalAND,2):61===e?this.finishOp(y.assign,2):this.finishOp(124===t?y.bitwiseOR:y.bitwiseAND,1)},bt.readToken_caret=function(){return 61===this.input.charCodeAt(this.pos+1)?this.finishOp(y.assign,2):this.finishOp(y.bitwiseXOR,1)},bt.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!_.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(y.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(y.assign,2):this.finishOp(y.plusMin,1)},bt.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),i=1;return e===t?(i=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+i)?this.finishOp(y.assign,i+1):this.finishOp(y.bitShift,i)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(i=2),this.finishOp(y.relational,i)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},bt.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(y.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(y.arrow)):this.finishOp(61===t?y.eq:y.prefix,1)},bt.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(y.parenL);case 41:return++this.pos,this.finishToken(y.parenR);case 59:return++this.pos,this.finishToken(y.semi);case 44:return++this.pos,this.finishToken(y.comma);case 91:return++this.pos,this.finishToken(y.bracketL);case 93:return++this.pos,this.finishToken(y.bracketR);case 123:return++this.pos,this.finishToken(y.braceL);case 125:return++this.pos,this.finishToken(y.braceR);case 58:return++this.pos,this.finishToken(y.colon);case 63:return++this.pos,this.finishToken(y.question);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(y.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 126:return this.finishOp(y.prefix,1)}this.raise(this.pos,"Unexpected character '"+kt(t)+"'")},bt.finishOp=function(t,e){var i=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,i)},bt.readRegexp=function(){for(var t,e,i=this.pos;;){this.pos>=this.input.length&&this.raise(i,"Unterminated regular expression");var s=this.input.charAt(this.pos);if(_.test(s)&&this.raise(i,"Unterminated regular expression"),t)t=!1;else{if("["===s)e=!0;else if("]"===s&&e)e=!1;else if("/"===s&&!e)break;t="\\"===s}++this.pos}var r=this.input.slice(i,this.pos);++this.pos;var a=this.pos,n=this.readWord1();this.containsEsc&&this.unexpected(a);var o=this.regexpState||(this.regexpState=new nt(this));o.reset(i,r,n),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var h=null;try{h=new RegExp(r,n)}catch(p){}return this.finishToken(y.regexp,{pattern:r,flags:n,value:h})},bt.readInt=function(t,e){for(var i=this.pos,s=0,r=0,a=null==e?1/0:e;r<a;++r){var n=this.input.charCodeAt(this.pos),o=void 0;if((o=n>=97?n-97+10:n>=65?n-65+10:n>=48&&n<=57?n-48:1/0)>=t)break;++this.pos,s=s*t+o}return this.pos===i||null!=e&&this.pos-i!==e?null:s},bt.readRadixNumber=function(t){this.pos+=2;var e=this.readInt(t);return null==e&&this.raise(this.start+2,"Expected number in radix "+t),u(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(y.num,e)},bt.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10)||this.raise(e,"Invalid number");var i=this.pos-e>=2&&48===this.input.charCodeAt(e);i&&this.strict&&this.raise(e,"Invalid number"),i&&/[89]/.test(this.input.slice(e,this.pos))&&(i=!1);var s=this.input.charCodeAt(this.pos);46!==s||i||(++this.pos,this.readInt(10),s=this.input.charCodeAt(this.pos)),69!==s&&101!==s||i||(43!==(s=this.input.charCodeAt(++this.pos))&&45!==s||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),u(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=this.input.slice(e,this.pos),a=i?parseInt(r,8):parseFloat(r);return this.finishToken(y.num,a)},bt.readCodePoint=function(){var t;if(123===this.input.charCodeAt(this.pos)){this.options.ecmaVersion<6&&this.unexpected();var e=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(e,"Code point out of bounds")}else t=this.readHexChar(4);return t},bt.readString=function(t){for(var e="",i=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var s=this.input.charCodeAt(this.pos);if(s===t)break;92===s?(e+=this.input.slice(i,this.pos),e+=this.readEscapedChar(!1),i=this.pos):(k(s,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(i,this.pos++),this.finishToken(y.string,e)};var Ct={};bt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==Ct)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},bt.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ct;this.raise(t,e)},bt.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var i=this.input.charCodeAt(this.pos);if(96===i||36===i&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==y.template&&this.type!==y.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(y.template,t)):36===i?(this.pos+=2,this.finishToken(y.dollarBraceL)):(++this.pos,this.finishToken(y.backQuote));if(92===i)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(k(i)){switch(t+=this.input.slice(e,this.pos),++this.pos,i){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(i)}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},bt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},bt.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return kt(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],s=parseInt(i,8);return s>255&&(i=i.slice(0,-1),s=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),"0"===i&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-i.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(s)}return String.fromCharCode(e)}},bt.readHexChar=function(t){var e=this.pos,i=this.readInt(16,t);return null===i&&this.invalidStringToken(e,"Bad character escape sequence"),i},bt.readWord1=function(){this.containsEsc=!1;for(var t="",e=!0,i=this.pos,s=this.options.ecmaVersion>=6;this.pos<this.input.length;){var r=this.fullCharCodeAtPos();if(l(r,s))this.pos+=r<=65535?1:2;else{if(92!==r)break;this.containsEsc=!0,t+=this.input.slice(i,this.pos);var a=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var n=this.readCodePoint();(e?u:l)(n,s)||this.invalidStringToken(a,"Invalid Unicode escape"),t+=kt(n),i=this.pos}e=!1}return t+this.input.slice(i,this.pos)},bt.readWord=function(){var t=this.readWord1(),e=y.name;return this.keywords.test(t)&&(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+t),e=g[t]),this.finishToken(e,t)};var St,Et,wt,At="5.7.3";function It(t,e){return new M(e,t).parse()}function Pt(t,e,i){var s=new M(i,t,e);return s.nextToken(),s.parseExpression()}function Lt(t,e){return new M(e,t)}function Nt(t,e,i){exports.parse_dammit=St=t,exports.LooseParser=Et=e,exports.pluginsLoose=wt=i}exports.version=At,exports.parse_dammit=St,exports.LooseParser=Et,exports.pluginsLoose=wt;
},{}],"Ryaz":[function(require,module,exports) {
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var utils=require("../core/utils"),acorn=require("acorn");module.exports=function(){function BaseFunctionNode(t,e,n){_classCallCheck(this,BaseFunctionNode),this.calledFunctions=[],this.calledFunctionsArguments={},this.builder=null,this.isRootKernel=!1,this.isSubKernel=!1,this.parent=null,this.debug=null,this.prototypeOnly=null,this.constants=null,this.output=null,this.declarations={},this.states=[],this.fixIntegerDivisionAccuracy=null;var r=void 0,s=void 0;if(n&&(n.hasOwnProperty("debug")&&(this.debug=n.debug),n.hasOwnProperty("prototypeOnly")&&(this.prototypeOnly=n.prototypeOnly),n.hasOwnProperty("constants")&&(this.constants=n.constants),n.hasOwnProperty("output")&&(this.output=n.output),n.hasOwnProperty("loopMaxIterations")&&(this.loopMaxIterations=n.loopMaxIterations),n.hasOwnProperty("paramTypes")&&(this.paramTypes=r=n.paramTypes),n.hasOwnProperty("constantTypes")?this.constantTypes=n.constantTypes:this.constantTypes={},n.hasOwnProperty("returnType")&&(s=n.returnType),n.hasOwnProperty("fixIntegerDivisionAccuracy")&&(this.fixIntegerDivisionAccuracy=n.fixIntegerDivisionAccuracy)),!e)throw"jsFunction, parameter is missing";if(this.jsFunctionString=e.toString(),!utils.isFunctionString(this.jsFunctionString))throw console.error("jsFunction, to string conversion check failed: not a function?",this.jsFunctionString),"jsFunction, to string conversion check failed: not a function?";if(utils.isFunction(e)?this.jsFunction=e:this.jsFunction=null,this.functionName=t||e&&e.name||utils.getFunctionNameFromString(this.jsFunctionString),!this.functionName)throw"jsFunction, missing name argument or value";if(this.paramNames=utils.getParamNamesFromString(this.jsFunctionString),r){if(Array.isArray(r)){if(r.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+r.length+","+this.paramNames.length+")";this.paramTypes=r}else if("object"===(void 0===r?"undefined":_typeof(r))){var i=Object.keys(r);if(r.hasOwnProperty("returns")&&(this.returnType=r.returns,i.splice(i.indexOf("returns"),1)),i.length>0&&i.length!==this.paramNames.length)throw"Invalid argument type array length, against function length -> ("+i.length+","+this.paramNames.length+")";this.paramTypes=this.paramNames.map(function(t){return r.hasOwnProperty(t)?r[t]:"Number"})}}else this.paramTypes=[];this.returnType||(this.returnType=s||"Number")}return _createClass(BaseFunctionNode,[{key:"isIdentifierConstant",value:function(t){return!!this.constants&&this.constants.hasOwnProperty(t)}},{key:"isInput",value:function(t){return"Input"===this.paramTypes[this.paramNames.indexOf(t)]}},{key:"setBuilder",value:function(t){return this.builder=t,this}},{key:"pushState",value:function(t){this.states.push(t)}},{key:"popState",value:function(t){if(this.state!==t)throw new Error("Cannot popState "+t+" when in "+this.state);this.states.pop()}},{key:"isState",value:function(t){return this.state===t}},{key:"getJsFunction",value:function getJsFunction(){if(this.jsFunction)return this.jsFunction;if(this.jsFunctionString)return this.jsFunction=eval(this.jsFunctionString),this.jsFunction;throw"Missing jsFunction, and jsFunctionString parameter"}},{key:"astMemberExpressionUnroll",value:function(t){if("Identifier"===t.type)return t.name;if("ThisExpression"===t.type)return"this";if("MemberExpression"===t.type&&t.object&&t.property)return t.object.hasOwnProperty("name")&&"_"===t.object.name[0]?this.astMemberExpressionUnroll(t.property):this.astMemberExpressionUnroll(t.object)+"."+this.astMemberExpressionUnroll(t.property);if(t.hasOwnProperty("expressions")){var e=t.expressions[0];if("Literal"===e.type&&0===e.value&&2===t.expressions.length)return this.astMemberExpressionUnroll(t.expressions[1])}throw this.astErrorOutput("Unknown CallExpression_unroll",t)}},{key:"getJsAST",value:function(t){if(this.jsFunctionAST)return this.jsFunctionAST;if(null===(t=t||acorn))throw"Missing JS to AST parser";var e=t.parse("var "+this.functionName+" = "+this.jsFunctionString+";",{locations:!0});if(null===e)throw"Failed to parse JS code";var n=e.body[0].declarations[0].init;return this.jsFunctionAST=n,n}},{key:"getFunctionString",value:function(){return this.generate(),this.functionString}},{key:"setFunctionString",value:function(t){this.functionString=t}},{key:"getParamType",value:function(t){var e=this.paramNames.indexOf(t);if(-1===e)return this.declarations.hasOwnProperty(t)?this.declarations[t]:"Number";if(this.parent){if(this.paramTypes[e])return this.paramTypes[e];for(var n=this.parent.calledFunctionsArguments[this.functionName],r=0;r<n.length;r++){var s=n[r];if(null!==s[e])return this.paramTypes[e]=s[e].type}}else if(this.paramTypes[e])return this.paramTypes[e];return"Number"}},{key:"getConstantType",value:function(t){return this.constantTypes[t]?this.constantTypes[t]:null}},{key:"getUserParamName",value:function(t){var e=this.paramNames.indexOf(t);if(-1===e)return null;if(!this.parent||!this.isSubKernel)return null;for(var n=this.parent.calledFunctionsArguments[this.functionName],r=0;r<n.length;r++){var s=n[r][e];if(null!==s&&"Integer"!==s.type)return s.name}return null}},{key:"generate",value:function(t){throw new Error("generate not defined on BaseFunctionNode")}},{key:"astGeneric",value:function(t,e){if(null===t)throw this.astErrorOutput("NULL ast",t);if(Array.isArray(t)){for(var n=0;n<t.length;n++)this.astGeneric(t[n],e);return e}switch(t.type){case"FunctionDeclaration":return this.astFunctionDeclaration(t,e);case"FunctionExpression":return this.astFunctionExpression(t,e);case"ReturnStatement":return this.astReturnStatement(t,e);case"Literal":return this.astLiteral(t,e);case"BinaryExpression":return this.astBinaryExpression(t,e);case"Identifier":return this.astIdentifierExpression(t,e);case"AssignmentExpression":return this.astAssignmentExpression(t,e);case"ExpressionStatement":return this.astExpressionStatement(t,e);case"EmptyStatement":return this.astEmptyStatement(t,e);case"BlockStatement":return this.astBlockStatement(t,e);case"IfStatement":return this.astIfStatement(t,e);case"BreakStatement":return this.astBreakStatement(t,e);case"ContinueStatement":return this.astContinueStatement(t,e);case"ForStatement":return this.astForStatement(t,e);case"WhileStatement":return this.astWhileStatement(t,e);case"DoWhileStatement":return this.astDoWhileStatement(t,e);case"VariableDeclaration":return this.astVariableDeclaration(t,e);case"VariableDeclarator":return this.astVariableDeclarator(t,e);case"ThisExpression":return this.astThisExpression(t,e);case"SequenceExpression":return this.astSequenceExpression(t,e);case"UnaryExpression":return this.astUnaryExpression(t,e);case"UpdateExpression":return this.astUpdateExpression(t,e);case"LogicalExpression":return this.astLogicalExpression(t,e);case"MemberExpression":return this.astMemberExpression(t,e);case"CallExpression":return this.astCallExpression(t,e);case"ArrayExpression":return this.astArrayExpression(t,e);case"DebuggerStatement":return this.astDebuggerStatement(t,e)}throw this.astErrorOutput("Unknown ast type : "+t.type,t)}},{key:"astErrorOutput",value:function(t,e){return console.error(utils.getAstString(this.jsFunctionString,e)),console.error(t,e,this),t}},{key:"astDebuggerStatement",value:function(t,e){return e}},{key:"astFunctionDeclaration",value:function(t,e){return e}},{key:"astFunctionExpression",value:function(t,e){return e}},{key:"astReturnStatement",value:function(t,e){return e}},{key:"astLiteral",value:function(t,e){return e}},{key:"astBinaryExpression",value:function(t,e){return e}},{key:"astIdentifierExpression",value:function(t,e){return e}},{key:"astAssignmentExpression",value:function(t,e){return e}},{key:"astExpressionStatement",value:function(t,e){return e}},{key:"astEmptyStatement",value:function(t,e){return e}},{key:"astBlockStatement",value:function(t,e){return e}},{key:"astIfStatement",value:function(t,e){return e}},{key:"astBreakStatement",value:function(t,e){return e}},{key:"astContinueStatement",value:function(t,e){return e}},{key:"astForStatement",value:function(t,e){return e}},{key:"astWhileStatement",value:function(t,e){return e}},{key:"astDoWhileStatement",value:function(t,e){return e}},{key:"astVariableDeclaration",value:function(t,e){return e}},{key:"astVariableDeclarator",value:function(t,e){return e}},{key:"astThisExpression",value:function(t,e){return e}},{key:"astSequenceExpression",value:function(t,e){return e}},{key:"astUnaryExpression",value:function(t,e){return e}},{key:"astUpdateExpression",value:function(t,e){return e}},{key:"astLogicalExpression",value:function(t,e){return e}},{key:"astMemberExpression",value:function(t,e){return e}},{key:"astCallExpression",value:function(t,e){return e}},{key:"astArrayExpression",value:function(t,e){return e}},{key:"pushParameter",value:function(t,e){this.isState("in-get-call-parameters")?t.push("int("+e+")"):t.push(e)}},{key:"state",get:function(){return this.states[this.states.length-1]}}]),BaseFunctionNode}();
},{"../core/utils":"y5hZ","acorn":"Wqy/"}],"2H8q":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=require("../function-node-base"),a=require("../../core/utils"),n="Math.",o="this.",u="this.constants.",h=/decode32\(\s+encode32\(/g,p=/encode32\(\s+decode32\(/g,c=function(){};module.exports=function(h){function p(){return t(this,p),s(this,(p.__proto__||Object.getPrototypeOf(p)).apply(this,arguments))}return r(p,i),e(p,[{key:"generate",value:function(){return this.debug&&c(this),this.prototypeOnly?this.astFunctionPrototype(this.getJsAST(),[]).join("").trim():(this.functionStringArray=this.astGeneric(this.getJsAST(),[]),this.functionString=m(this.functionStringArray.join("").trim()),this.functionString)}},{key:"astFunctionDeclaration",value:function(e,t){return this.builder.addFunction(null,a.getAstString(this.jsFunctionString,e)),t}},{key:"astFunctionPrototype",value:function(e,t){if(this.isRootKernel||this.isSubKernel)return t;var s=this.returnType,r=l[s];if(!r)throw new Error("unknown type "+s);t.push(r),t.push(" "),t.push(this.functionName),t.push("(");for(var i=0;i<this.paramNames.length;++i)i>0&&t.push(", "),t.push(this.paramTypes[i]),t.push(" "),t.push("user_"),t.push(this.paramNames[i]);return t.push(");\n"),t}},{key:"astFunctionExpression",value:function(e,t){if(this.isRootKernel)t.push("void");else{var s=this.returnType,r=l[s];if(!r)throw new Error("unknown type "+s);t.push(r)}if(t.push(" "),t.push(this.functionName),t.push("("),!this.isRootKernel)for(var i=0;i<this.paramNames.length;++i){var a=this.paramNames[i];i>0&&t.push(", ");var n=this.getParamType(a),o=l[n];if(!o)throw new Error("unknown type "+n);t.push(o),t.push(" "),t.push("user_"),t.push(a)}t.push(") {\n");for(var u=0;u<e.body.body.length;++u)this.astGeneric(e.body.body[u],t),t.push("\n");return t.push("}\n"),t}},{key:"astReturnStatement",value:function(e,t){return this.isRootKernel?(t.push("kernelResult = "),this.astGeneric(e.argument,t),t.push(";"),t.push("return;")):this.isSubKernel?(t.push(this.functionName+"Result = "),this.astGeneric(e.argument,t),t.push(";"),t.push("return "+this.functionName+"Result;")):(t.push("return "),this.astGeneric(e.argument,t),t.push(";")),t}},{key:"astLiteral",value:function(e,t){if(isNaN(e.value))throw this.astErrorOutput("Non-numeric literal not supported : "+e.value,e);t.push(e.value);var s=this.isState("in-get-call-parameters");return Number.isInteger(e.value)?s||t.push(".0"):s&&(t.pop(),t.push("int("),t.push(e.value),t.push(")")),t}},{key:"astBinaryExpression",value:function(e,t){var s=this.isState("in-get-call-parameters");return s&&(this.pushState("not-in-get-call-parameters"),t.push("int")),t.push("("),"%"===e.operator?(t.push("mod("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")")):"==="===e.operator?(this.astGeneric(e.left,t),t.push("=="),this.astGeneric(e.right,t)):"!=="===e.operator?(this.astGeneric(e.left,t),t.push("!="),this.astGeneric(e.right,t)):this.fixIntegerDivisionAccuracy&&"/"===e.operator?(t.push("div_with_int_check("),this.astGeneric(e.left,t),t.push(", "),this.astGeneric(e.right,t),t.push(")")):(this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t)),t.push(")"),s&&this.popState("not-in-get-call-parameters"),t}},{key:"astIdentifierExpression",value:function(e,t){if("Identifier"!==e.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",e);var s=!this.isState("in-get-call-parameters");switch(e.name){case"gpu_threadX":s&&t.push("float("),t.push("threadId.x"),s&&t.push(")");break;case"gpu_threadY":s&&t.push("float("),t.push("threadId.y"),s&&t.push(")");break;case"gpu_threadZ":s&&t.push("float("),t.push("threadId.z"),s&&t.push(")");break;case"gpu_outputX":t.push("uOutputDim.x");break;case"gpu_outputY":t.push("uOutputDim.y");break;case"gpu_outputZ":t.push("uOutputDim.z");break;case"Infinity":t.push("3.402823466e+38");break;default:var r=this.getUserParamName(e.name);null!==r?this.pushParameter(t,"user_"+r):this.pushParameter(t,"user_"+e.name)}return t}},{key:"astForStatement",value:function(e,t){if("ForStatement"!==e.type)throw this.astErrorOutput("Invalid for statment",e);if(e.test&&"BinaryExpression"===e.test.type){if("Identifier"===e.test.right.type&&"<"===e.test.operator&&!1===this.isIdentifierConstant(e.test.right.name)){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),t.push("for ("),this.astGeneric(e.init,t),this.astGeneric(e.test.left,t),t.push(e.test.operator),t.push("LOOP_MAX"),t.push(";"),this.astGeneric(e.update,t),t.push(")"),t.push("{\n"),t.push("if ("),this.astGeneric(e.test.left,t),t.push(e.test.operator),this.astGeneric(e.test.right,t),t.push(") {\n"),"BlockStatement"===e.body.type)for(var s=0;s<e.body.body.length;s++)this.astGeneric(e.body.body[s],t);else this.astGeneric(e.body,t);return t.push("\n} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}var r=JSON.parse(JSON.stringify(e.init.declarations)),i=e.update.argument;if(!Array.isArray(r)||r.length<1)throw c(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(r.length>1){for(var a=null,n=0;n<r.length;n++){var o=r[n];o.id.name===i.name?(a=o,r.splice(n,1)):(t.push("float "),this.astGeneric(o,t),t.push(";"))}t.push("for (float "),this.astGeneric(a,t),t.push(";")}else t.push("for ("),this.astGeneric(e.init,t);return this.astGeneric(e.test,t),t.push(";"),this.astGeneric(e.update,t),t.push(")"),this.astGeneric(e.body,t),t}throw this.astErrorOutput("Invalid for statement",e)}},{key:"astWhileStatement",value:function(e,t){if("WhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e);return t.push("for (float i = 0.0; i < LOOP_MAX; i++) {"),t.push("if ("),this.astGeneric(e.test,t),t.push(") {\n"),this.astGeneric(e.body,t),t.push("} else {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astDoWhileStatement",value:function(e,t){if("DoWhileStatement"!==e.type)throw this.astErrorOutput("Invalid while statment",e);return t.push("for (float i = 0.0; i < LOOP_MAX; i++) {"),this.astGeneric(e.body,t),t.push("if (!"),this.astGeneric(e.test,t),t.push(") {\n"),t.push("break;\n"),t.push("}\n"),t.push("}\n"),t}},{key:"astAssignmentExpression",value:function(e,t){if("%="!==e.operator)return this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t;this.astGeneric(e.left,t),t.push("="),t.push("mod("),this.astGeneric(e.left,t),t.push(","),this.astGeneric(e.right,t),t.push(")")}},{key:"astEmptyStatement",value:function(e,t){return t}},{key:"astBlockStatement",value:function(e,t){t.push("{\n");for(var s=0;s<e.body.length;s++)this.astGeneric(e.body[s],t);return t.push("}\n"),t}},{key:"astExpressionStatement",value:function(e,t){return this.astGeneric(e.expression,t),t.push(";"),t}},{key:"astVariableDeclaration",value:function(e,t){for(var s=0;s<e.declarations.length;s++){var r=e.declarations[s];s>0&&t.push(",");var i=[];this.astGeneric(r,i);var a="Number";if(0===s){var n=r.init;if(n)if(n.object){if("MemberExpression"===n.object.type&&n.object.object)if("ThisExpression"!==n.object.object.type||!n.object.property||"thread"!==n.object.property.name&&"output"!==n.object.property.name){if("Identifier"===n.object.object.type){var o=this.getParamType(n.object.object.name);a=b[o]}else if(n.object.object.object&&"Identifier"===n.object.object.object.type){var u=this.getParamType(n.object.object.object.name);a=b[u]}else if(n.object.object.object&&n.object.object.object.object&&"ThisExpression"===n.object.object.object.object.type&&"constants"===n.object.object.object.property.name){var h=this.getConstantType(n.object.object.property.name);a=b[h]}else if(n.object.object.object&&n.object.object.object.object&&n.object.object.object.object.object&&"ThisExpression"===n.object.object.object.object.object.type&&"constants"===n.object.object.object.object.property.name){var p=this.getConstantType(n.object.object.object.property.name);a=b[p]}}else a="Integer";if(!a)throw new Error("unknown lookup type "+b)}else if(n.name&&this.declarations[n.name])a=this.declarations[n.name];else if("ArrayExpression"===n.type)a="Array("+n.elements.length+")";else if("CallExpression"===n.type){var c=this.builder.nodeMap[n.callee.name];c&&c.returnType&&(a=c.returnType)}var m=l[a];if(!m)throw new Error("type "+a+" not handled");t.push(m+" ")}this.declarations[r.id.name]=a,t.push.apply(t,i)}return t.push(";"),t}},{key:"astVariableDeclarator",value:function(e,t){return this.astGeneric(e.id,t),null!==e.init&&(t.push("="),this.astGeneric(e.init,t)),t}},{key:"astIfStatement",value:function(e,t){return t.push("if ("),this.astGeneric(e.test,t),t.push(")"),"BlockStatement"===e.consequent.type?this.astGeneric(e.consequent,t):(t.push(" {\n"),this.astGeneric(e.consequent,t),t.push("\n}\n")),e.alternate&&(t.push("else "),"BlockStatement"===e.alternate.type?this.astGeneric(e.alternate,t):(t.push(" {\n"),this.astGeneric(e.alternate,t),t.push("\n}\n"))),t}},{key:"astBreakStatement",value:function(e,t){return t.push("break;\n"),t}},{key:"astContinueStatement",value:function(e,t){return t.push("continue;\n"),t}},{key:"astLogicalExpression",value:function(e,t){return t.push("("),this.astGeneric(e.left,t),t.push(e.operator),this.astGeneric(e.right,t),t.push(")"),t}},{key:"astUpdateExpression",value:function(e,t){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator)),t}},{key:"astUnaryExpression",value:function(e,t){return e.prefix?(t.push(e.operator),this.astGeneric(e.argument,t)):(this.astGeneric(e.argument,t),t.push(e.operator)),t}},{key:"astThisExpression",value:function(e,t){return t.push("this"),t}},{key:"astMemberExpression",value:function(e,t){if(c("[in] astMemberExpression "+e.object.type),e.computed)if("Identifier"===e.object.type||"MemberExpression"===e.object.type&&e.object.object.object&&"ThisExpression"===e.object.object.object.type&&"constants"===e.object.object.property.name){var s=e.object.name,r=this.functionName||"kernel",i=!1;if(this.paramNames){var a=this.paramNames.indexOf(s);a>=0&&"Number"===this.paramTypes[a]&&(i=!0)}if(c("- astMemberExpression "+s+" "+r),i)this.astGeneric(e.object,t),t.push("[int("),this.astGeneric(e.property,t),t.push(")]");else{var n=this.isState("in-get-call-parameters"),o=this.isState("multi-member-expression");o&&this.popState("multi-member-expression"),this.pushState("not-in-get-call-parameters");var h=null;switch(e.object.name?h=this.declarations[e.object.name]?this.declarations[e.object.name]:this.getParamType(e.object.name):e.object&&e.object.object&&e.object.object.object&&"ThisExpression"===e.object.object.object.type&&(h=this.getConstantType(e.object.property.name)),h){case"Array(2)":case"Array(3)":case"Array(4)":this.astGeneric(e.object,t),t.push("["),t.push(e.property.raw),t.push("]"),o&&this.popState("not-in-get-call-parameters");break;case"HTMLImageArray":t.push("getImage3D("),this.astGeneric(e.object,t),t.push(", ivec2("),this.astGeneric(e.object,t),t.push("Size[0],"),this.astGeneric(e.object,t),t.push("Size[1]), ivec3("),this.astGeneric(e.object,t),t.push("Dim[0],"),this.astGeneric(e.object,t),t.push("Dim[1],"),this.astGeneric(e.object,t),t.push("Dim[2]"),t.push("), "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(e.property,t),o||this.popState("in-get-call-parameters"),t.push(")");break;case"ArrayTexture(4)":case"HTMLImage":t.push("getImage2D("),this.astGeneric(e.object,t),t.push(", ivec2("),this.astGeneric(e.object,t),t.push("Size[0],"),this.astGeneric(e.object,t),t.push("Size[1]), ivec3("),this.astGeneric(e.object,t),t.push("Dim[0],"),this.astGeneric(e.object,t),t.push("Dim[1],"),this.astGeneric(e.object,t),t.push("Dim[2]"),t.push("), "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(e.property,t),o||this.popState("in-get-call-parameters"),t.push(")");break;default:n&&t.push("int("),t.push("get("),this.astGeneric(e.object,t),t.push(", ivec2("),this.astGeneric(e.object,t),t.push("Size[0],"),this.astGeneric(e.object,t),t.push("Size[1]), ivec3("),this.astGeneric(e.object,t),t.push("Dim[0],"),this.astGeneric(e.object,t),t.push("Dim[1],"),this.astGeneric(e.object,t),t.push("Dim[2]"),t.push("), "),this.astGeneric(e.object,t),t.push("BitRatio"),t.push(", "),this.popState("not-in-get-call-parameters"),this.pushState("in-get-call-parameters"),this.astGeneric(e.property,t),o||this.popState("in-get-call-parameters"),t.push(")"),n&&t.push(")")}}}else{c("- astMemberExpression obj:",e.object);this.states.length;var p=this.isState("in-get-call-parameters");p||this.pushState("multi-member-expression"),this.astGeneric(e.object,t),this.isState("multi-member-expression")&&this.popState("multi-member-expression");var l=!p&&this.isState("in-get-call-parameters"),b=t.pop();t.push(","),c("- astMemberExpression prop:",e.property);var m=this.isState("should-pop-in-get-call-parameters");m&&this.popState("should-pop-in-get-call-parameters"),this.astGeneric(e.property,t),t.push(b),l?this.pushState("should-pop-in-get-call-parameters"):m&&this.popState("in-get-call-parameters")}else{var f=this.astMemberExpressionUnroll(e),y=f.toLowerCase();c("- astMemberExpression unrolled:",f),0===f.indexOf(u)&&(f="constants_"+f.slice(u.length));var j=!this.isState("in-get-call-parameters");switch(y){case"this.thread.x":j&&t.push("float("),t.push("threadId.x"),j&&t.push(")");break;case"this.thread.y":j&&t.push("float("),t.push("threadId.y"),j&&t.push(")");break;case"this.thread.z":j&&t.push("float("),t.push("threadId.z"),j&&t.push(")");break;case"this.output.x":t.push(this.output[0]+".0");break;case"this.output.y":t.push(this.output[1]+".0");break;case"this.output.z":t.push(this.output[2]+".0");break;default:e.object&&e.object.name&&this.declarations[e.object.name]&&t.push("user_"),t.push(f)}}return c("[out] astMemberExpression "+e.object.type),t}},{key:"astSequenceExpression",value:function(e,t){for(var s=0;s<e.expressions.length;s++)s>0&&t.push(","),this.astGeneric(e.expressions,t);return t}},{key:"astCallExpression",value:function(e,t){if(e.callee){var s=this.astMemberExpressionUnroll(e.callee);0===s.indexOf(n)&&(s=s.slice(n.length)),0===s.indexOf(o)&&(s=s.slice(o.length)),"atan2"===s&&(s="atan"),this.calledFunctions.indexOf(s)<0&&this.calledFunctions.push(s),this.hasOwnProperty("funcName")||(this.calledFunctionsArguments[s]=[]);var r=[];this.calledFunctionsArguments[s].push(r),t.push(s),t.push("(");for(var i=0;i<e.arguments.length;++i){var a=e.arguments[i];if(i>0&&t.push(", "),this.astGeneric(a,t),"Identifier"===a.type){var u=this.paramNames.indexOf(a.name);-1===u?r.push(null):r.push({name:a.name,type:this.paramTypes[u]||"Number"})}else r.push(null)}return t.push(")"),t}throw this.astErrorOutput("Unknown CallExpression",e)}},{key:"astArrayExpression",value:function(e,t){var s=e.elements.length;t.push("vec"+s+"(");for(var r=0;r<s;++r){r>0&&t.push(", ");var i=e.elements[r];this.astGeneric(i,t)}return t.push(")"),t}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"build",value:function(){return this.getFunctionPrototypeString().length>0}}]),p}();var l={Array:"sampler2D","Array(2)":"vec2","Array(3)":"vec3","Array(4)":"vec4",Array2D:"sampler2D",Array3D:"sampler2D",Float:"float",Input:"sampler2D",Integer:"float",Number:"float",NumberTexture:"sampler2D","ArrayTexture(4)":"sampler2D"},b={Array:"Number",Array2D:"Number",Array3D:"Number",HTMLImage:"Array(4)",HTMLImageArray:"Array(4)",NumberTexture:"Number","ArrayTexture(4)":"Array(4)"};function m(e){return e.replace(h,"((").replace(p,"((")}
},{"../function-node-base":"Ryaz","../../core/utils":"y5hZ"}],"izTu":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../function-builder-base"),u=require("./function-node");function i(e){return Math.floor(e+.5)}module.exports=function(c){function a(){t(this,a);var e=n(this,(a.__proto__||Object.getPrototypeOf(a)).call(this));return e.Node=u,e}return r(a,o),e(a,[{key:"polyfillStandardFunctions",value:function(){this.addFunction("round",i)}}],[{key:"round",value:function(e){return i(e)}}]),a}();
},{"../function-builder-base":"zTps","./function-node":"2H8q"}],"eOVQ":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../runner-base"),u=require("./kernel"),i=require("./function-builder");module.exports=function(c){function a(e){t(this,a);var n=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,new i,e));return n.Kernel=u,n.kernel=null,n}return n(a,o),e(a,[{key:"getMode",value:function(){return"gpu"}}]),a}();
},{"../runner-base":"nVRz","./kernel":"xtMz","./function-builder":"izTu"}],"RfHt":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=require("../web-gl/function-node"),i=/decode32\(\s+encode32\(/g,o=/encode32\(\s+decode32\(/g;function a(t){return t.replace(i,"((").replace(o,"((")}module.exports=function(i){function o(){return e(this,o),r(this,(o.__proto__||Object.getPrototypeOf(o)).apply(this,arguments))}return n(o,u),t(o,[{key:"generate",value:function(){return this.debug&&console.log(this),this.prototypeOnly?this.astFunctionPrototype(this.getJsAST(),[]).join("").trim():(this.functionStringArray=this.astGeneric(this.getJsAST(),[]),this.functionString=a(this.functionStringArray.join("").trim()),this.functionString)}},{key:"astIdentifierExpression",value:function(t,e){if("Identifier"!==t.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);var r=!this.isState("in-get-call-parameters");switch(t.name){case"gpu_threadX":r&&e.push("float("),e.push("threadId.x"),r&&e.push(")");break;case"gpu_threadY":r&&e.push("float("),e.push("threadId.y"),r&&e.push(")");break;case"gpu_threadZ":r&&e.push("float("),e.push("threadId.z"),r&&e.push(")");break;case"gpu_outputX":e.push("uOutputDim.x");break;case"gpu_outputY":e.push("uOutputDim.y");break;case"gpu_outputZ":e.push("uOutputDim.z");break;case"Infinity":e.push("intBitsToFloat(2139095039)");break;default:var n=this.getUserParamName(t.name);null!==n?this.pushParameter(e,"user_"+n):this.pushParameter(e,"user_"+t.name)}return e}}]),o}();
},{"../web-gl/function-node":"2H8q"}],"Ox3a":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("../function-builder-base"),r=require("./function-node");module.exports=function(i){function u(){e(this,u);var o=t(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return o.Node=r,o}return o(u,n),u}();
},{"../function-builder-base":"zTps","./function-node":"RfHt"}],"oIAk":[function(require,module,exports) {
"use strict";module.exports="#version 300 es\n__HEADER__;\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nconst float LOOP_MAX = __LOOP_MAX__;\n\n__CONSTANTS__;\n\nin vec2 vTexCoord;\n\nvec2 integerMod(vec2 x, float y) {\n  vec2 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec3 integerMod(vec3 x, float y) {\n  vec3 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nvec4 integerMod(vec4 x, vec4 y) {\n  vec4 res = floor(mod(x, y));\n  return res * step(1.0 - floor(y), -res);\n}\n\nfloat integerMod(float x, float y) {\n  float res = floor(mod(x, y));\n  return res * (res > floor(y) - 1.0 ? 0.0 : 1.0);\n}\n\nint integerMod(int x, int y) {\n  return x - (y * int(x/y));\n}\n\n__DIVIDE_WITH_INTEGER_CHECK__;\n\n// Here be dragons!\n// DO NOT OPTIMIZE THIS CODE\n// YOU WILL BREAK SOMETHING ON SOMEBODY'S MACHINE\n// LEAVE IT AS IT IS, LEST YOU WASTE YOUR OWN TIME\nconst vec2 MAGIC_VEC = vec2(1.0, -256.0);\nconst vec4 SCALE_FACTOR = vec4(1.0, 256.0, 65536.0, 0.0);\nconst vec4 SCALE_FACTOR_INV = vec4(1.0, 0.00390625, 0.0000152587890625, 0.0); // 1, 1/256, 1/65536\nfloat decode32(vec4 rgba) {\n  __DECODE32_ENDIANNESS__;\n  rgba *= 255.0;\n  vec2 gte128;\n  gte128.x = rgba.b >= 128.0 ? 1.0 : 0.0;\n  gte128.y = rgba.a >= 128.0 ? 1.0 : 0.0;\n  float exponent = 2.0 * rgba.a - 127.0 + dot(gte128, MAGIC_VEC);\n  float res = exp2(round(exponent));\n  rgba.b = rgba.b - 128.0 * gte128.x;\n  res = dot(rgba, SCALE_FACTOR) * exp2(round(exponent-23.0)) + res;\n  res *= gte128.y * -2.0 + 1.0;\n  return res;\n}\n\nvec4 encode32(float f) {\n  float F = abs(f);\n  float sign = f < 0.0 ? 1.0 : 0.0;\n  float exponent = floor(log2(F));\n  float mantissa = (exp2(-exponent) * F);\n  // exponent += floor(log2(mantissa));\n  vec4 rgba = vec4(F * exp2(23.0-exponent)) * SCALE_FACTOR_INV;\n  rgba.rg = integerMod(rgba.rg, 256.0);\n  rgba.b = integerMod(rgba.b, 128.0);\n  rgba.a = exponent*0.5 + 63.5;\n  rgba.ba += vec2(integerMod(exponent+127.0, 2.0), sign) * 128.0;\n  rgba = floor(rgba);\n  rgba *= 0.003921569; // 1/255\n  __ENCODE32_ENDIANNESS__;\n  return rgba;\n}\n// Dragons end here\n\nfloat decode(vec4 rgba, int x, int bitRatio) {\n  if (bitRatio == 1) {\n    return decode32(rgba);\n  }\n  __DECODE32_ENDIANNESS__;\n  int channel = integerMod(x, bitRatio);\n  if (bitRatio == 4) {\n    return rgba[channel] * 255.0;\n  }\n  else {\n    return rgba[channel*2] * 255.0 + rgba[channel*2 + 1] * 65280.0;\n  }\n}\n\nint index;\nivec3 threadId;\n\nivec3 indexTo3D(int idx, ivec3 texDim) {\n  int z = int(idx / (texDim.x * texDim.y));\n  idx -= z * int(texDim.x * texDim.y);\n  int y = int(idx / texDim.x);\n  int x = int(integerMod(idx, texDim.x));\n  return ivec3(x, y, z);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio,  int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  vec4 texel = texture(tex, st / vec2(texSize));\n  __GET_RESULT__;\n  \n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, st / vec2(texSize));\n}\n\nvec4 getImage3D(sampler2DArray tex, ivec2 texSize, ivec3 texDim, int z, int y, int x) {\n  ivec3 xyz = ivec3(x, y, z);\n  __GET_WRAPAROUND__;\n  int index = xyz.x + texDim.x * (xyz.y + texDim.y * xyz.z);\n  __GET_TEXTURE_CHANNEL__;\n  int w = texSize.x;\n  vec2 st = vec2(float(integerMod(index, w)), float(index / w)) + 0.5;\n  __GET_TEXTURE_INDEX__;\n  return texture(tex, vec3(st / vec2(texSize), z));\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int y, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, y, x);\n}\n\nfloat get(sampler2D tex, ivec2 texSize, ivec3 texDim, int bitRatio, int x) {\n  return get(tex, texSize, texDim, bitRatio, 0, 0, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int y, int x) {\n  return getImage2D(tex, texSize, texDim, 0, y, x);\n}\n\nvec4 getImage2D(sampler2D tex, ivec2 texSize, ivec3 texDim, int x) {\n  return getImage2D(tex, texSize, texDim, 0, 0, x);\n}\n\nvec4 actualColor;\nvoid color(float r, float g, float b, float a) {\n  actualColor = vec4(r,g,b,a);\n}\n\nvoid color(float r, float g, float b) {\n  color(r,g,b,1.0);\n}\n\n__MAIN_PARAMS__;\n__MAIN_CONSTANTS__;\n__KERNEL__;\n\nvoid main(void) {\n  index = int(vTexCoord.s * float(uTexSize.x)) + int(vTexCoord.t * float(uTexSize.y)) * uTexSize.x;\n  __MAIN_RESULT__;\n}";
},{}],"Nh4h":[function(require,module,exports) {
"use strict";module.exports="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nin vec2 aPos;\nin vec2 aTexCoord;\n\nout vec2 vTexCoord;\nuniform vec2 ratio;\n\nvoid main(void) {\n  gl_Position = vec4((aPos + vec2(1)) * ratio + vec2(-1), 0, 1);\n  vTexCoord = aTexCoord;\n}";
},{}],"zX6P":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,r,i){return r&&t(e.prototype,r),i&&t(e,i),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=require("../web-gl/kernel"),a=require("../../core/utils"),n=require("../../core/texture"),u=require("./shader-frag"),o=require("./shader-vert");module.exports=function(h){function T(){return e(this,T),r(this,(T.__proto__||Object.getPrototypeOf(T)).apply(this,arguments))}return i(T,s),t(T,[{key:"initWebGl",value:function(){return a.initWebGl2(this.getCanvas())}},{key:"validateOptions",value:function(){var t=a.isFloatReadPixelsSupportedWebGL2();if(!0===this.floatOutput&&!0!==this.floatOutputForce&&!t)throw new Error("Float texture outputs are not supported on this browser");void 0===this.floatTextures&&(this.floatTextures=!0,this.floatOutput=t);var e=a.hasIntegerDivisionAccuracyBug();if(null===this.fixIntegerDivisionAccuracy?this.fixIntegerDivisionAccuracy=e:this.fixIntegerDivisionAccuracy&&!e&&(this.fixIntegerDivisionAccuracy=!1),a.checkOutput(this.output),!this.output||0===this.output.length){if(1!==arguments.length)throw new Error("Auto output only supported for kernels with only one input");var r=a.getArgumentType(arguments[0]);if("Array"===r)this.output=a.getDimensions(r);else{if("NumberTexture"!==r&&"ArrayTexture(4)"!==r)throw new Error("Auto output not supported for input type: "+r);this.output=arguments[0].output}}if(this.texSize=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0),this.graphical){if(2!==this.output.length)throw new Error("Output must have 2 dimensions on graphical mode");this.floatOutput&&(this.floatOutput=!1,console.warn("Cannot use graphical mode and float output at the same time")),this.texSize=a.clone(this.output)}else void 0===this.floatOutput&&(this.floatOutput=!0);(this.floatOutput||this.floatOutputForce)&&this._webGl.getExtension("EXT_color_buffer_float")}},{key:"run",value:function(){null===this.program&&this.build.apply(this,arguments);var t=this.paramNames,e=this.paramTypes,r=this.texSize,i=this._webGl;i.useProgram(this.program),i.scissor(0,0,r[0],r[1]),this.hardcodeConstants||(this.setUniform3iv("uOutputDim",new Int32Array(this.threadDim)),this.setUniform2iv("uTexSize",r)),this.setUniform2f("ratio",r[0]/this.maxTexSize[0],r[1]/this.maxTexSize[1]),this.argumentsLength=0;for(var s=0;s<t.length;s++)this._addArgument(arguments[s],e[s],t[s]);if(this.graphical)return this.outputToTexture?(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputTexture&&!this.outputImmutable||this._setupOutputTexture(),i.drawArrays(i.TRIANGLE_STRIP,0,4),new n(this.outputTexture,r,this.threadDim,this.output,this._webGl,"ArrayTexture(4)")):(i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),void i.drawArrays(i.TRIANGLE_STRIP,0,4));i.bindFramebuffer(i.FRAMEBUFFER,this.framebuffer),this.outputImmutable&&this._setupOutputTexture();var a=this.outputTexture;if(null!==this.subKernelOutputVariableNames&&(this.outputImmutable&&(this.subKernelOutputTextures=[],this._setupSubOutputTextures(this.subKernelOutputVariableNames.length)),i.drawBuffers(this.drawBuffersMap)),i.drawArrays(i.TRIANGLE_STRIP,0,4),null!==this.subKernelOutputTextures){if(null!==this.subKernels){var u=[];u.result=this.renderOutput(a);for(var o=0;o<this.subKernels.length;o++)u.push(new n(this.subKernelOutputTextures[o],r,this.threadDim,this.output,this._webGl));return u}if(null!==this.subKernelProperties){var h={result:this.renderOutput(a)},T=0;for(var E in this.subKernelProperties)this.subKernelProperties.hasOwnProperty(E)&&(h[E]=new n(this.subKernelOutputTextures[T],r,this.threadDim,this.output,this._webGl),T++);return h}}return this.renderOutput(a)}},{key:"getOutputTexture",value:function(){return this.outputTexture}},{key:"_setupOutputTexture",value:function(){var t=this._webGl,e=this.texSize,r=this.outputTexture=this._webGl.createTexture();t.activeTexture(t.TEXTURE0+this.constantsLength+this.paramNames.length),t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),this.floatOutput?t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,e[0],e[1],0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e[0],e[1],0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}},{key:"_setupSubOutputTextures",value:function(t){for(var e=this._webGl,r=this.texSize,i=this.drawBuffersMap=[e.COLOR_ATTACHMENT0],s=this.subKernelOutputTextures=[],a=0;a<t;a++){var n=this._webGl.createTexture();s.push(n),i.push(e.COLOR_ATTACHMENT0+a+1),e.activeTexture(e.TEXTURE0+this.constantsLength+this.paramNames.length+a),e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),this.floatOutput?e.texImage2D(e.TEXTURE_2D,0,e.RGBA32F,r[0],r[1],0,e.RGBA,e.FLOAT,null):e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r[0],r[1],0,e.RGBA,e.UNSIGNED_BYTE,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+a+1,e.TEXTURE_2D,n,0)}}},{key:"_addArgument",value:function(t,e,r){var i=this._webGl,s=this.getArgumentTexture(r);switch(t instanceof n&&(e=t.type),e){case"Array":var u=a.getDimensions(t,!0),o=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},u);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],T=this._formatArrayTransfer(t,h),E=T.valuesFlat,_=T.bitRatio,l=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,o[0],o[1],0,i.RGBA,i.FLOAT,E):(l=new Uint8Array(E.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/_,o[1],0,i.RGBA,i.UNSIGNED_BYTE,l)),this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",u),this.setUniform2iv("user_"+r+"Size",o)),this.setUniform1i("user_"+r+"BitRatio",_),this.setUniform1i("user_"+r,this.argumentsLength);break;case"Integer":case"Float":case"Number":this.setUniform1f("user_"+r,t);break;case"Input":var R=t.size,f=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},R);i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var p=f[0]*f[1],m=this._formatArrayTransfer(t.value,p),c=m.valuesFlat,g=m.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,f[0],f[1],0,i.RGBA,i.FLOAT,inputArray);else{var A=new Uint8Array(c.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,f[0]/g,f[1],0,i.RGBA,i.UNSIGNED_BYTE,A)}this.hardcodeConstants||(this.setUniform3iv("user_"+r+"Dim",R),this.setUniform2iv("user_"+r+"Size",f)),this.setUniform1i("user_"+r+"BitRatio",g),this.setUniform1i("user_"+r,this.argumentsLength);break;case"HTMLImage":var x=t,U=[x.width,x.height,1],d=[x.width,x.height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var D=i.RGBA,v=i.RGBA,b=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,D,v,b,x),this.setUniform3iv("user_"+r+"Dim",U),this.setUniform2iv("user_"+r+"Size",d),this.setUniform1i("user_"+r,this.argumentsLength);break;case"HTMLImageArray":var S=t,X=[S[0].width,S[0].height,S.length],I=[S[0].width,S[0].height];i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D_ARRAY,s),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MIN_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var y=i.RGBA,L=S[0].width,O=S[0].height,P=S.length,G=i.RGBA,N=i.UNSIGNED_BYTE;i.texImage3D(i.TEXTURE_2D_ARRAY,0,y,L,O,P,0,G,N,null);for(var F=0;F<S.length;F++){i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,F,S[F].width,S[F].height,1,G,N,S[F])}this.setUniform3iv("user_"+r+"Dim",X),this.setUniform2iv("user_"+r+"Size",I),this.setUniform1i("user_"+r,this.argumentsLength);break;case"ArrayTexture(4)":case"NumberTexture":var w=t,B=w.dimensions,M=w.size;i.activeTexture(i.TEXTURE0+this.constantsLength+this.argumentsLength),i.bindTexture(i.TEXTURE_2D,w.texture),this.setUniform3iv("user_"+r+"Dim",B),this.setUniform2iv("user_"+r+"Size",M),this.setUniform1i("user_"+r+"BitRatio",1),this.setUniform1i("user_"+r,this.argumentsLength);break;default:throw new Error("Input type not supported (WebGL): "+t)}this.argumentsLength++}},{key:"_getMainConstantsString",value:function(){var t=[];if(this.constants)for(var e in this.constants)if(this.constants.hasOwnProperty(e)){var r=this.constants[e],i=a.getArgumentType(r);switch(i){case"Integer":t.push("const float constants_"+e+" = "+parseInt(r)+".0");break;case"Float":t.push("const float constants_"+e+" = "+parseFloat(r));break;case"Array":case"Input":case"HTMLImage":case"ArrayTexture(4)":case"NumberTexture":t.push("uniform highp sampler2D constants_"+e,"uniform highp ivec2 constants_"+e+"Size","uniform highp ivec3 constants_"+e+"Dim","uniform highp int constants_"+e+"BitRatio");break;case"HTMLImageArray":t.push("uniform highp sampler2DArray constants_"+e,"uniform highp ivec2 constants_"+e+"Size","uniform highp ivec3 constants_"+e+"Dim","uniform highp int constants_"+e+"BitRatio");break;default:throw new Error("Unsupported constant "+e+" type "+i)}}return this._linesToString(t)}},{key:"_addConstant",value:function(t,e,r){var i=this._webGl,s=this.getArgumentTexture(r);switch(t instanceof n&&(e=t.type),e){case"Array":var u=a.getDimensions(t,!0),o=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},u);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var h=o[0]*o[1],T=this._formatArrayTransfer(t,h),E=T.valuesFlat,_=T.bitRatio,l=void 0;this.floatTextures?i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0],o[1],0,i.RGBA,i.FLOAT,E):(l=new Uint8Array(E.buffer),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,o[0]/_,o[1],0,i.RGBA,i.UNSIGNED_BYTE,l)),this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",u),this.setUniform2iv("constants_"+r+"Size",o)),this.setUniform1i("constants_"+r+"BitRatio",_),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Input":var R=t.size,f=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},R);i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST);var p=f[0]*f[1],m=this._formatArrayTransfer(t.value,p),c=m.valuesFlat,g=m.bitRatio;if(this.floatTextures)i.texImage2D(i.TEXTURE_2D,0,i.RGBA32F,f[0],f[1],0,i.RGBA,i.FLOAT,inputArray);else{var A=new Uint8Array(c.buffer);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,f[0]/g,f[1],0,i.RGBA,i.UNSIGNED_BYTE,A)}this.hardcodeConstants||(this.setUniform3iv("constants_"+r+"Dim",R),this.setUniform2iv("constants_"+r+"Size",f)),this.setUniform1i("constants_"+r+"BitRatio",g),this.setUniform1i("constants_"+r,this.constantsLength);break;case"HTMLImage":var x=t,U=[x.width,x.height,1],d=[x.width,x.height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var D=i.RGBA,v=i.RGBA,b=i.UNSIGNED_BYTE;i.texImage2D(i.TEXTURE_2D,0,D,v,b,x),this.setUniform3iv("constants_"+r+"Dim",U),this.setUniform2iv("constants_"+r+"Size",d),this.setUniform1i("constants_"+r,this.constantsLength);break;case"HTMLImageArray":var S=t,X=[S[0].width,S[0].height,S.length],I=[S[0].width,S[0].height];i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D_ARRAY,s),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D_ARRAY,i.TEXTURE_MIN_FILTER,i.NEAREST),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);var y=i.RGBA,L=S[0].width,O=S[0].height,P=S.length,G=i.RGBA,N=i.UNSIGNED_BYTE;i.texImage3D(i.TEXTURE_2D_ARRAY,0,y,L,O,P,0,G,N,null);for(var F=0;F<S.length;F++){i.texSubImage3D(i.TEXTURE_2D_ARRAY,0,0,0,F,S[F].width,S[F].height,1,G,N,S[F])}this.setUniform3iv("constants_"+r+"Dim",X),this.setUniform2iv("constants_"+r+"Size",I),this.setUniform1i("constants_"+r,this.constantsLength);break;case"ArrayTexture(4)":case"NumberTexture":var w=t,B=w.dimensions,M=w.size;i.activeTexture(i.TEXTURE0+this.constantsLength),i.bindTexture(i.TEXTURE_2D,w.texture),this.setUniform3iv("constants_"+r+"Dim",B),this.setUniform2iv("constants_"+r+"Size",M),this.setUniform1i("constants_"+r+"BitRatio",1),this.setUniform1i("constants_"+r,this.constantsLength);break;case"Integer":case"Float":default:throw new Error("Input type not supported (WebGL): "+t)}}},{key:"_getGetResultString",value:function(){return this.floatTextures?"  return texel[channel];":"  return decode(texel, x, bitRatio);"}},{key:"_getHeaderString",value:function(){return""}},{key:"_getTextureCoordinate",value:function(){var t=this.subKernelOutputVariableNames;return null===t||t.length<1?"in highp vec2 vTexCoord;\n":"out highp vec2 vTexCoord;\n"}},{key:"_getMainParamsString",value:function(t){for(var e=[],r=this.paramTypes,i=this.paramNames,s=0;s<i.length;s++){var n=t[s],u=i[s],o=r[s];if(this.hardcodeConstants)if("Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o){var h=a.getDimensions(n,!0),T=a.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},h);e.push("uniform highp sampler2D user_"+u,"highp ivec2 user_"+u+"Size = ivec2("+T[0]+", "+T[1]+")","highp ivec3 user_"+u+"Dim = ivec3("+h[0]+", "+h[1]+", "+h[2]+")","uniform highp int user_"+u+"BitRatio")}else"Integer"===o?e.push("highp float user_"+u+" = "+n+".0"):"Float"===o&&e.push("highp float user_"+u+" = "+n);else"Array"===o||"NumberTexture"===o||"ArrayTexture(4)"===o||"Input"===o||"HTMLImage"===o?(e.push("uniform highp sampler2D user_"+u,"uniform highp ivec2 user_"+u+"Size","uniform highp ivec3 user_"+u+"Dim"),"HTMLImage"!==o&&e.push("uniform highp int user_"+u+"BitRatio")):"HTMLImageArray"===o?e.push("uniform highp sampler2DArray user_"+u,"uniform highp ivec2 user_"+u+"Size","uniform highp ivec3 user_"+u+"Dim"):"Integer"!==o&&"Float"!==o||e.push("uniform float user_"+u)}return this._linesToString(e)}},{key:"_getKernelString",value:function(){var t=[],e=this.subKernelOutputVariableNames;if(null!==e){t.push("float kernelResult = 0.0"),t.push("layout(location = 0) out vec4 data0");for(var r=0;r<e.length;r++)t.push("float "+e[r]+" = 0.0","layout(location = "+(r+1)+") out vec4 data"+(r+1))}else t.push("out vec4 data0"),t.push("float kernelResult = 0.0");return this._linesToString(t)+this.functionBuilder.getPrototypeString("kernel")}},{key:"_getMainResultString",value:function(){var t=this.subKernelOutputVariableNames,e=[];if(this.floatOutput&&e.push("  index *= 4"),this.graphical)e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = actualColor");else if(this.floatOutput)for(var r=["r","g","b","a"],i=0;i<r.length;++i){if(e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),t){e.push("  data0."+r[i]+" = kernelResult");for(var s=0;s<t.length;++s)e.push("  data"+(s+1)+"."+r[i]+" = "+t[s])}else e.push("  data0."+r[i]+" = kernelResult");i<r.length-1&&e.push("  index += 1")}else if(null!==t){e.push("  threadId = indexTo3D(index, uOutputDim)"),e.push("  kernel()"),e.push("  data0 = encode32(kernelResult)");for(var a=0;a<t.length;a++)e.push("  data"+(a+1)+" = encode32("+t[a]+")")}else e.push("  threadId = indexTo3D(index, uOutputDim)","  kernel()","  data0 = encode32(kernelResult)");return this._linesToString(e)}},{key:"_addKernels",value:function(){var t=this,e=this.functionBuilder;this._webGl;e.addFunctions(this.functions,{constants:this.constants,output:this.output}),e.addNativeFunctions(this.nativeFunctions),e.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations,paramNames:this.paramNames,paramTypes:this.paramTypes,constantTypes:this.constantTypes,fixIntegerDivisionAccuracy:this.fixIntegerDivisionAccuracy}),null!==this.subKernels?(this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[],this.subKernels.forEach(function(e){return t._addSubKernel(e)})):null!==this.subKernelProperties&&(this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[],Object.keys(this.subKernelProperties).forEach(function(e){return t._addSubKernel(t.subKernelProperties[e])}))}},{key:"_getFragShaderString",value:function(t){return null!==this.compiledFragShaderString?this.compiledFragShaderString:this.compiledFragShaderString=this._replaceArtifacts(this.constructor.fragShaderString,this._getFragShaderArtifactMap(t))}},{key:"_getVertShaderString",value:function(t){return null!==this.compiledVertShaderString?this.compiledVertShaderString:this.compiledVertShaderString=this.constructor.vertShaderString}}],[{key:"fragShaderString",get:function(){return u}},{key:"vertShaderString",get:function(){return o}}]),T}();
},{"../web-gl/kernel":"xtMz","../../core/utils":"y5hZ","../../core/texture":"34im","./shader-frag":"oIAk","./shader-vert":"Nh4h"}],"mZ2N":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../runner-base"),u=require("./function-builder"),i=require("./kernel");module.exports=function(c){function a(e){t(this,a);var n=r(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,new u,e));return n.Kernel=i,n.kernel=null,n}return n(a,o),e(a,[{key:"getMode",value:function(){return"gpu"}}]),a}();
},{"../runner-base":"nVRz","./function-builder":"Ox3a","./kernel":"zX6P"}],"JfX0":[function(require,module,exports) {
"use strict";var n=require("../../core/utils"),t=require("../kernel-run-shortcut");function e(n){return/^function /.test(n)&&(n=n.substring(9)),n.replace(/[_]typeof/g,"typeof")}function r(n){return n.replace(/[_]typeof/g,"typeof")}module.exports=function(i,s){return"() => {\n    "+t.toString()+";\n    const utils = {\n      allPropertiesOf: "+r(n.allPropertiesOf.toString())+",\n      clone: "+r(n.clone.toString())+",\n      checkOutput: "+r(n.checkOutput.toString())+"\n    };\n    const Utils = utils;\n    let Input = function() {};\n    class "+(s||"Kernel")+" {\n      constructor() {        \n        this.argumentsLength = 0;\n        this._canvas = null;\n        this._webGl = null;\n        this.built = false;\n        this.program = null;\n        this.paramNames = "+JSON.stringify(i.paramNames)+";\n        this.paramTypes = "+JSON.stringify(i.paramTypes)+";\n        this.texSize = "+JSON.stringify(i.texSize)+";\n        this.output = "+JSON.stringify(i.output)+";\n        this._kernelString = `"+i._kernelString+"`;\n        this.output = "+JSON.stringify(i.output)+";\n\t\t    this.run = function() {\n          this.run = null;\n          this.build();\n          return this.run.apply(this, arguments);\n        }.bind(this);\n        this.thread = {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n      }\n      setCanvas(canvas) { this._canvas = canvas; return this; }\n      setWebGl(webGl) { this._webGl = webGl; return this; }\n      setInput(Type) { Input = Type; }\n      "+e(i.build.toString())+"\n      "+e(i.setupParams.toString())+"\n      "+e(i.setupConstants.toString())+"\n      run () { "+i.kernelString+" }\n      getKernelString() { return this._kernelString; }\n      "+e(i.validateOptions.toString())+"\n    };\n    return kernelRunShortcut(new Kernel());\n  };"};
},{"../../core/utils":"y5hZ","../kernel-run-shortcut":"EzOd"}],"DNTx":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=require("../kernel-base"),a=require("../../core/utils"),i=require("./kernel-string");module.exports=function(u){function o(t,n){e(this,o);var s=r(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t,n));return s._fn=null,s.run=null,s._canvasCtx=null,s._imageData=null,s._colorData=null,s._kernelString=null,s.thread={x:0,y:0,z:0},s.run=function(){return this.run=null,this.build.apply(this,arguments),this.run.apply(this,arguments)}.bind(s),s}return n(o,s),t(o,[{key:"validateOptions",value:function(){if(!this.output||0===this.output.length){if(1!==arguments.length)throw"Auto dimensions only supported for kernels with only one input";var t=a.getArgumentType(arguments[0]);if("Array"===t)this.output=a.getDimensions(t);else{if("NumberTexture"!==t&&"ArrayTexture(4)"!==t)throw"Auto dimensions not supported for input type: "+t;this.output=arguments[0].output}}a.checkOutput(this.output)}},{key:"build",value:function(){this.setupConstants(),this.setupParams(arguments),this.validateOptions();var t=this._canvas;t&&(this._canvasCtx=t.getContext("2d"));for(var e=this.threadDim=a.clone(this.output);e.length<3;)e.push(1);if(this.graphical){var r=this._canvas;if(!r)throw new Error("no canvas available for using graphical output");r.width=e[0],r.height=e[1],this._imageData=this._canvasCtx.createImageData(e[0],e[1]),this._colorData=new Uint8ClampedArray(e[0]*e[1]*4)}var n=this.getKernelString();this.debug&&(console.log("Options:"),console.dir(this),console.log("Function output:"),console.log(n)),this.kernelString=n,this.run=new Function([],n).bind(this)()}},{key:"color",value:function(t,e,r,n){void 0===n&&(n=1),t=Math.floor(255*t),e=Math.floor(255*e),r=Math.floor(255*r),n=Math.floor(255*n);var s=this.output[0],a=this.output[1],i=this.thread.x+(a-this.thread.y-1)*s;this._colorData[4*i+0]=t,this._colorData[4*i+1]=e,this._colorData[4*i+2]=r,this._colorData[4*i+3]=n}},{key:"getKernelString",value:function(){if(null!==this._kernelString)return this._kernelString;for(var t=this.functionBuilder,e=this.threadDim||(this.threadDim=a.clone(this.output));e.length<3;)e.push(1);if(t.addKernel(this.fnString,{prototypeOnly:!1,constants:this.constants,output:e,debug:this.debug,loopMaxIterations:this.loopMaxIterations,paramNames:this.paramNames,paramTypes:this.paramTypes,paramSizes:this.paramSizes,constantTypes:this.constantTypes}),t.addFunctions(this.functions,{constants:this.constants,output:e}),t.addNativeFunctions(this.nativeFunctions),null!==this.subKernels){this.subKernelOutputTextures=[],this.subKernelOutputVariableNames=[];for(var r=0;r<this.subKernels.length;r++){var n=this.subKernels[r];t.addSubKernel(n,{prototypeOnly:!1,constants:this.constants,output:this.output,debug:this.debug,loopMaxIterations:this.loopMaxIterations}),this.subKernelOutputVariableNames.push(n.name+"Result")}}else if(null!==this.subKernelProperties){this.subKernelOutputVariableNames=[];for(var s in this.subKernelProperties)if(this.subKernelProperties.hasOwnProperty(s)){var i=this.subKernelProperties[s];t.addSubKernel(i),this.subKernelOutputVariableNames.push(i.name+"Result"),0}}var u=t.getPrototypes("kernel"),o=null;return u.length>1?u=u.filter(function(t){return/^function/.test(t)?t:(o=t,!1)}):o=u.shift(),this._kernelString="\n\t\tvar LOOP_MAX = "+this._getLoopMaxString()+"\n\t\tvar constants = this.constants;\n\t\tvar _this = this;\n    return function ("+this.paramNames.map(function(t){return"user_"+t}).join(", ")+") {\n      "+this._processConstants()+"\n      "+this._processParams()+"\n      "+this._kernelLoop(o)+"\n      if (this.graphical) {\n        this._imageData.data.set(this._colorData);\n        this._canvasCtx.putImageData(this._imageData, 0, 0);\n        return;\n      }\n      "+this._kernelOutput()+"\n      "+(u.length>0?u.join("\n"):"")+"\n    }.bind(this);"}},{key:"toString",value:function(){return i(this)}},{key:"_getLoopMaxString",value:function(){return this.loopMaxIterations?" "+parseInt(this.loopMaxIterations)+";\n":" 1000;\n"}},{key:"_processConstants",value:function(){if(!this.constants)return"";var t=[];for(var e in this.constants){switch(this.constantTypes[e]){case"HTMLImage":t.push("  var constants_"+e+" = this._imageTo2DArray(this.constants."+e+")");break;case"HTMLImageArray":t.push("  var constants_"+e+" = this._imageTo3DArray(this.constants."+e+")");break;case"Input":t.push("  var constants_"+e+" = this.constants."+e+".value");break;default:t.push("  var constants_"+e+" = this.constants."+e)}}return t.join("\n")}},{key:"_processParams",value:function(){for(var t=[],e=0;e<this.paramTypes.length;e++)switch(this.paramTypes[e]){case"HTMLImage":t.push("  user_"+this.paramNames[e]+" = this._imageTo2DArray(user_"+this.paramNames[e]+")");break;case"HTMLImageArray":t.push("  user_"+this.paramNames[e]+" = this._imageTo3DArray(user_"+this.paramNames[e]+")");break;case"Input":t.push("  user_"+this.paramNames[e]+" = user_"+this.paramNames[e]+".value")}return t.join(";\n")}},{key:"_imageTo2DArray",value:function(t){var e=this._canvas;e.width<t.width&&(e.width=t.width),e.height<t.height&&(e.height=t.height);var r=this._canvasCtx;r.drawImage(t,0,0,t.width,t.height);for(var n=r.getImageData(0,0,t.width,t.height).data,s=new Array(t.height),a=0,i=t.height-1;i>=0;i--){s[i]=new Array(t.width);for(var u=0;u<t.width;u++){var o=n[a++]/255,h=n[a++]/255,l=n[a++]/255,p=n[a++]/255,c=[o,h,l,p];c.r=o,c.g=h,c.b=l,c.a=p,s[i][u]=c}}return s}},{key:"_imageTo3DArray",value:function(t){for(var e=new Array(t.length),r=0;r<t.length;r++)e[r]=this._imageTo2DArray(t[r]);return e}},{key:"_kernelLoop",value:function(t){switch(this.output.length){case 1:return this._kernel1DLoop(t);case 2:return this._kernel2DLoop(t);case 3:return this._kernel3DLoop(t);default:throw new Error("unsupported size kernel")}}},{key:"_kernel1DLoop",value:function(t){var e=this.threadDim;return"\n    var result = new Float32Array("+e[0]+");\n    "+this._mapSubKernels(function(t){return"var result_"+t+" = new Float32Array("+e[0]+");\n"}).join("")+"\n    for (var x = 0; x < "+e[0]+"; x++) {\n      this.thread.x = x;\n      this.thread.y = 0;\n      this.thread.z = 0;\n      var kernelResult;\n      "+t+"\n      result[x] = kernelResult;\n      "+this._mapSubKernels(function(t){return"result_"+t+"[x] = "+t+";\n"}).join("")+"\n    }"}},{key:"_kernel2DLoop",value:function(t){var e=this.threadDim;return"\n    var result = new Array("+e[1]+");\n    "+this._mapSubKernels(function(t){return"var result_"+t+" = new Array("+e[1]+");\n"}).join("")+"\n    for (var y = 0; y < "+e[1]+"; y++) {\n      this.thread.z = 0;\n      this.thread.y = y;\n      var resultX = result[y] = new Float32Array("+e[0]+");\n      "+this._mapSubKernels(function(t){return"var result_"+t+"X = result_"+t+"[y] = new Float32Array("+e[0]+");\n"}).join("")+"\n      for (var x = 0; x < "+e[0]+"; x++) {\n      \tthis.thread.x = x;\n        var kernelResult;\n        "+t+"\n        resultX[x] = kernelResult;\n        "+this._mapSubKernels(function(t){return"result_"+t+"X[x] = "+t+";\n"}).join("")+"\n      }\n    }"}},{key:"_kernel3DLoop",value:function(t){var e=this.threadDim;return"\n    var result = new Array("+e[2]+");\n    "+this._mapSubKernels(function(t){return"var result_"+t+" = new Array("+e[2]+");\n"}).join("")+"\n    for (var z = 0; z < "+e[2]+"; z++) {\n      this.thread.z = z;\n      var resultY = result[z] = new Array("+e[1]+");\n      "+this._mapSubKernels(function(t){return"var result_"+t+"Y = result_"+t+"[z] = new Array("+e[1]+");\n"}).join("")+"\n      for (var y = 0; y < "+e[1]+"; y++) {\n        this.thread.y = y;\n        var resultX = resultY[y] = new Float32Array("+e[0]+");\n        "+this._mapSubKernels(function(t){return"var result_"+t+"X = result_"+t+"Y[y] = new Float32Array("+e[0]+");\n"}).join("")+"\n        for (var x = 0; x < "+e[0]+"; x++) {\n        \tthis.thread.x = x;\n          var kernelResult;\n          "+t+"\n          resultX[x] = kernelResult;\n          "+this._mapSubKernels(function(t){return"result_"+t+"X[x] = "+t+";\n"}).join("")+"\n        }\n      }\n    }"}},{key:"_kernelOutput",value:function(){var t=this;return this.subKernelOutputVariableNames?"return {\n      result: result,\n      "+Object.keys(this.subKernelProperties||this.subKernelOutputVariableNames).map(function(e,r){return e+": result_"+t.subKernelOutputVariableNames[r]}).join(",\n")+"\n    };":"return result;"}},{key:"_mapSubKernels",value:function(t){return null===this.subKernelOutputVariableNames?[""]:this.subKernelOutputVariableNames.map(t)}}]),o}();
},{"../kernel-base":"NzEZ","../../core/utils":"y5hZ","./kernel-string":"JfX0"}],"nD9a":[function(require,module,exports) {
"use strict";var t=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}();function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=require("../function-node-base"),r=require("../../core/utils");module.exports=function(a){function u(t,n,i){e(this,u);var r=s(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,t,n,i));return r.paramSizes=i?i.paramSizes:[],r.memberStates=[],r}return n(u,i),t(u,[{key:"pushMemberState",value:function(t){this.memberStates.push(t)}},{key:"popMemberState",value:function(t){if(this.memberState!==t)throw new Error("Cannot popMemberState "+t+" when in "+this.memberState);this.memberStates.pop()}},{key:"generate",value:function(){return this.debug&&console.log(this),this.functionStringArray=this.astGeneric(this.getJsAST(),[]),this.functionString=this.functionStringArray.join("").trim(),this.functionString}},{key:"getFunctionPrototypeString",value:function(){return this.webGlFunctionPrototypeString?this.webGlFunctionPrototypeString:this.webGlFunctionPrototypeString=this.generate()}},{key:"astFunctionDeclaration",value:function(t,e){return this.builder.addFunction(null,r.getAstString(this.jsFunctionString,t)),e}},{key:"astFunctionPrototype",value:function(t,e){if(this.isRootKernel||this.isSubKernel)return e;e.push(this.returnType),e.push(" "),e.push(this.functionName),e.push("(");for(var s=0;s<this.paramNames.length;++s)s>0&&e.push(", "),e.push("user_"),e.push(this.paramNames[s]);return e.push(");\n"),e}},{key:"astFunctionExpression",value:function(t,e){if(!this.isRootKernel){e.push("function"),e.push(" "),e.push(this.functionName),e.push("(");for(var s=0;s<this.paramNames.length;++s){var n=this.paramNames[s];s>0&&e.push(", "),e.push("user_"),e.push(n)}e.push(") {\n")}for(var i=0;i<t.body.body.length;++i)this.astGeneric(t.body.body[i],e),e.push("\n");return this.isRootKernel||e.push("}\n"),e}},{key:"astReturnStatement",value:function(t,e){return this.isRootKernel?(e.push("kernelResult = "),this.astGeneric(t.argument,e),e.push(";")):this.isSubKernel?(e.push(this.functionName+"Result = "),this.astGeneric(t.argument,e),e.push(";"),e.push("return "+this.functionName+"Result;")):(e.push("return "),this.astGeneric(t.argument,e),e.push(";")),e}},{key:"astLiteral",value:function(t,e){if(isNaN(t.value))throw this.astErrorOutput("Non-numeric literal not supported : "+t.value,t);return e.push(t.value),e}},{key:"astBinaryExpression",value:function(t,e){return e.push("("),this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e.push(")"),e}},{key:"astIdentifierExpression",value:function(t,e){if("Identifier"!==t.type)throw this.astErrorOutput("IdentifierExpression - not an Identifier",t);switch(this.state){case"input-index-y":case"input-index-z":e.push("(")}switch(t.name){case"gpu_threadX":e.push("threadId.x");break;case"gpu_threadY":e.push("threadId.y");break;case"gpu_threadZ":e.push("threadId.z");break;case"gpu_outputX":e.push("uOutputDim.x");break;case"gpu_outputY":e.push("uOutputDim.y");break;case"gpu_outputZ":e.push("uOutputDim.z");break;case"Infinity":e.push("Infinity");break;default:if(this.constants&&this.constants.hasOwnProperty(t.name))e.push("constants_"+t.name);else{var s=this.getUserParamName(t.name);null!==s?e.push("user_"+s):e.push("user_"+t.name)}}switch(this.state){case"input-index-y":var n=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+n[0]+")");break;case"input-index-z":var i=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+i[0]*i[1]+")")}return e}},{key:"astForStatement",value:function(t,e){if("ForStatement"!==t.type)throw this.astErrorOutput("Invalid for statement",t);if(t.test&&"BinaryExpression"===t.test.type){if(("Identifier"===t.test.right.type||"Literal"===t.test.right.type)&&"<"===t.test.operator&&!1===this.isIdentifierConstant(t.test.right.name)){if(this.loopMaxIterations||(console.warn("Warning: loopMaxIterations is not set! Using default of 1000 which may result in unintended behavior."),console.warn("Set loopMaxIterations or use a for loop of fixed length to silence this message.")),e.push("for ("),this.astGeneric(t.init,e),";"!==e[e.length-1]&&e.push(";"),this.astGeneric(t.test.left,e),e.push(t.test.operator),e.push("LOOP_MAX"),e.push(";"),this.astGeneric(t.update,e),e.push(")"),e.push("{\n"),e.push("if ("),this.astGeneric(t.test.left,e),e.push(t.test.operator),this.astGeneric(t.test.right,e),e.push(") {\n"),"BlockStatement"===t.body.type)for(var s=0;s<t.body.body.length;s++)this.astGeneric(t.body.body[s],e);else this.astGeneric(t.body,e);return e.push("} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}if(t.init.declarations){var n=JSON.parse(JSON.stringify(t.init.declarations)),i=t.update.argument;if(!Array.isArray(n)||n.length<1)throw console.log(this.jsFunctionString),new Error("Error: Incompatible for loop declaration");if(n.length>1){for(var r=null,a=0;a<n.length;a++){var u=n[a];u.id.name===i.name?(r=u,n.splice(a,1)):(e.push("var "),this.astGeneric(u,e),e.push(";"))}e.push("for (let "),this.astGeneric(r,e),e.push(";")}else e.push("for ("),this.astGeneric(t.init,e);return this.astGeneric(t.test,e),e.push(";"),this.astGeneric(t.update,e),e.push(")"),this.astGeneric(t.body,e),e}}throw this.astErrorOutput("Invalid for statement",t)}},{key:"astWhileStatement",value:function(t,e){if("WhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statement",t);return e.push("for (let i = 0; i < LOOP_MAX; i++) {"),e.push("if ("),this.astGeneric(t.test,e),e.push(") {\n"),this.astGeneric(t.body,e),e.push("} else {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astDoWhileStatement",value:function(t,e){if("DoWhileStatement"!==t.type)throw this.astErrorOutput("Invalid while statement",t);return e.push("for (let i = 0; i < LOOP_MAX; i++) {"),this.astGeneric(t.body,e),e.push("if (!"),this.astGeneric(t.test,e),e.push(") {\n"),e.push("break;\n"),e.push("}\n"),e.push("}\n"),e}},{key:"astAssignmentExpression",value:function(t,e){return this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e}},{key:"astEmptyStatement",value:function(t,e){return e}},{key:"astBlockStatement",value:function(t,e){e.push("{\n");for(var s=0;s<t.body.length;s++)this.astGeneric(t.body[s],e);return e.push("}\n"),e}},{key:"astExpressionStatement",value:function(t,e){return this.astGeneric(t.expression,e),e.push(";"),e}},{key:"astVariableDeclaration",value:function(t,e){e.push("var ");for(var s=0;s<t.declarations.length;s++)this.declarations[t.declarations[s].id.name]="var",s>0&&e.push(","),this.astGeneric(t.declarations[s],e);return e.push(";"),e}},{key:"astVariableDeclarator",value:function(t,e){return this.astGeneric(t.id,e),null!==t.init&&(e.push("="),this.astGeneric(t.init,e)),e}},{key:"astIfStatement",value:function(t,e){return e.push("if ("),this.astGeneric(t.test,e),e.push(")"),"BlockStatement"===t.consequent.type?this.astGeneric(t.consequent,e):(e.push(" {\n"),this.astGeneric(t.consequent,e),e.push("\n}\n")),t.alternate&&(e.push("else "),"BlockStatement"===t.alternate.type?this.astGeneric(t.alternate,e):(e.push(" {\n"),this.astGeneric(t.alternate,e),e.push("\n}\n"))),e}},{key:"astBreakStatement",value:function(t,e){return e.push("break;\n"),e}},{key:"astContinueStatement",value:function(t,e){return e.push("continue;\n"),e}},{key:"astLogicalExpression",value:function(t,e){return e.push("("),this.astGeneric(t.left,e),e.push(t.operator),this.astGeneric(t.right,e),e.push(")"),e}},{key:"astUpdateExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astUnaryExpression",value:function(t,e){return t.prefix?(e.push(t.operator),this.astGeneric(t.argument,e)):(this.astGeneric(t.argument,e),e.push(t.operator)),e}},{key:"astThisExpression",value:function(t,e){return e.push("_this"),e}},{key:"astMemberExpression",value:function(t,e){if(t.computed)if("Identifier"===t.object.type||"MemberExpression"===t.object.type&&t.object.object.object&&"ThisExpression"===t.object.object.object.type&&"constants"===t.object.object.property.name)this.pushState("identifier"),this.astGeneric(t.object,e),this.popState("identifier"),e.push("["),this.isInput(t.object.name),this.astGeneric(t.property,e),e.push("]");else if(t.object.object)if(t.object.object.object&&this.isInput(t.object.object.object.name)){this.pushMemberState(t.object.object.object.name),this.pushState("input-index-z"),this.astGeneric(t.object,e);var s=e.pop();e.push(" + "),this.popState("input-index-z"),this.pushState("input-index"),this.astGeneric(t.property,e),this.popState("input-index"),e.push(s),this.popMemberState(t.object.object.object.name)}else if(this.isInput(t.object.object.name)){this.pushMemberState(t.object.object.name),this.isState("input-index-z")||this.pushState("input-index-y"),this.astGeneric(t.object,e);var n=e.pop();e.push(" + "),this.isState("input-index-z")||this.popState("input-index-y");var i=this.isState("input-index-z");i?this.pushState("input-index-y"):this.pushState("input-index"),this.astGeneric(t.property,e),i?this.popState("input-index-y"):this.popState("input-index"),e.push(n),this.popMemberState(t.object.object.name)}else{this.astGeneric(t.object,e);var r=e.pop();e.push("]["),this.astGeneric(t.property,e),e.push(r)}else{this.astGeneric(t.object,e);var a=e.pop();e.push("]["),this.astGeneric(t.property,e),e.push(a)}else{var u=this.astMemberExpressionUnroll(t);switch("Identifier"===t.property.type&&t.computed&&(u="user_"+u),0===u.indexOf("this.constants")?u="constants_"+u.substring(15):0===u.indexOf("this")&&(u="_"+u),this.state){case"input-index-y":case"input-index-z":e.push("(")}switch(u){case"_this.output.x":e.push(this.output[0]);break;case"_this.output.y":e.push(this.output[1]);break;case"_this.output.z":e.push(this.output[2]);break;default:t.object&&t.object.name&&this.declarations[t.object.name]&&e.push("user_"),e.push(u)}switch(this.state){case"input-index-y":var h=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+h[0]+")");break;case"input-index-z":var o=this.paramSizes[this.paramNames.indexOf(this.memberState)];e.push(" * "+o[0]*o[1]+")")}}return e}},{key:"astSequenceExpression",value:function(t,e){for(var s=0;s<t.expressions.length;s++)s>0&&e.push(","),this.astGeneric(t.expressions,e);return e}},{key:"astCallExpression",value:function(t,e){if(t.callee){var s=this.astMemberExpressionUnroll(t.callee);this.calledFunctions.indexOf(s)<0&&this.calledFunctions.push(s),this.hasOwnProperty("funcName")||(this.calledFunctionsArguments[s]=[]);var n=[];this.calledFunctionsArguments[s].push(n),e.push(s),e.push("(");for(var i=0;i<t.arguments.length;++i){var r=t.arguments[i];if(i>0&&e.push(", "),this.astGeneric(r,e),"Identifier"===r.type){var a=this.paramNames.indexOf(r.name);-1===a?n.push(null):n.push({name:r.name,type:this.paramTypes[a]})}else n.push(null)}return e.push(")"),e}throw this.astErrorOutput("Unknown CallExpression",t)}},{key:"astArrayExpression",value:function(t,e){var s=t.elements.length;e.push("[");for(var n=0;n<s;++n){n>0&&e.push(", ");var i=t.elements[n];this.astGeneric(i,e)}return e.push("]"),e}},{key:"astDebuggerStatement",value:function(t,e){return e.push("debugger;"),e}},{key:"memberState",get:function(){return this.memberStates[this.memberStates.length-1]}}]),u}();
},{"../function-node-base":"Ryaz","../../core/utils":"y5hZ"}],"iK8t":[function(require,module,exports) {
"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("../function-builder-base"),r=require("./function-node");module.exports=function(i){function u(){e(this,u);var o=t(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return o.Node=r,o}return o(u,n),u}();
},{"../function-builder-base":"zTps","./function-node":"nD9a"}],"ZIle":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=require("../../core/utils"),u=require("../runner-base"),i=require("./kernel"),c=require("./function-builder");module.exports=function(o){function l(e){t(this,l);var n=r(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,new c,e));return n.Kernel=i,n.kernel=null,n}return n(l,u),e(l,[{key:"getMode",value:function(){return"cpu"}}]),l}();
},{"../../core/utils":"y5hZ","../runner-base":"nVRz","./kernel":"DNTx","./function-builder":"iK8t"}],"lW7D":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("./kernel"),i=require("../../core/utils");module.exports=function(u){function a(){return t(this,a),r(this,(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments))}return o(a,n),e(a,[{key:"validateOptions",value:function(){this.texSize=i.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0)}}]),a}();
},{"./kernel":"xtMz","../../core/utils":"y5hZ"}],"E53u":[function(require,module,exports) {
"use strict";var e=function(){function e(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,o,r){return o&&e(t.prototype,o),r&&e(t,r),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var n=require("./kernel"),i=require("../../core/utils");module.exports=function(u){function f(){return t(this,f),o(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments))}return r(f,n),e(f,[{key:"validateOptions",value:function(){this._webGl.getExtension("EXT_color_buffer_float"),this.texSize=i.dimToTexSize({floatTextures:this.floatTextures,floatOutput:this.floatOutput},this.output,!0)}}]),f}();
},{"./kernel":"zX6P","../../core/utils":"y5hZ"}],"FLx2":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var r=require("./utils-core");module.exports=function(){function r(){n(this,r)}return e(r,null,[{key:"validateKernelObj",value:function(e){if(null===e)throw"KernelObj being validated is NULL";if("string"==typeof e){try{e=JSON.parse(e)}catch(n){throw console.error(n),"Failed to convert KernelObj from JSON string"}if(null===e)throw"Invalid (NULL) KernelObj JSON string representation"}if(!0!==e.isKernelObj)throw"Failed missing isKernelObj flag check";return e}},{key:"loadKernelObj",value:function(e,n){e=validateKernelObj(e)}}]),r}();
},{"./utils-core":"MFbY"}],"y3BS":[function(require,module,exports) {
"use strict";var e=function(){function e(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(n,r,t){return r&&e(n.prototype,r),t&&e(n,t),n}}();function n(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function t(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}var u=require("./utils"),a=require("../backend/web-gl/runner"),o=require("../backend/web-gl2/runner"),i=require("../backend/cpu/runner"),l=require("../backend/web-gl/validator-kernel"),s=require("../backend/web-gl2/validator-kernel"),c=require("./gpu-core"),f=function(f){function p(e){n(this,p);var t=r(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,e));e=e||{},t._canvas=e.canvas||null,t._webGl=e.webGl||null;var c=e.mode,f=void 0;if(u.isWebGlSupported())if(t._webGl)if("undefined"!=typeof WebGL2RenderingContext&&t._webGl.constructor===WebGL2RenderingContext)f="webgl2";else{if("undefined"==typeof WebGLRenderingContext||t._webGl.constructor!==WebGLRenderingContext)throw new Error("unknown WebGL Context");f="webgl"}else f=c||"gpu";else{if(c&&"cpu"!==c)throw new Error('A requested mode of "'+c+'" and is not supported');console.warn("Warning: gpu not supported, falling back to cpu support"),f="cpu"}t.kernels=[];var b={canvas:t._canvas,webGl:t._webGl};switch(f){case"cpu":t._runner=new i(b);break;case"gpu":var d=t.getGPURunner();t._runner=new d(b);break;case"webgl2":t._runner=new o(b);break;case"webgl":t._runner=new a(b);break;case"webgl2-validator":t._runner=new o(b),t._runner.Kernel=s;break;case"webgl-validator":t._runner=new a(b),t._runner.Kernel=l;break;default:throw new Error('"'+c+'" mode is not defined')}return t}return t(p,c),e(p,[{key:"createKernel",value:function(e,n){if(void 0===e)throw"Missing fn parameter";if(!u.isFunction(e)&&"string"!=typeof e)throw"fn parameter not a function";var r=Object.assign({webGl:this._webGl,canvas:this._canvas},n||{}),t=this._runner.buildKernel(e,r);return this._canvas||(this._canvas=t.getCanvas()),this._runner.canvas||(this._runner.canvas=t.getCanvas()),this.kernels.push(t),t}},{key:"createKernelMap",value:function(){var e=void 0,n=void 0;"function"==typeof arguments[arguments.length-2]?(e=arguments[arguments.length-2],n=arguments[arguments.length-1]):e=arguments[arguments.length-1],u.isWebGlDrawBuffersSupported()||(this._runner=new i(n));var r=this.createKernel(e,n);if(Array.isArray(arguments[0]))for(var t=arguments[0],a=0;a<t.length;a++)r.addSubKernel(t[a]);else{var o=arguments[0];for(var l in o)o.hasOwnProperty(l)&&r.addSubKernelProperty(l,o[l])}return r}},{key:"combineKernels",value:function(){var e=arguments[arguments.length-2],n=arguments[arguments.length-1];if("cpu"===this.getMode())return n;for(var r=arguments[0].getCanvas(),t=arguments[0].getWebGl(),a=0;a<arguments.length-1;a++)arguments[a].setCanvas(r).setWebGl(t).setOutputToTexture(!0);return function(){n.apply(null,arguments);var r=e.texSize,t=e.getWebGl(),a=e.threadDim,o=void 0;if(e.floatOutput){var i=r[0],l=Math.ceil(r[1]/4);o=new Float32Array(i*l*4),t.readPixels(0,0,i,l,t.RGBA,t.FLOAT,o)}else{var s=new Uint8Array(r[0]*r[1]*4);t.readPixels(0,0,r[0],r[1],t.RGBA,t.UNSIGNED_BYTE,s),o=new Float32Array(s.buffer)}return o=o.subarray(0,a[0]*a[1]*a[2]),1===e.output.length?o:2===e.output.length?u.splitArray(o,e.output[0]):3===e.output.length?u.splitArray(o,e.output[0]*e.output[1]).map(function(n){return u.splitArray(n,e.output[0])}):void 0}}},{key:"getGPURunner",value:function(){return"undefined"!=typeof WebGL2RenderingContext&&u.isWebGl2Supported()?o:"undefined"!=typeof WebGLRenderingContext?a:void 0}},{key:"addFunction",value:function(e,n){return this._runner.functionBuilder.addFunction(null,e,n),this}},{key:"addNativeFunction",value:function(e,n){return this._runner.functionBuilder.addNativeFunction(e,n),this}},{key:"getMode",value:function(){return this._runner.getMode()}},{key:"isWebGlSupported",value:function(){return u.isWebGlSupported()}},{key:"hasIntegerDivisionAccuracyBug",value:function(){return u.hasIntegerDivisionAccuracyBug()}},{key:"getCanvas",value:function(){return this._canvas}},{key:"getWebGl",value:function(){return this._webGl}},{key:"destroy",value:function(){var e=this;setTimeout(function(){for(var n=e.kernels,r=!e._webGl&&n.length&&n[0]._webGl,t=0;t<e.kernels.length;t++)e.kernels[t].destroy(!0);if(r){r.OES_texture_float=null,r.OES_texture_float_linear=null,r.OES_element_index_uint=null;var u=r.getExtension("WEBGL_lose_context");u&&u.loseContext()}},0)}}]),p}();Object.assign(f,c),module.exports=f;
},{"./utils":"y5hZ","../backend/web-gl/runner":"eOVQ","../backend/web-gl2/runner":"mZ2N","../backend/cpu/runner":"ZIle","../backend/web-gl/validator-kernel":"lW7D","../backend/web-gl2/validator-kernel":"E53u","./gpu-core":"FLx2"}],"ULn9":[function(require,module,exports) {
"use strict";var r=require("./utils");module.exports=function(t,n){var e=n.toString();return new Function("return function "+t+" ("+r.getParamNamesFromString(e).join(", ")+") {"+r.getFunctionBodyFromString(e)+"}")()};
},{"./utils":"y5hZ"}],"dc+G":[function(require,module,exports) {
"use strict";var e=require("./core/gpu"),n=require("./core/alias"),r=require("./core/utils"),u=require("./core/input"),i=require("./core/texture"),c=require("./backend/cpu/function-builder"),d=require("./backend/cpu/function-node"),o=require("./backend/cpu/kernel"),b=require("./backend/cpu/runner"),l=require("./backend/web-gl/function-builder"),t=require("./backend/web-gl/function-node"),a=require("./backend/web-gl/kernel"),q=require("./backend/web-gl/runner"),f=require("./backend/web-gl2/function-builder"),k=require("./backend/web-gl2/function-node"),w=require("./backend/web-gl2/kernel"),p=require("./backend/web-gl2/runner");e.alias=n,e.utils=r,e.Texture=i,e.Input=u,e.input=function(e,n){return new u(e,n)},e.CPUFunctionBuilder=c,e.CPUFunctionNode=d,e.CPUKernel=o,e.CPURunner=b,e.WebGLFunctionBuilder=l,e.WebGLFunctionNode=t,e.WebGLKernel=a,e.WebGLRunner=q,e.WebGL2FunctionBuilder=f,e.WebGL2FunctionNode=k,e.WebGL2Kernel=w,e.WebGL2Runner=p,"undefined"!=typeof module&&(module.exports=e),"undefined"!=typeof window&&(window.GPU=e),"undefined"!=typeof self&&(self.GPU=e);
},{"./core/gpu":"y3BS","./core/alias":"ULn9","./core/utils":"y5hZ","./core/input":"Q3WB","./core/texture":"34im","./backend/cpu/function-builder":"iK8t","./backend/cpu/function-node":"nD9a","./backend/cpu/kernel":"DNTx","./backend/cpu/runner":"ZIle","./backend/web-gl/function-builder":"izTu","./backend/web-gl/function-node":"2H8q","./backend/web-gl/kernel":"xtMz","./backend/web-gl/runner":"eOVQ","./backend/web-gl2/function-builder":"Ox3a","./backend/web-gl2/function-node":"RfHt","./backend/web-gl2/kernel":"zX6P","./backend/web-gl2/runner":"mZ2N"}],"tvYF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.makeGetUpdatedField=void 0;var e=r(require("gpu.js"));function r(e){return e&&e.__esModule?e:{default:e}}function t(e,r){if(e<0)return e+r;return e%r}function u(e,r,u,n){var a=this.thread.x;var i=this.thread.y;var d=e[i][a];var s=t(d+1,n);var f=t(i-1,r);if(e[f][a]===s)return s;f=t(i+1,r);if(e[f][a]===s)return s;f=t(a-1,u);if(e[i][f]===s)return s;f=t(a+1,u);if(e[i][f]===s)return s;return d}var n=new e.default;var a=function e(r,a){return n.createKernel(u).setOutput([a,r]).setFunctions([t])};exports.makeGetUpdatedField=a;
},{"gpu.js":"dc+G"}],"3tLf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var e=c(require("react"));var t=s(require("prop-types"));var n=require("state-control");var a=require("../constants");var r=s(require("../common/GriffeathMachine.css"));var i=s(require("../common/CanvasField"));var u=require("../common/utils");var o=require("./gpu-utils");var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)if(Object.prototype.hasOwnProperty.call(n,a))e[a]=n[a]}return e};function s(e){return e&&e.__esModule?e:{default:e}}function c(e){if(e&&e.__esModule)return e;else{var t={};if(null!=e)for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,n):{};if(a.get||a.set)Object.defineProperty(t,n,a);else t[n]=e[n]}t.default=e;return t}}function f(e){if("function"===typeof Symbol&&"symbol"===typeof Symbol.iterator)f=function e(t){return typeof t};else f=function e(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};return f(e)}function d(e,t,n){if(t in e)Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true});else e[t]=n;return e}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||false;a.configurable=true;if("value"in a)a.writable=true;Object.defineProperty(e,a.key,a)}}function y(e,t,n){if(t)h(e.prototype,t);if(n)h(e,n);return e}function m(e,t){if(t&&("object"===f(t)||"function"===typeof t))return t;return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function b(e){b=Object.setPrototypeOf?Object.getPrototypeOf:function e(t){return t.__proto__||Object.getPrototypeOf(t)};return b(e)}function v(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)g(e,t)}function g(e,t){g=Object.setPrototypeOf||function e(t,n){t.__proto__=n;return t};return g(e,t)}var w=function(t){v(l,t);function l(){var t;var n;var r;p(this,l);for(var i=arguments.length,s=new Array(i),c=0;c<i;c++)s[c]=arguments[c];return m(n,(r=n=m(this,(t=b(l)).call.apply(t,[this].concat(s))),n.state={width:n.props.width,height:n.props.height,states:n.props.states,status:a.STATUSES.pause},n.field=null,n.canvas=e.default.createRef(),n.getActionName=function(){return n.state.status===a.STATUSES.play?a.STATUSES.pause:a.STATUSES.play},n.randomizeField=function(){n.field=(0,u.getRandomField)(n.state)},n.processKey=function(e){if(e.keyCode===a.SPACE_CODE){e.preventDefault();n.handlePlay()}},n.updateFieldSize=function(e){var t=e.width,a=void 0===t?n.props.width:t,r=e.height,i=void 0===r?n.props.height:r;n.fieldUpdater=(0,o.makeGetUpdatedField)(a,i)},n.getUpdatedField=function(){var e=n.state,t=e.width,a=e.height,r=e.states;return n.fieldUpdater(n.field,t,a,r)},n.nextStep=function(){try{n.field=n.getUpdatedField();if(n.state.status===a.STATUSES.play)n.requestID=requestAnimationFrame(n.nextStep)}catch(e){cancelAnimationFrame(n.requestID);n.field=(0,u.getRandomField)(n.state);n.setState({status:a.STATUSES.pause})}n.canvas.current.paint(n.field)},n.handleNew=function(){n.randomizeField();n.canvas.current.paint(n.field)},n.handleNext=function(){n.field=n.getUpdatedField();n.canvas.current.paint(n.field)},n.handlePlay=function(){switch(n.state.status){case a.STATUSES.play:n.setState({status:a.STATUSES.pause});break;case a.STATUSES.pause:n.setState({status:a.STATUSES.play},n.nextStep);break;default:}},n.changeHandler=function(e,t){switch(e){case a.IDS.width:n.updateFieldSize({width:t});break;case a.IDS.height:n.updateFieldSize({height:t});break;default:}n.setState(d({},e,t))},r))}y(l,[{key:"componentWillMount",value:function e(){this.randomizeField();this.handlePlay();document.addEventListener("keydown",this.processKey);this.updateFieldSize({})}},{key:"componentWillUnmount",value:function e(){cancelAnimationFrame(this.requestID)}},{key:"render",value:function t(){return e.default.createElement("div",null,e.default.createElement(n.Connector,{state:this.state,onChange:this.changeHandler},e.default.createElement(n.Input,{id:a.IDS.width,label:"Field width",defaultNum:1}),e.default.createElement(n.Input,{id:a.IDS.height,label:"Field height",defaultNum:1}),e.default.createElement(n.Input,{id:a.IDS.states,label:"Number of states",defaultNum:1})),e.default.createElement("div",{onClick:this.handlePlay,onKeyDown:this.processKey,className:r.default.field,role:"presentation",title:this.getActionName()},e.default.createElement(i.default,{width:this.state.width,height:this.state.height,states:this.state.states,ref:this.canvas})),e.default.createElement("p",null,e.default.createElement("em",null,"Press Space or click field for play / pause")),e.default.createElement("button",{type:"button",className:r.default.bigButton,onClick:this.handleNew},"New"),e.default.createElement("button",{type:"button",className:r.default.bigButton,onClick:this.handlePlay},this.getActionName()),this.state.status===a.STATUSES.pause&&e.default.createElement("button",{type:"button",className:r.default.bigButton,onClick:this.handleNext},"Next step"))}}]);return l}(e.PureComponent);exports.default=w;w.propTypes={width:t.default.number.isRequired,height:t.default.number.isRequired,states:t.default.number.isRequired};w.defaultProps=l({},a.DEFAULT);
},{"react":"1n8/","prop-types":"5D9O","state-control":"RUp8","../constants":"wS45","../common/GriffeathMachine.css":"8dTm","../common/CanvasField":"heop","../common/utils":"hjwn","./gpu-utils":"tvYF"}]},{},[], null)
//# sourceMappingURL=GriffeathMachine.72e610db.js.map